<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Consultas Internas - Galvão Drones</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230E5847'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-12h2v4h4v2h-4v4h-2v-4H7v-2h4V8z'%3E%3C/path%3E%3Cpath d='M13.25 7.15c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L8.4 9.16c-.24.24-.36.58-.36.92s.12.68.36.92l.71.71c.24.24.58.36.92.36s-.68-.12.92-.36l2.93-2.93c-.24-.24-.36-.58-.36-.92s-.12-.68-.36-.92l-.71-.71zM10.75 16.85c.24.24.58.36.92.36s-.68-.12.92-.36l2.93-2.93c-.24-.24-.36-.58-.36-.92s-.12-.68-.36-.92l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36l-2.93 2.93c-.24.24-.36.58-.36.92s-.12.68.36.92l.71.71zM18.8 8.4l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L13.3 9.77c-.24.24-.36.58-.36.92s-.12.68.36.92l.71.71c.24.24.58.36.92.36s-.68-.12.92-.36l3.85-3.85c-.24-.24-.36-.58-.36.92s-.12-.68-.36-.92zM5.2 15.6l.71.71c-.24.24-.58.36-.92.36s-.68-.12-.92.36l3.85-3.85c-.24.24-.36.58-.36.92s-.12.68.36.92l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L5.2 14.68c-.24.24-.36.58-.36.92s-.12.68.36.92z'%3E%3C/path%3E%3C/svg%3E" type="image/svg+xml">
    <style>
        /* --- ESTILOS GERAIS (CSS) COM A PALETA GALVÃO DRONES --- */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        :root {
            --primary-color: #EF7E13; /* Laranja Galvão Drones */
            --secondary-color: #0E5847; /* Verde Galvão Drones */
            --light-grey: #f4f7f6;
            --medium-grey: #ecf0f1;
            --dark-grey: #bdc3c7;
            --danger-color: #e74c3c;
            --whatsapp-color: #25D366;
            --instagram-color: #C13584; /* Cor do Instagram */
            --youtube-color: #FF0000; /* Cor do YouTube */
            --help-color: #5865F2;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: var(--light-grey);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative; /* Adicionado para o pseudo-elemento */
        }

        /* Adiciona a imagem de fundo com opacidade */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://images.pexels.com/photos/2246476/pexels-photo-2246476.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1; /* Opacidade da imagem de fundo */
            z-index: -1;
            transition: background-image 0.5s ease-in-out, opacity 0.5s ease-in-out; /* Adiciona transição */
        }

        /* Nova classe para o fundo do modo visitante */
        body.visitor-mode-bg::before {
            background-image: url('https://i.imgur.com/b3lg2eE.png'); /* URL da sua logo no Imgur */
            background-size: contain; /* Ajusta a imagem para caber sem cortar */
            background-position: center center; /* Centraliza a imagem */
            background-repeat: no-repeat; /* Evita repetição */
            opacity: 0.5; /* Ajuste a opacidade conforme preferir */
        }


        .container {
            width: 100%;
            max-width: 1200px;
            margin: 20px;
            z-index: 1;
        }

        /* --- TELA DE LOGIN --- */
        #login-screen {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            transition: opacity 0.5s ease;
            margin: auto; /* Garante centralização */
        }
        #company-logo {
            max-width: 300px; /* Ajuste a largura máxima conforme necessário */
            width: 80%;
            display: block;
            margin: 0 auto 10px auto; /* Centraliza a imagem e adiciona margem inferior */
        }
        #portal-subtitle {
             color: #555;
             margin-top: 0;
             margin-bottom: 40px;
             font-size: 1.2em;
             font-weight: 400;
        }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
        }
        .action-button {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px; /* Adicionado para separar botões */
        }
        .action-button:hover {
            opacity: 0.9;
        }
        #login-error {
            color: var(--danger-color);
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }
        #visitor-mode-button {
            background-color: var(--dark-grey);
        }
        #visitor-mode-button:hover {
            background-color: #95a5a6;
        }


        /* --- TELA PRINCIPAL DO APP --- */
        #app-screen {
            display: none; /* Começa escondida */
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: opacity 0.5s ease;
        }
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px; /* Altura fixa para o header */
        }
        
        /* NOVO: Estilizando o botão de menu para integração */
        #nav-toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0 15px 0 0;
            margin-left: -10px;
            display: none; /* Escondido por padrão em telas maiores */
        }

        /* Container do ícone de perfil */
        #profile-icon-container {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: transform 0.2s ease-in-out;
            order: 0; /* Primeira posição, à esquerda */
        }

        #profile-icon-container:hover {
            transform: scale(1.05);
        }

        #profile-icon {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        /* NOVO: Unifica o botão de menu e ícone de perfil */
        .header-left-group {
            display: flex;
            align-items: center;
            gap: 15px;
            order: 0;
        }
        
        /* Container do nome de boas-vindas */
        .header-welcome-group { 
            display: flex; 
            align-items: center; 
            gap: 10px; /* Espaço entre o nome e o título */
            height: 100%;
            order: 1; /* Segunda posição */
            flex-grow: 1; 
            justify-content: flex-start; 
        }

        /* Container do título do portal */
        .header-title-container {
            order: 2; /* Terceira posição */
            flex-grow: 1; /* Permite que ocupe o espaço restante no centro */
            text-align: center; /* Centraliza o título */
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Container do botão de logout */
        .header-logout-group {
            order: 3; /* Última posição, à direita */
        }

        header h1 {
            margin: 0;
            font-size: 24px;
        }
        
        header #logout-button {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
            display: block; 
        }
        header #logout-button:hover {
            background-color: #c0392b;
        }

        .visitor-header #welcome-message {
            display: none;
        }

        #change-password-link {
            display: none !important;
        }


        .app-body {
            display: flex;
            position: relative;
            min-height: calc(100vh - 60px);
        }
        nav {
            width: 200px;
            min-width: 200px;
            background-color: var(--medium-grey);
            padding: 20px 0;
            border-right: 1px solid var(--dark-grey);
            transition: transform 0.3s ease;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .nav-item-group {
            width: 100%;
            position: relative;
        }

        .sub-nav {
            background-color: var(--dark-grey);
            padding-left: 10px;
        }

        .sub-nav-button {
            font-size: 0.95em;
            padding: 10px 20px;
            border-bottom: 1px solid #c0c0c0;
        }
        .sub-nav-button:last-child {
            border-bottom: none;
        }
        .sub-nav-button.active, .sub-nav-button:hover {
            background-color: #a0a0a0;
            color: white;
        }


        /* Oculta nav por padrão no mobile, prepara para slide-in */
        @media (max-width: 768px) {
            header {
                padding: 0 15px; /* Ajuste no padding */
                position: relative; /* Para centralização do título funcionar bem */
            }

            #nav-toggle-btn {
                display: block; /* Mostra o botão no mobile */
            }

            .header-title-container {
                display: none; /* Esconde o título no mobile para dar espaço */
            }
            .header-welcome-group {
                justify-content: flex-start;
                flex-grow: 1; /* Ocupa o espaço */
            }

            #welcome-message {
                margin-left: 0;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 150px; /* Limita a largura */
            }

            #profile-icon-container {
                width: 35px;
                height: 35px;
            }

            nav {
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                width: 250px;
                min-width: 250px;
                transform: translateX(-100%);
                z-index: 1010; /* Z-index alto para ficar sobre tudo */
                box-shadow: 2px 0 5px rgba(0,0,0,0.2);
                padding-top: 0; /* Removido o padding top */
                border-right: 1px solid var(--dark-grey);
            }
            nav.nav-open {
                transform: translateX(0);
            }
            .nav-header {
                display: flex;
                position: relative; /* mudado de absolute */
                width: 100%;
                height: 60px;
                background-color: var(--secondary-color);
                color: white;
                padding: 15px 20px;
                box-sizing: border-box;
                align-items: center;
            }
            .nav-header #nav-toggle-btn-close {
                font-size: 24px;
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                padding: 0 10px;
            }
             .nav-header span {
                flex-grow: 1;
                text-align: center;
                margin-left: -20px;
                font-size: 1.2em;
            }
            .app-body {
                flex-direction: column;
                min-height: calc(100vh - 60px);
            }

            main {
                width: 100%;
                box-sizing: border-box;
            }
        }

        nav button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            background: none;
            border: none;
            text-align: left;
            font-size: 16px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            transition: background-color 0.3s, color 0.3s;
        }
        nav button.active, nav button:hover {
            background-color: var(--dark-grey);
            color: var(--secondary-color);
            font-weight: 700;
        }
        .nav-header {
            display: none; 
            align-items: center;
            padding: 15px 20px;
            background-color: var(--dark-grey);
            color: var(--secondary-color);
            font-weight: 700;
        }
        .nav-header span {
            margin-left: 10px;
        }

        main {
            flex-grow: 1;
            padding: 30px;
            max-height: calc(100vh - 60px);
            overflow-y: auto;
            position: relative;
            transition: margin-left 0.3s ease;
        }
        @media (max-width: 768px) {
            main {
                padding: 20px;
                max-height: calc(100vh - 60px);
                width: 100%;
            }
        }

        /* --- NOVOS ESTILOS PARA FILTROS E POP-UPS --- */

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .filter-container {
            position: relative;
        }

        .filter-button {
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .filter-button:hover {
            background-color: var(--primary-color);
        }

        .filter-popup {
            display: none;
            position: absolute;
            top: 50px;
            right: 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            z-index: 100;
            width: 220px;
            border: 1px solid #ddd;
            overflow: hidden;
        }
        
        .filter-popup button {
            display: block;
            width: 100%;
            padding: 12px 15px;
            background: none;
            border: none;
            border-bottom: 1px solid #eee;
            text-align: left;
            font-size: 15px;
            cursor: pointer;
        }

        .filter-popup button:last-child {
            border-bottom: none;
        }

        .filter-popup button:hover {
            background-color: var(--light-grey);
        }

        .supplier-actions-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .supplier-actions-container .action-button {
            width: auto;
            padding: 10px 15px;
            font-size: 15px;
        }

        .contact-wpp-button {
            background-color: var(--whatsapp-color) !important;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
            font-weight: 500;
            border: none;
            cursor: pointer;
        }
        .contact-wpp-button:hover {
            opacity: 0.9;
        }
        
        #budget-modal .checkbox-group {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        #budget-modal .checkbox-group label {
            display: block;
            margin-bottom: 8px;
        }

        #budget-modal .sub-options {
            padding-left: 20px;
            margin-top: 10px;
            display: none; /* Escondido por padrão */
        }
        
        #budget-modal .final-info-checkboxes label{
             font-weight: normal;
             font-size: 0.9em;
        }
        #budget-modal .final-info-checkboxes input {
            margin-right: 8px;
        }


        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .content-section h2, .content-section h3 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            color: var(--secondary-color);
        }
        .content-section h3 {
             border-bottom: 1px solid var(--dark-grey);
             font-size: 1.2em;
             margin-top: 30px;
        }

        #settings-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        #settings-options-grid .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        #settings-options-grid .card h3 {
            color: var(--primary-color);
            font-size: 1.5em;
            margin-bottom: 10px;
            border-bottom: none;
        }
        #settings-options-grid .card p {
            font-size: 0.9em;
            color: #666;
        }

        .back-to-settings-button {
            background-color: var(--dark-grey);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            margin-bottom: 20px;
            display: inline-block;
            width: auto;
        }

        .back-to-settings-button:hover {
            background-color: #95a5a6;
        }


        .search-bar {
            margin-bottom: 20px;
            position: relative;
        }
        .search-bar input {
            width: 100%; padding: 12px 12px 12px 40px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box;
        }
        .search-bar::before {
            content: '🔎'; position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 18px; opacity: 0.6;
        }
        
        .card {
            position: relative;
            background-color: white;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
            transition: box-shadow 0.3s;
            z-index: 1;
        }

        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("logo.png");
            background-size: 50%;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.05;
            z-index: -1;
            border-radius: 5px;
        }
        .card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .card h3 { margin-top: 0; color: var(--secondary-color); border: none; font-size: 1.3em; }
        .product-card { border-left: 5px solid var(--primary-color); }
        .supplier-card { border-left: 5px solid var(--secondary-color); }
        .info-card { border-left: 5px solid var(--secondary-color); }
        .product-spec { white-space: pre-wrap; line-height: 1.6; font-size: 0.95em; }

        .price { font-size: 1.2em; font-weight: 700; color: #27ae60; }
        .cost-price { font-size: 1.1em; font-weight: 700; color: var(--danger-color); background-color: #fdd; padding: 5px; border-radius: 4px; display: inline-block; margin-top: 10px; }
        .supplier-info { font-size: 0.9em; font-weight: 500; color: var(--secondary-color); background-color: #e8f8f5; padding: 5px 8px; border-radius: 4px; display: inline-block; margin-top: 10px; margin-left: 10px;}
        
        .product-suppliers-list {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
            font-size: 0.9em;
        }
        .product-suppliers-list li {
            background-color: #f8f8f8;
            padding: 5px 10px;
            border-radius: 3px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #eee;
        }
        .product-suppliers-list li .supplier-name-link {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: bold;
        }
        .product-suppliers-list li .cost-value {
            color: var(--danger-color);
            font-weight: 500;
        }

        .action-buttons-container { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; }
        .action-buttons-container button, .action-buttons-container a.action-button {
            color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 500; transition: background-color 0.3s;
            font-size: 0.9em;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .gemini-button { background-color: var(--secondary-color); }
        .whatsapp-button { background-color: var(--whatsapp-color); }
        .instagram-button { background-color: var(--instagram-color); }
        .youtube-button { background-color: var(--youtube-color); }
        .google-maps-button { background-color: #4285F4; }

        .help-button { background-color: var(--help-color); }
        .action-buttons-container button:hover, .action-buttons-container a.action-button:hover { opacity: 0.9; }

        .calculator-container { margin-top: 20px; padding-top: 20px; border-top: 1px dashed var(--dark-grey); }
        .payment-method-selector label { display: inline-block; margin-right: 15px; cursor: pointer; font-size: 0.95em; }
        .payment-method-selector input { margin-right: 5px; }
        .installments-container { margin-top: 10px; }
        .calculate-product-btn { background-color: var(--secondary-color); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px;}
        .product-calculator-result, #general-calculator-result { margin-top: 15px; font-size: 1.1em; color: var(--secondary-color); background-color: #eaf5ff; padding: 15px; border-radius: 5px; }
        .result-vista { font-weight: bold; }
        .result-parcelado { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--dark-grey); }
        .result-parcelado small { font-size: 0.9em; font-weight: normal; color: #555; }
        
        .discount-option {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        .discount-option input[type="number"] {
            width: 80px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: transparent;
            position: relative;
            z-index: 1;
        }
        .discount-option label {
            margin-bottom: 0;
        }
        .discount-option::after {
            content: "max. 15%";
            position: absolute;
            left: 105px;
            color: #ccc;
            font-size: 0.8em;
            opacity: 0.8;
            pointer-events: none;
            white-space: nowrap;
            transform: translateY(2px);
            z-index: 0;
        }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); padding-top: 60px; }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; position: relative; }
        .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .loader { border: 8px solid #f3f3f3; border-radius: 50%; border-top: 8px solid var(--primary-color); width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #scroll-to-top { position: fixed; bottom: 20px; right: 30px; z-index: 99; border: none; outline: none; background-color: var(--primary-color); color: white; cursor: pointer; padding: 12px 15px; border-radius: 50%; font-size: 18px; display: none; }

        #temp-user-list-container { margin-top: 30px; }
        .temp-user-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--medium-grey); }
        .temp-user-item:last-child { border-bottom: none; }
        .user-info p { margin: 0; }
        .user-info p small { color: #555; }
        .user-actions button { margin-left: 10px; padding: 5px 10px; border-radius: 4px; border: none; color: white; cursor: pointer; }
        .edit-btn { background-color: var(--primary-color); }
        .delete-btn { background-color: var(--danger-color); }

        .hidden { display: none !important; }

        #ai-chat-button {
            position: fixed;
            bottom: 90px;
            right: 30px;
            z-index: 99;
            border: none;
            outline: none;
            background-color: var(--secondary-color);
            color: white;
            cursor: pointer;
            padding: 15px 18px;
            border-radius: 50%;
            font-size: 24px;
            display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: background-color 0.3s, transform 0.3s;
        }

        #ai-chat-button:hover {
            background-color: #0A4538;
            transform: translateY(-3px);
        }

        #ai-chat-button:active {
            transform: translateY(0);
        }

        #ai-chat-modal .modal-content {
            max-width: 700px;
            text-align: left;
        }

        #ai-chat-modal-body {
            text-align: left;
        }

        #ai-question-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
            margin-bottom: 15px;
        }

        #submit-ai-question {
            width: auto;
            padding: 10px 20px;
            font-size: 1em;
        }

        #ai-response-area {
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
        }

        #supplier-password-modal .modal-content {
            max-width: 400px;
            text-align: center;
        }
        #supplier-password-modal .input-group input {
            text-align: center;
        }
        #supplier-password-modal .error-message {
            color: var(--danger-color);
            margin-top: 10px;
            display: none;
        }

        #change-password-modal .modal-content {
            max-width: 450px;
            text-align: center;
        }
        #change-password-modal .input-group {
            margin-bottom: 15px;
        }
        #change-password-modal .input-group label {
            font-size: 0.9em;
        }
        #change-password-modal .error-message {
            color: var(--danger-color);
            margin-top: 10px;
            font-weight: 500;
            display: none;
        }
        #change-password-modal .success-message {
            color: var(--secondary-color);
            margin-top: 10px;
            font-weight: 500;
            display: none;
        }

        #profile-section .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        #profile-section .profile-pic-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        #profile-section .profile-info h3 {
            margin: 0;
            font-size: 1.8em;
            color: var(--secondary-color);
            border-bottom: none;
        }
        #profile-section .profile-info p {
            margin: 5px 0;
            font-size: 1.1em;
            color: #555;
        }
        #profile-section .profile-edit-form .input-group {
            margin-bottom: 15px;
        }
        #profile-section .profile-edit-form .action-button {
            width: auto;
            padding: 10px 20px;
            margin-right: 10px;
        }
        #profile-section .profile-edit-form .action-button.secondary {
            background-color: var(--dark-grey);
        }
        #profile-section .profile-edit-form .action-button.secondary:hover {
            background-color: #95a5a6;
        }
        #profile-section .profile-feedback {
            margin-top: 15px;
            font-weight: bold;
        }
        #profile-section .profile-pic-upload-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        #profile-section .profile-pic-upload-container input[type="file"] {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #profile-section .profile-pic-upload-container button {
            padding: 8px 15px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #whatsapp-modal .modal-content {
            max-width: 500px;
            text-align: left;
        }
        #whatsapp-modal textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
            min-height: 120px;
            margin-bottom: 15px;
        }
        #whatsapp-modal .profile-info-options {
            margin-bottom: 15px;
        }
        #whatsapp-modal .profile-info-options label {
            display: block;
            margin-bottom: 8px;
            font-weight: normal;
            font-size: 0.95em;
        }
        #whatsapp-modal .profile-info-options input[type="checkbox"] {
            margin-right: 8px;
        }
        #whatsapp-modal .action-button-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        #whatsapp-modal .action-button-group .action-button {
            width: auto;
        }
        #whatsapp-modal .action-button-group .cancel-button {
            background-color: var(--dark-grey);
        }
        #whatsapp-modal .action-button-group .cancel-button:hover {
            background-color: #95a5a6;
        }

        #marketing-section .marketing-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        #marketing-section .marketing-item {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        #marketing-section .marketing-item h3 {
            color: var(--primary-color);
            margin-top: 0;
            border-bottom: none;
        }
        #marketing-section .marketing-item img {
            max-width: 80%;
            height: auto;
            margin: 15px auto;
            display: block;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #marketing-section .marketing-item .download-button {
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            text-decoration: none;
            display: inline-block;
            margin-top: 15px;
        }
        #marketing-section .marketing-item .download-button:hover {
            background-color: #0A4538;
        }


        @media (max-width: 768px) {
            main .content-section > * {
                margin-left: auto;
                margin-right: auto;
                max-width: 100%;
                padding: 0 10px;
                box-sizing: border-box;
            }

            .card {
                padding: 15px;
                margin-bottom: 10px;
            }

            .card h3 {
                font-size: 1.1em;
            }

            .product-spec, .price, .cost-price, .supplier-info {
                font-size: 0.9em;
            }

            .action-buttons-container {
                flex-direction: column;
                gap: 8px;
            }
            .action-buttons-container button, .action-buttons-container a.action-button {
                width: 100%;
                padding: 10px;
                font-size: 0.9em;
            }
            .supplier-actions-container {
                flex-direction: column;
            }
            .supplier-actions-container .action-button {
                width: 100%;
            }

            .calculator-container .input-group {
                margin-bottom: 10px;
            }
            .payment-method-selector label {
                margin-right: 10px;
                font-size: 0.9em;
            }
            .discount-option {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .discount-option input[type="number"] {
                width: 100px;
                padding: 5px;
            }
            .discount-option::after {
                content: "max. 15%";
                position: absolute;
                left: 0;
                top: auto;
                bottom: -15px;
                transform: none;
                font-size: 0.7em;
                pointer-events: none;
                white-space: nowrap;
                transform: translateY(2px);
                z-index: 0;
            }
            .calculate-product-btn {
                width: 100%;
                padding: 10px;
            }
            .product-calculator-result, #general-calculator-result {
                font-size: 1em;
                padding: 10px;
            }
            .result-parcelado small {
                font-size: 0.8em;
            }

            .search-bar input {
                padding: 10px 10px 10px 35px;
                font-size: 0.95em;
            }
            .search-bar::before {
                left: 10px;
                font-size: 16px;
            }

            .temp-user-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 10px;
            }
            .user-info p {
                font-size: 0.95em;
            }
            .user-actions {
                width: 100%;
                display: flex;
                justify-content: flex-start;
                margin-top: 10px;
            }
            .user-actions button {
                margin-left: 0;
                margin-right: 10px;
                padding: 8px 10px;
                font-size: 0.9em;
            }

            .info-card p {
                font-size: 0.95em;
            }
            .contact-buttons-container {
                flex-direction: column;
                gap: 8px;
            }
            .contact-buttons-container a.action-button {
                width: 100%;
            }

            #ai-chat-modal .modal-content {
                width: 90%;
                margin: 20px auto;
            }
            #ai-question-input {
                font-size: 0.95em;
            }
            #ai-response-area {
                font-size: 0.9em;
                padding: 8px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="login-screen">
            <img src="https://i.imgur.com/b3lg2eE.png" alt="Logotipo Galvão Drones" id="company-logo">
            <h2 id="portal-subtitle">Portal Interno</h2>
            <div class="input-group"><label for="username">Usuário</label><input type="text" id="username" placeholder="Digite seu nome"></div>
            <div class="input-group"><label for="password">Senha</label><input type="password" id="password" placeholder="Sua senha"></div>
            <button id="login-button" class="action-button">Entrar</button>
            <button id="visitor-mode-button" class="action-button">Modo Visitante</button>
            <p id="login-error">Usuário ou senha inválidos.</p>
        </div>

        <div id="app-screen">
            <header>
                 <div class="header-left-group">
                    <button id="nav-toggle-btn">☰</button>
                    <div id="profile-icon-container">
                        <img id="profile-icon" src="https://i.imgur.com/8Yd00YF.png" alt="Foto de Perfil"> 
                    </div>
                </div>
                <div class="header-welcome-group">
                    <span id="welcome-message"></span>
                </div>
                <div class="header-title-container">
                    <h1>Portal Interno</h1>
                </div>
                <div class="header-logout-group">
                    <button id="logout-button">Sair</button>
                </div>
            </header>
            <div class="app-body">
                <nav>
                    <div class="nav-header">
                        <button id="nav-toggle-btn-close">✕</button>
                        <span>Menu</span>
                    </div>
                    <button class="nav-button" data-section="products-section" id="products-nav-button" style="order: 1;">Produtos</button>
                    <button class="nav-button" data-section="calculator-section" id="calculator-nav-button" style="order: 2;">Calculadora</button>
                    <button class="nav-button" data-section="suppliers-section" id="suppliers-nav-button" style="order: 3;">Fornecedores</button>
                    
                    <div class="nav-item-group" style="order: 4;">
                        <button class="nav-button" data-section="settings-section" id="settings-nav-button">Configurações</button>
                        <div class="sub-nav" id="settings-sub-nav" style="display: none;">
                            <button class="nav-button sub-nav-button" data-section="manage-users-section" id="manage-users-nav-button">Gerir Usuários</button>
                            <button class="nav-button sub-nav-button" data-section="create-product-section" id="create-product-nav-button">Criar Produto</button>
                            <button class="nav-button sub-nav-button" data-section="edit-product-section" id="edit-product-nav-button">Alterar Produto</button>
                        </div>
                    </div>
                    
                    <button class="nav-button" data-section="drones-visitor-section" id="drones-nav-button" style="order: 5;">Drones</button>
                    <button class="nav-button" data-section="info-section" id="info-empresa-nav-button" style="order: 6;">Info Empresa</button>
                    <button class="nav-button" data-section="marketing-section" id="marketing-nav-button" style="order: 7;">Marketing</button>
                    <button class="nav-button hidden" data-section="profile-section" id="profile-nav-button" style="order: 8;">Meu Perfil</button>
                </nav>
                <main id="main-content">
                    <section id="products-section" class="content-section active">
                        <h2>Consulta de Produtos</h2>
                        <div class="search-bar"><input type="text" id="product-search" placeholder="Pesquisar por nome ou especificação..."></div>
                        <div id="product-list"></div>
                    </section>
                    <section id="calculator-section" class="content-section">
                        <h2>Calculadora Geral</h2>
                        <div class="card">
                           <div class="input-group">
                                <label for="general-valor-base">Valor Base</label>
                                <input type="number" id="general-valor-base" class="input-full" placeholder="Digite o valor para simulação">
                           </div>
                           <div class="input-group">
                                <label>Forma de Pagamento</label>
                                <div id="general-payment-method-selector">
                                    <input type="radio" id="general-payment-vista" name="general-payment-method" value="vista" checked>
                                    <label for="general-payment-vista">À vista</label>
                                    <input type="radio" id="general-payment-parcelado" name="general-payment-method" value="parcelado">
                                    <label for="general-payment-parcelado">Parcelado</label>
                                </div>
                           </div>
                           <div class="discount-option hidden" id="general-discount-option">
                               <label for="general-discount-percentage">Desconto (%):</label>
                               <input type="number" id="general-discount-percentage" min="0" max="15" value="0">
                           </div>
                           <div class="input-group hidden" id="general-installments-container">
                                <label for="general-parcelas">Número de Parcelas</label>
                                <select id="general-parcelas">
                                    <option value="1">1x</option><option value="2">2x</option><option value="3">3x</option><option value="4">4x</option><option value="5">5x</option><option value="6">6x</option><option value="7">7x</option><option value="8">8x</option><option value="9">9x</option><option value="10">10x</option><option value="11">11x</option><option value="12">12x</option>
                                </select>
                           </div>
                           <button id="general-calculate-button" class="action-button" style="width: auto; padding: 10px 20px;">Calcular</button>
                           <div id="general-calculator-result">O resultado da simulação aparecerá aqui.</div>
                          </div>
                    </section>
                    <section id="suppliers-section" class="content-section">
                        <div class="section-header">
                            <h2>Fornecedores (Acesso Confidencial)</h2>
                            <div class="filter-container">
                                <button class="filter-button" id="suppliers-filter-btn" title="Filtrar Fornecedores">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>
                                </button>
                                <div class="filter-popup" id="suppliers-filter-popup">
                                    <button data-sort="alpha">Ordem Alfabética</button>
                                </div>
                            </div>
                        </div>
                        <div class="supplier-actions-container">
                            <button id="create-supplier-btn" class="action-button">Criar Fornecedor</button>
                            <button id="edit-supplier-btn" class="action-button">Alterar Dados de Fornecedor</button>
                            <button id="request-budget-btn" class="action-button">Solicitar Orçamento</button>
                        </div>
                        <div id="supplier-list"></div>
                    </section>
                    
                    <section id="settings-section" class="content-section">
                        <h2>Configurações do Sistema</h2>
                        <p>Selecione uma opção de configuração no menu lateral, ou clique nos atalhos abaixo:</p>
                        <div id="settings-options-grid"></div>
                    </section>

                    <section id="manage-users-section" class="content-section">
                        <button class="back-to-settings-button" onclick="window.switchTab('settings-section')">← Voltar para Configurações</button>
                        <h2>Gerir Usuários Temporários</h2>
                        <div class="card">
                            <h3>Criar Usuário Temporário</h3>
                            <form id="create-temp-user-form">
                                <div class="input-group"><label for="temp-username">Nome de Usuário</label><input type="text" id="temp-username" required></div>
                                <div class="input-group"><label for="temp-password">Senha</label><input type="text" id="temp-password" required></div>
                                <div class="input-group"><label for="temp-duration">Duração do Acesso</label><select id="temp-duration"><option value="1">1 Hora</option><option value="8">8 Horas</option><option value="24" selected>24 Horas</option><option value="72">72 Horas</option></select></div>
                                <button type="submit" class="action-button">Criar Usuário</button>
                                <p id="temp-user-feedback" style="margin-top: 15px; font-weight: bold;"></p>
                            </form>
                        </div>
                        <div id="temp-user-list-container">
                            <h3>Usuários Temporários Ativos</h3>
                            <div id="temp-user-list" class="card"></div>
                        </div>
                    </section>

                    <section id="create-product-section" class="content-section">
                        <button class="back-to-settings-button" onclick="window.switchTab('settings-section')">← Voltar para Configurações</button>
                        <h2>Criar Novo Produto</h2>
                        <div class="card">
                            <form id="create-product-form">
                                <div class="input-group"><label for="new-product-name">Nome do Produto</label><input type="text" id="new-product-name" required></div>
                                <div class="input-group"><label for="new-product-spec">Especificações</label><textarea id="new-product-spec" rows="5"></textarea></div>
                                <div class="input-group"><label for="new-product-sale-price">Preço de Venda (R$)</label><input type="number" id="new-product-sale-price" step="0.01" min="0" required></div>
                                <div class="input-group"><label for="new-product-cost-price">Preço de Custo (R$)</label><input type="number" id="new-product-cost-price" step="0.01" min="0"></div>
                                <div class="input-group"><label for="new-product-supplier">Fornecedor Principal</label><input type="text" id="new-product-supplier"></div>
                                <button type="submit" class="action-button">Salvar Novo Produto</button>
                                <p id="create-product-feedback" style="margin-top: 15px; font-weight: bold;"></p>
                            </form>
                        </div>
                    </section>

                    <section id="edit-product-section" class="content-section">
                        <button class="back-to-settings-button" onclick="window.switchTab('settings-section')">← Voltar para Configurações</button>
                        <h2>Alterar Produto Existente</h2>
                        <div class="card">
                            <div class="input-group">
                                <label for="edit-product-search-input">Buscar Produto (ID ou Nome)</label>
                                <input type="text" id="edit-product-search-input" placeholder="Digite o ID ou nome do produto">
                                <button id="search-product-to-edit" class="action-button" style="width: auto; margin-top: 10px;">Buscar</button>
                            </div>
                            <div id="edit-product-search-results" style="margin-top: 15px;"></div>
                            
                            <div id="edit-product-display" style="margin-top: 20px;">
                                <p>Use a busca acima para carregar os dados do produto.</p>
                            </div>
                            <form id="edit-product-form" class="hidden">
                                <input type="hidden" id="edit-product-id">
                                <div class="input-group"><label for="edit-product-name">Nome do Produto</label><input type="text" id="edit-product-name" required></div>
                                <div class="input-group"><label for="edit-product-spec">Especificações</label><textarea id="edit-product-spec" rows="5"></textarea></div>
                                <div class="input-group"><label for="edit-product-sale-price">Preço de Venda (R$)</label><input type="number" id="edit-product-sale-price" step="0.01" min="0" required></div>
                                <div class="input-group"><label for="edit-product-cost-price">Preço de Custo (R$)</label><input type="number" id="edit-product-cost-price" step="0.01" min="0"></div>
                                <div class="input-group"><label for="edit-product-supplier">Fornecedor Principal</label><input type="text" id="edit-product-supplier"></div>
                                <button type="submit" class="action-button">Salvar Alterações</button>
                                <p id="edit-product-feedback" class="profile-feedback"></p>
                            </form>
                        </div>
                    </section>

                    <section id="drones-visitor-section" class="content-section">
                        <div class="section-header">
                            <h2>Modelos de Drones</h2>
                            <div class="filter-container">
                                <button class="filter-button" id="drones-filter-btn" title="Filtrar Drones">
                                   <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>
                                </button>
                                <div class="filter-popup" id="drones-filter-popup">
                                    <button data-sort="alpha">Ordem Alfabética</button>
                                    <button data-sort="price_asc">Menor Valor</button>
                                    <button data-sort="price_desc">Maior Valor</button>
                                    <button data-filter="consumer">Linha Consumer</button>
                                    <button data-filter="enterprise">Linha Enterprise</button>
                                    <button data-filter="agriculture">Linha Agriculture</button>
                                </div>
                            </div>
                        </div>
                        <div class="search-bar"><input type="text" id="drone-visitor-search" placeholder="Pesquisar por modelo ou especificação..."></div>
                        <div id="drone-visitor-list"></div>
                    </section>
                    <section id="info-section" class="content-section">
                        <h2>Informações da Empresa</h2>
                        <div class="card info-card">
                            <p><strong>Nome da Empresa:</strong> Galvão Drones</p>
                            <p id="cnpj-display-line"><strong>CNPJ:</strong> 60.102.179/0001-10</p>
                            <p><strong>Endereço:</strong> Rua 16, nº 304 – Setor Aeroviário, Goiânia – GO, CEP: 74435-240</p>
                            <p><a href="https://www.google.com/maps/search/?api=1&query=Rua+16,+304,+Setor+Aerovi%C3%A1rio,+Goi%C3%A2nia+-+GO,+74435-240" target="_blank" class="action-button google-maps-button" style="width: auto; padding: 10px 15px; margin-right: 10px;">Ver no Google Maps</a></p>
                            <p><strong>Contato:</strong> <span id="company-phone">(62) 3636-0668</span></p>
                            <div class="contact-buttons-container" style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                                <a href="https://www.instagram.com/galvao_drones" target="_blank" class="action-button instagram-button" style="width: auto; padding: 10px 15px;">Instagram</a>
                                <a href="https://wa.me/556236360668" target="_blank" class="action-button whatsapp-button" id="company-whatsapp-link" style="width: auto; padding: 10px 15px;">WhatsApp</a>
                                <a href="https://www.youtube.com/@galvaodrones" target="_blank" class="action-button youtube-button" style="width: auto; padding: 10px 15px;">YouTube</a>
                            </div>
                            <p><strong>Website:</strong> <a href="http://www.galvaodrones.com.br" target="_blank">www.galvaodrones.com.br</a></p>
                        </div>
                    </section>

                    <section id="profile-section" class="content-section">
                        <h2>Meu Perfil</h2>
                        <div class="card">
                            <div class="profile-header">
                                <img id="profile-pic-display" src="https://i.imgur.com/8Yd00YF.png" alt="Foto de Perfil" class="profile-pic-large"> 
                                <div class="profile-info">
                                    <h3 id="profile-display-name"></h3>
                                    <p id="profile-email"></p>
                                    <p id="profile-phone"></p>
                                </div>
                            </div>
                            <form id="profile-edit-form" class="profile-edit-form">
                                <h3>Alterar Dados</h3>
                                <div class="input-group">
                                    <label for="edit-display-name">Nome de Exibição</label>
                                    <input type="text" id="edit-display-name" required>
                                </div>
                                <div class="input-group">
                                    <label for="edit-email">Email</label>
                                    <input type="email" id="edit-email">
                                </div>
                                <div class="input-group">
                                    <label for="edit-phone">Celular para Atendimento (WhatsApp)</label>
                                    <input type="tel" id="edit-phone" placeholder="Ex: 62988887777">
                                </div>
                                <div class="input-group profile-pic-upload-container">
                                    <label for="edit-profile-pic">Alterar Foto de Perfil</label>
                                    <input type="file" id="edit-profile-pic" accept="image/*">
                                    <button type="button" id="upload-profile-pic-button">Carregar Foto</button>
                                </div>
                                <button type="submit" class="action-button">Salvar Alterações do Perfil</button>
                                <button type="button" id="open-change-password-modal" class="action-button secondary">Alterar Senha</button>
                                <p id="profile-feedback" class="profile-feedback"></p>
                            </form>
                        </div>
                    </section>

                    <section id="marketing-section" class="content-section">
                        <h2>Conteúdo para Marketing</h2>
                        <p>Aqui você encontra materiais visuais e informativos para suas campanhas de marketing da Galvão Drones.</p>
                        <div class="marketing-content">
                            <div class="marketing-item">
                                <h3>Logo Oficial Galvão Drones (Cor Padrão - PNG)</h3>
                                <img src="https://i.imgur.com/pgwtkKq.png" alt="Logo Galvão Drones Cor Padrão">
                                <a href="https://i.imgur.com/pgwtkKq.png" download="galvao_drones_logo_padrao.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Oficial Galvão Drones (Fundo Transparente - PNG)</h3>
                                <img src="https://i.imgur.com/ZsH8VeQ.png" alt="Logo Galvão Drones Fundo Transparente">
                                <a href="https://i.imgur.com/ZsH8VeQ.png" download="galvao_drones_logo_transparente.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Galvão Drones (Versão Clara - PNG)</h3>
                                <img src="https://i.imgur.com/0CpzT9r.png" alt="Logo Galvão Drones Versão Clara">
                                <a href="https://i.imgur.com/0CpzT9r.png" download="galvao_drones_logo_clara.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Galvão Drones (Versão Esverdeada - PNG)</h3>
                                <img src="https://i.imgur.com/UX00mxn.png" alt="Logo Galvão Drones Versão Esverdeada">
                                <a href="https://i.imgur.com/UX00mxn.png" download="galvao_drones_logo_esverdeada.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Galvão Drones (Fundo Laranja - JPG)</h3>
                                <img src="https://i.imgur.com/b9gygL7.png" alt="Logo Galvão Drones Fundo Laranja">
                                <a href="https://i.imgur.com/b9gygL7.png" download="galvao_drones_logo_fundo_laranja.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Galvão Drones (Fundo Preto - JPG)</h3>
                                <img src="https://i.imgur.com/5dpZZuY.png" alt="Logo Galvão Drones Fundo Preto">
                                <a href="https://i.imgur.com/5dpZZuY.png" download="galvao_drones_logo_fundo_preto.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Guia de Estilo da Marca Galvão Drones</h3>
                                <p>Um PDF completo com diretrizes de uso da marca, paleta de cores e tipografia.</p>
                                <a href="https://drive.google.com/uc?export=download&id=1bcg8UuCBSfaPB5ktacHz5KfWgGY5ir-a" download="guia_de_estilo_galvao_drones.pdf" class="download-button">Baixar Guia de Estilo (PDF)</a>
                            </div>
                        </div>
                    </section>
                </main>
            </div>
        </div>
    </div>
    
    <button id="scroll-to-top" title="Voltar ao topo">⬆</button>

    <button id="ai-chat-button" title="Falar com a IA">🤖</button>

    <!-- Modal Principal Genérico -->
    <div id="main-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h3 id="modal-title">Aviso</h3>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <!-- Modal da IA -->
    <div id="ai-chat-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h3>Fale com a IA da Galvão Drones</h3>
            <div id="ai-chat-modal-body">
                <div class="input-group">
                    <label for="ai-question-input">Qual a sua pergunta?</label>
                    <textarea id="ai-question-input" rows="4" placeholder="Ex: Quais as principais diferenças entre o DJI Mini 4 Pro e o Air 3S?"></textarea>
                </div>
                <button id="submit-ai-question" class="action-button">Enviar Pergunta</button>
                <div class="loader" style="display: none;"></div>
                <div id="ai-response-area" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Senha do Fornecedor -->
    <div id="supplier-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="supplier-password-close-button">×</span>
            <h3>Acesso Restrito</h3>
            <p>Por favor, digite a senha para acessar as informações de fornecedores:</p>
            <div class="input-group">
                <input type="password" id="supplier-access-password" placeholder="Digite a senha">
            </div>
            <button id="submit-supplier-password" class="action-button">Acessar</button>
            <p id="supplier-password-error" class="error-message">Senha incorreta.</p>
        </div>
    </div>

    <!-- Modal de Alteração de Senha -->
    <div id="change-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="change-password-close-button">×</span>
            <h3 id="change-password-modal-title">Alterar Senha</h3>
            <p id="change-password-message">Por favor, defina uma nova senha para sua conta.</p>
            <div class="input-group">
                <label for="new-password">Nova Senha (mín. 6 dígitos)</label>
                <input type="password" id="new-password">
            </div>
            <div class="input-group">
                <label for="confirm-new-password">Confirmar Nova Senha</label>
                <input type="password" id="confirm-new-password">
            </div>
            <button id="submit-change-password" class="action-button">Salvar Nova Senha</button>
            <p id="change-password-error" class="error-message">Senhas não conferem ou são muito curtas.</p>
            <p id="change-password-success" class="success-message">Senha alterada com sucesso!</p>
        </div>
    </div>
    
    <!-- Modal de Mensagem WhatsApp -->
    <div id="whatsapp-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="whatsapp-close-button">×</span>
            <h3>Personalizar Mensagem do WhatsApp</h3>
            <textarea id="whatsapp-message-input"></textarea>
            <div class="profile-info-options">
                <h4>Incluir Informações do Perfil:</h4>
                <label>
                    <input type="checkbox" id="include-display-name"> Nome de Exibição (<span id="whatsapp-display-name-preview"></span>)
                </label>
                <label>
                    <input type="checkbox" id="include-email"> Email (<span id="whatsapp-email-preview"></span>)
                </label>
                <label>
                    <input type="checkbox" id="include-phone"> Celular para Atendimento (<span id="whatsapp-phone-preview"></span>)
                </label>
            </div>
            <div class="action-button-group">
                <button id="send-whatsapp-button" class="action-button whatsapp-button">Enviar via WhatsApp</button>
                <button id="cancel-whatsapp-button" class="action-button cancel-button">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- NOVO: Modal para Solicitação de Orçamento -->
    <div id="budget-request-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="budget-request-close-button">×</span>
            <h3>Solicitar Orçamento</h3>
            
            <!-- Etapa 1: Seleção de Tipo -->
            <div id="budget-step-1">
                <h4>Passo 1: O que você precisa?</h4>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="budget-type" value="PEÇAS"> Peças</label>
                    <label><input type="checkbox" name="budget-type" value="EQUIPAMENTOS"> Equipamentos</label>
                </div>
                <div id="budget-equip-options" class="sub-options">
                    <label><input type="checkbox" name="budget-equip-type" value="Consumer"> Consumer</label>
                    <label><input type="checkbox" name="budget-equip-type" value="Enterprise"> Enterprise</label>
                    <label><input type="checkbox" name="budget-equip-type" value="Agriculture"> Agriculture</label>
                </div>
                <div class="input-group" id="budget-details-container" style="display: none;">
                    <label for="budget-details-text">Descreva os itens e quantidades:</label>
                    <textarea id="budget-details-text" rows="5" placeholder="Ex: 2x Bateria para Mini 4 Pro (versão Combo), 1x DJI RC 2"></textarea>
                </div>
                <button id="budget-next-step-btn" class="action-button" style="width: auto;" disabled>Próximo</button>
            </div>

            <!-- Etapa 2: Lista de Fornecedores -->
            <div id="budget-step-2" style="display: none;">
                <h4>Passo 2: Selecione o fornecedor para enviar a solicitação</h4>
                <div id="budget-supplier-list">
                    <!-- Lista de fornecedores será populada pelo JS -->
                </div>
                <button id="budget-back-step-btn" class="action-button secondary" style="width: auto;">Voltar</button>
            </div>

            <!-- Etapa 3: Confirmação e Envio -->
            <div id="budget-step-3" style="display: none;">
                <h4>Passo 3: Revise a mensagem e suas informações</h4>
                <p>A seguinte mensagem será enviada para <strong id="budget-final-supplier-name"></strong>:</p>
                <textarea id="budget-final-message" rows="8"></textarea>
                <div class="checkbox-group final-info-checkboxes">
                    <h5>Adicionar minhas informações à mensagem:</h5>
                    <label><input type="checkbox" class="budget-user-info" data-type="address"> Endereço para envio</label>
                    <label><input type="checkbox" class="budget-user-info" data-type="cnpj"> CNPJ</label>
                    <label><input type="checkbox" class="budget-user-info" data-type="name" checked> Meu Nome (<span id="info-preview-name"></span>)</label>
                    <label><input type="checkbox" class="budget-user-info" data-type="whatsapp" checked> Meu WhatsApp (<span id="info-preview-whatsapp"></span>)</label>
                    <label><input type="checkbox" class="budget-user-info" data-type="email"> Meu E-mail (<span id="info-preview-email"></span>)</label>
                </div>
                <button id="budget-send-whatsapp-btn" class="action-button whatsapp-button" style="width: auto;">Confirmar e Enviar</button>
                <button id="budget-back-step-2-btn" class="action-button secondary" style="width: auto;">Voltar</button>
            </div>
        </div>
    </div>
<script>
    // --- VARIÁVEIS GLOBAIS E DADOS ---
    const currentYear = new Date().getFullYear(); 

    // Objeto de Usuários (sem alterações)
    const USERS = {
        'mikhaell': { password: 'mk0639', role: 'admin', type: 'permanent', firstLogin: false, displayName: 'Mikhaell Galvão', email: 'contato@galvaodrones.com.br', phone: '6236360668', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png', address: 'Rua 16, nº 304 – Setor Aeroviário, Goiânia – GO', cnpj: '60.102.179/0001-10' }, 
        'Maikhon':  { password: `mai${currentYear}`, role: 'admin', type: 'permanent', firstLogin: false, displayName: 'Maikhon', email: 'maikhon@galvaodrones.com.br', phone: '62987654321', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'Ryan':     { password: `rya${currentYear}`, role: 'admin', type: 'permanent', firstLogin: false, displayName: 'Ryan', email: 'ryan@galvaodrones.com.br', phone: '62912345678', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'Fineias':  { password: `fin${currentYear}`, role: 'seller', type: 'permanent', firstLogin: false, displayName: 'Fineias', email: 'fineias@galvaodrones.com.br', phone: '62998765432', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' }, 
        'Rafael':   { password: `raf${currentYear}`, role: 'seller', type: 'permanent', firstLogin: false, displayName: 'Rafael', email: 'rafael@galvaodrones.com.br', phone: '62991234567', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' }, 
        'Eduardo':  { password: `edu${currentYear}`, role: 'seller', type: 'permanent', firstLogin: true, displayName: 'Eduardo', email: 'eduardo@galvaodrones.com.br', phone: '62988881111', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' }, 
        'Afranio':  { password: `afr${currentYear}`, role: 'marketing', type: 'permanent', firstLogin: false, displayName: 'Afranio Marketing', email: 'afranio@galvaodrones.com.br', phone: '62988885555', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' }, 
        'mikhaellven': { password: `mik${currentYear}`, role: 'seller', type: 'permanent', firstLogin: true, displayName: 'Mikhaell Vendedor', email: 'mikhaell.ven@galvaodrones.com.br', phone: '62988882222', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' }, 
        'maikhonven':  { password: `mai${currentYear}`, role: 'seller', type: 'permanent', firstLogin: true, displayName: 'Maikhon Vendedor', email: 'maikhon.ven@galvaodrones.com.br', phone: '62988883333', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'ryanven':     { password: `rya${currentYear}`, role: 'seller', type: 'permanent', firstLogin: true, displayName: 'Ryan Vendedor', email: 'ryan.ven@galvaodrones.com.br', phone: '62988884444', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
    };
    const CONFIDENTIAL_CODE = '@0639'; 

    // ATUALIZAÇÃO: Adicionada a propriedade 'category' aos produtos para o filtro
    let PRODUCTS = [ 
        { id: 1, name: 'DJI Neo Standard', spec: '...', salePrice: 1900, category: 'Consumer', sources: [{ supplierName: 'Arroba Celulares', costPrice: 1340 }] },
        { id: 3, name: 'DJI Mini 3', spec: '...', salePrice: 3990, category: 'Consumer', sources: [{ supplierName: 'Arroba Celulares', costPrice: 2990 }] },
        { id: 64, name: 'DJI Mini 4 Pro', spec: '...', salePrice: 9000.00, category: 'Consumer', sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 6990.00 }] },
        { id: 67, name: 'DJI Avata 2', spec: '...', salePrice: 10590.00, category: 'Consumer', sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 7069.91 }] },
        { id: 39, name: 'DJI Mavic 3 Multispectral', spec: '...', salePrice: 44302.70, category: 'Agriculture', sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 31011.89 }] },
        { id: 40, name: 'DJI Mavic 3 Thermal', spec: '...', salePrice: 42533.55, category: 'Enterprise', sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 29773.48 }] },
        { id: 41, name: 'DJI Mavic 3 Enterprise', spec: '...', salePrice: 31474.83, category: 'Enterprise', sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 22032.38 }] },
        { id: 42, name: 'DJI Matrice 4T', spec: '...', salePrice: 61589.97, category: 'Enterprise', sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 43112.98 }] },
        // ... (restante da sua lista de produtos, adicione 'category' a cada um)
    ];

    // ATUALIZAÇÃO: Nova estrutura de fornecedores com múltiplos contatos e categorias
    let SUPPLIERS = [
        { 
            name: 'Arroba Celulares', 
            details: 'Aroba celulares é um dos principais distribuidores e centros de manutenção de eletrônicos no Brasil.', 
            payment: 'Aceitam pagamento a vista e parcelado em até 12x no cartão com taxas.', 
            products: 'DJI Mini, Osmo Mobile, Acessórios',
            categories: ['Consumer', 'Peças'],
            contacts: [
                { name: 'Contato Principal', role: 'Vendas', whatsapp: '5511999998888' }
            ]
        },
        { 
            name: 'DJI Grupo Multi', 
            details: 'Atuam desde 2012 no mercado de drones e fotografia. Grupo Multi é importador de drones e estabilizadores.', 
            payment: 'Aceitam pagamento a vista e parcelado em até 12x no cartão com taxas.', 
            products: 'DJI Mini, DJI Air, Osmo Action, Acessórios',
            categories: ['Consumer', 'Equipamentos', 'Peças'],
            contacts: [
                { name: 'Contato Principal', role: 'Vendas', whatsapp: '5521988887777' }
            ]
        },
        { 
            name: 'GoHobby Distribuidora de VANT LTDA', 
            details: 'A GoHobby é importadora exclusiva de drones profissionais e tecnologias anti-drone no Brasil.', 
            payment: 'Aceitam pagamento a vista e parcelado em até 12x no cartão com taxas.', 
            products: 'DJI Mavic, DJI Matrice, Linha Enterprise, Soluções Anti-drone',
            categories: ['Enterprise', 'Agriculture', 'Equipamentos', 'Peças'],
            contacts: [
                { name: 'Vendas Nacionais', role: 'Gerente', whatsapp: '5541977776666' }
            ]
        },
        {
            name: 'Agrobox Drones',
            details: 'Peças e Equipamentos para Agricultura.',
            location: 'Goiânia, Goiás.',
            payment: 'A combinar.',
            products: 'Peças e Equipamentos para Drones Agrícolas',
            categories: ['Agriculture', 'Equipamentos', 'Peças'],
            contacts: [
                { name: 'Frederico', role: 'Dono', whatsapp: '5562999999999' },
                { name: 'Marcos', role: 'Gerente', whatsapp: '5562999999998' },
                { name: 'Heverton', role: 'Vendedor', whatsapp: '5562999999997' }
            ]
        }
    ];

    const INSTALLMENT_RATES = { 1: 0.0309, 2: 0.0579, 3: 0.0609, 4: 0.0799, 5: 0.0809, 6: 0.0818, 7: 0.0949, 8: 0.0966, 9: 0.1037, 10: 0.1105, 11: 0.1227, 12: 0.1238 };

    // --- ELEMENTOS DO DOM (DECLARAÇÕES) ---
    // (As declarações de variáveis de elementos do DOM permanecem aqui)
    let loginScreen, appScreen, navToggleButton, navToggleButtonClose, navElement, headerElement, mainContent;
    let dronesFilterBtn, dronesFilterPopup, suppliersFilterBtn, suppliersFilterPopup;
    let requestBudgetBtn, budgetRequestModal, budgetRequestCloseBtn;
    let supplierList, droneVisitorList;
    // ... e todas as outras variáveis de elementos que você já tem
    

    // --- FUNÇÕES ---

    // Função para renderizar a lista de drones com opção de ordenação e filtro
    function renderDroneVisitorList(searchTerm = '', sortOption = 'alpha', filterOption = 'all') {
        const droneVisitorListEl = document.getElementById('drone-visitor-list');
        droneVisitorListEl.innerHTML = '';
        const lowerCaseSearchTerm = searchTerm.toLowerCase();

        let dronesToShow = PRODUCTS.filter(p => {
            const isDrone = p.category && (p.category === 'Consumer' || p.category === 'Enterprise' || p.category === 'Agriculture');
            const matchesSearch = p.name.toLowerCase().includes(lowerCaseSearchTerm) || p.spec.toLowerCase().includes(lowerCaseSearchTerm);
            const matchesFilter = filterOption === 'all' || p.category === filterOption;
            return isDrone && matchesSearch && matchesFilter;
        });

        // Ordenação
        switch (sortOption) {
            case 'alpha':
                dronesToShow.sort((a, b) => a.name.localeCompare(b.name));
                break;
            case 'price_asc':
                dronesToShow.sort((a, b) => a.salePrice - b.salePrice);
                break;
            case 'price_desc':
                dronesToShow.sort((a, b) => b.salePrice - a.salePrice);
                break;
        }

        if (dronesToShow.length === 0) {
            droneVisitorListEl.innerHTML = '<p>Nenhum drone encontrado com os critérios selecionados.</p>';
            return;
        }

        dronesToShow.forEach(product => {
            const droneCard = document.createElement('div');
            droneCard.className = 'card product-card';
            droneCard.dataset.productId = product.id;
            droneCard.innerHTML = `
                <h3>${product.name}</h3>
                <p class="product-spec"><strong>Especificações:</strong><br>${product.spec}</p>
                <p class="price" style="color: var(--secondary-color);">${product.salePrice > 0 ? product.salePrice.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) : 'Consultar valor'}</p>
                <div class="action-buttons-container">
                    <a href="https://wa.me/556236360668?text=${encodeURIComponent('Olá, gostaria de saber mais sobre o ' + product.name)}" target="_blank" class="action-button whatsapp-button" style="width: auto;">Consultar via WhatsApp</a>
                </div>
            `;
            droneVisitorListEl.appendChild(droneCard);
        });
    }

    // Função para renderizar fornecedores com nova estrutura
    function showSuppliers(sortOption = 'alpha') {
        const supplierListEl = document.getElementById('supplier-list');
        supplierListEl.innerHTML = '';

        let suppliersToShow = [...SUPPLIERS];

        if (sortOption === 'alpha') {
            suppliersToShow.sort((a, b) => a.name.localeCompare(b.name));
        }
        
        suppliersToShow.forEach(supplier => {
            const supplierCard = document.createElement('div');
            supplierCard.className = 'card supplier-card';
            
            let contactsHTML = '<p><strong>Contatos:</strong></p>';
            if (supplier.contacts && supplier.contacts.length > 0) {
                contactsHTML += supplier.contacts.map(contact => `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <span>${contact.name} - <em>${contact.role}</em></span>
                        <a href="https://wa.me/${contact.whatsapp}" target="_blank" class="contact-wpp-button">
                            <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16.75 13.96c.25.25.25.66 0 .91l-3.53 3.53c-.25.25-.66.25-.91 0s-.25-.66 0-.91l3.53-3.53c.25-.25.66-.25.91 0zm-8.84-8.84c-.25-.25-.66-.25-.91 0s-.25.66 0 .91l3.53 3.53c.25.25.66.25.91 0s.25-.66 0-.91L7.91 5.12z" opacity=".3"/><path d="M20.5 3.4A12.16 12.16 0 0012 2C6.48 2 2 6.48 2 12c0 1.85.41 3.58 1.17 5.11l-1.6 4.79 4.9-1.58A11.98 11.98 0 0012 22c5.52 0 10-4.48 10-10 0-2.61-.83-5-2.28-7l.03-.03zm-1.87 12.35c-.24-.12-1.42-.7-1.64-.78-.22-.08-.38-.12-.54.12-.16.24-.62.78-.76.94-.14.16-.28.18-.52.06-.24-.12-1.02-.38-1.94-1.2-.72-.64-1.2-1.44-1.34-1.68-.14-.24-.02-.38.1-.5.12-.12.26-.3.4-.4.12-.12.16-.2.24-.34.08-.14.04-.26-.02-.38-.06-.12-.54-1.3-.74-1.78-.2-.48-.4-.42-.54-.42-.14 0-.3 0-.46 0-.16 0-.42.06-.64.3-.22.24-.86.84-.86 2.04 0 1.2.88 2.36 1 2.52.12.16 1.76 2.68 4.26 3.76 2.5 1.08 2.5.72 2.96.68.46-.04 1.42-.58 1.62-1.14.2-.56.2-1.04.14-1.14-.06-.12-.22-.18-.46-.3z"/></svg>
                            WhatsApp
                        </a>
                    </div>
                `).join('');
            } else {
                contactsHTML += '<p>Nenhum contato cadastrado.</p>';
            }

            supplierCard.innerHTML = `
                <h3><strong data-supplier-name="${supplier.name}">${supplier.name}</strong></h3>
                <p><strong>Detalhes:</strong> ${supplier.details}</p>
                <p><strong>Local:</strong> ${supplier.location || 'Não informado'}</p>
                <div><strong>Pagamento:</strong><br>${supplier.payment.replace(/\n/g, '<br>')}</div>
                <p><strong>Produtos Principais:</strong> ${supplier.products}</p>
                ${contactsHTML}
            `;
            supplierListEl.appendChild(supplierCard);
        });
    }

    // Função para abrir/fechar pop-up de filtro
    function toggleFilterPopup(popupId) {
        const popup = document.getElementById(popupId);
        if (popup) {
            popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
        }
    }

    // --- FUNÇÕES PARA O NOVO FLUXO DE ORÇAMENTO ---

    let budgetData = {};

    function openBudgetModal() {
        const modal = document.getElementById('budget-request-modal');
        // Resetar para a primeira etapa
        document.getElementById('budget-step-1').style.display = 'block';
        document.getElementById('budget-step-2').style.display = 'none';
        document.getElementById('budget-step-3').style.display = 'none';

        // Limpar campos
        document.querySelectorAll('#budget-step-1 input[type="checkbox"]').forEach(cb => cb.checked = false);
        document.getElementById('budget-equip-options').style.display = 'none';
        document.getElementById('budget-details-container').style.display = 'none';
        document.getElementById('budget-details-text').value = '';
        document.getElementById('budget-next-step-btn').disabled = true;
        
        budgetData = {
            types: [],
            equipTypes: [],
            details: '',
            targetSupplier: null,
        };

        modal.style.display = 'block';
    }

    function handleBudgetTypeChange() {
        const equipOptions = document.getElementById('budget-equip-options');
        const detailsContainer = document.getElementById('budget-details-container');
        const nextBtn = document.getElementById('budget-next-step-btn');
        const pecasChecked = document.querySelector('input[value="PEÇAS"]').checked;
        const equipChecked = document.querySelector('input[value="EQUIPAMENTOS"]').checked;

        equipOptions.style.display = equipChecked ? 'block' : 'none';
        detailsContainer.style.display = (pecasChecked || equipChecked) ? 'block' : 'none';
        
        if (!equipChecked) {
             document.querySelectorAll('input[name="budget-equip-type"]').forEach(cb => cb.checked = false);
        }

        nextBtn.disabled = !(pecasChecked || equipChecked);
    }
    
    function getGreeting() {
        const hour = new Date().getHours();
        if (hour >= 5 && hour < 12) return "Bom dia";
        if (hour >= 12 && hour < 18) return "Boa tarde";
        return "Boa noite";
    }

    function generateBudgetMessage() {
        const detailsText = document.getElementById('budget-details-text').value;
        const userName = window.currentUser.displayName || 'Usuário';

        const greeting = getGreeting();

        let message = `${greeting}! Tudo bem?\n\n`;
        message += `Meu nome é ${userName}, sou da Galvão Drones. Gostaria de solicitar um orçamento para os seguintes itens, por favor:\n\n`;
        message += `--- LISTA DE ITENS ---\n`;
        message += `${detailsText}\n`;
        message += `---------------------\n\n`;
        message += `Agradeço a atenção e aguardo o retorno com os valores e o prazo para entrega.`;

        return message;
    }
    
    function goToBudgetStep2() {
        // Coleta de dados da Etapa 1
        budgetData.types = Array.from(document.querySelectorAll('input[name="budget-type"]:checked')).map(cb => cb.value);
        budgetData.equipTypes = Array.from(document.querySelectorAll('input[name="budget-equip-type"]:checked')).map(cb => cb.value);
        budgetData.details = document.getElementById('budget-details-text').value;

        if (budgetData.details.trim() === '') {
            alert('Por favor, descreva os itens que você precisa.');
            return;
        }

        // Lógica de filtro de fornecedores
        const relevantSuppliers = SUPPLIERS.filter(s => {
            const hasPecas = budgetData.types.includes('PEÇAS') && s.categories.includes('Peças');
            const hasEquip = budgetData.types.includes('EQUIPAMENTOS') && s.categories.includes('Equipamentos');
            
            if (!hasPecas && !hasEquip) return false;

            if (hasEquip && budgetData.equipTypes.length > 0) {
                 return budgetData.equipTypes.some(equipType => s.categories.includes(equipType));
            }
            
            return true;
        });

        // Popular lista de fornecedores
        const supplierListDiv = document.getElementById('budget-supplier-list');
        supplierListDiv.innerHTML = '';
        if (relevantSuppliers.length > 0) {
            relevantSuppliers.forEach(supplier => {
                supplier.contacts.forEach(contact => {
                    const btn = document.createElement('button');
                    btn.className = 'action-button';
                    btn.style.width = '100%';
                    btn.style.marginBottom = '10px';
                    btn.textContent = `Enviar para: ${contact.name} (${supplier.name})`;
                    btn.onclick = () => goToBudgetStep3(supplier, contact);
                    supplierListDiv.appendChild(btn);
                });
            });
        } else {
            supplierListDiv.innerHTML = '<p>Nenhum fornecedor encontrado para os critérios selecionados.</p>';
        }

        // Transição de telas
        document.getElementById('budget-step-1').style.display = 'none';
        document.getElementById('budget-step-2').style.display = 'block';
    }

    function goToBudgetStep3(supplier, contact) {
        budgetData.targetSupplier = { ...supplier, contact };
        
        document.getElementById('budget-final-supplier-name').textContent = `${contact.name} (${supplier.name})`;
        document.getElementById('budget-final-message').value = generateBudgetMessage();

        // Preencher previews das informações do usuário
        const user = window.currentUser;
        document.getElementById('info-preview-name').textContent = user.displayName || 'Não informado';
        document.getElementById('info-preview-whatsapp').textContent = user.phone || 'Não informado';
        document.getElementById('info-preview-email').textContent = user.email || 'Não informado';

        // Transição de telas
        document.getElementById('budget-step-2').style.display = 'none';
        document.getElementById('budget-step-3').style.display = 'block';
    }

    function sendBudgetToWhatsapp() {
        let finalMessage = document.getElementById('budget-final-message').value;
        const contactNumber = budgetData.targetSupplier.contact.whatsapp;
        const user = window.currentUser;

        let userInfoToAdd = "\n\n---\n*Minhas Informações para Contato:*\n";
        let infoAdded = false;

        document.querySelectorAll('.budget-user-info:checked').forEach(cb => {
            infoAdded = true;
            const type = cb.dataset.type;
            switch(type) {
                case 'address': userInfoToAdd += `*Endereço:* ${user.address || 'Não informado'}\n`; break;
                case 'cnpj': userInfoToAdd += `*CNPJ:* ${user.cnpj || 'Não informado'}\n`; break;
                case 'name': userInfoToAdd += `*Nome:* ${user.displayName || 'Não informado'}\n`; break;
                case 'whatsapp': userInfoToAdd += `*WhatsApp:* ${user.phone || 'Não informado'}\n`; break;
                case 'email': userInfoToAdd += `*E-mail:* ${user.email || 'Não informado'}\n`; break;
            }
        });

        if (infoAdded) {
            finalMessage += userInfoToAdd;
        }

        const encodedMessage = encodeURIComponent(finalMessage);
        const whatsappUrl = `https://wa.me/${contactNumber}?text=${encodedMessage}`;
        
        window.open(whatsappUrl, '_blank');
        document.getElementById('budget-request-modal').style.display = 'none';
    }


    // --- INICIALIZAÇÃO E EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', () => {
        // Atribuição de elementos do DOM (mantém as suas atribuições existentes)
        loginScreen = document.getElementById('login-screen');
        appScreen = document.getElementById('app-screen');
        // ...todas as outras atribuições...
        navToggleButton = document.getElementById('nav-toggle-btn');
        navToggleButtonClose = document.getElementById('nav-toggle-btn-close');
        navElement = document.querySelector('nav');
        
        dronesFilterBtn = document.getElementById('drones-filter-btn');
        dronesFilterPopup = document.getElementById('drones-filter-popup');
        suppliersFilterBtn = document.getElementById('suppliers-filter-btn');
        suppliersFilterPopup = document.getElementById('suppliers-filter-popup');
        
        requestBudgetBtn = document.getElementById('request-budget-btn');
        budgetRequestModal = document.getElementById('budget-request-modal');
        budgetRequestCloseBtn = document.getElementById('budget-request-close-button');


        // --- EVENT LISTENERS (adicionar/modificar) ---

        // Lógica de Login e Logout (mantém a existente)
        document.getElementById('login-button').addEventListener('click', handleLogin);
        document.getElementById('logout-button').addEventListener('click', handleLogout);
        
        // NOVO: Lógica do Menu Hambúrguer
        navToggleButton.addEventListener('click', () => navElement.classList.add('nav-open'));
        navToggleButtonClose.addEventListener('click', () => navElement.classList.remove('nav-open'));

        // NOVO: Lógica dos Filtros
        dronesFilterBtn.addEventListener('click', () => toggleFilterPopup('drones-filter-popup'));
        suppliersFilterBtn.addEventListener('click', () => toggleFilterPopup('suppliers-filter-popup'));

        dronesFilterPopup.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const sort = e.target.dataset.sort;
                const filter = e.target.dataset.filter;
                renderDroneVisitorList(document.getElementById('drone-visitor-search').value, sort, filter);
                toggleFilterPopup('drones-filter-popup');
            }
        });
        
        suppliersFilterPopup.addEventListener('click', (e) => {
             if (e.target.tagName === 'BUTTON') {
                const sort = e.target.dataset.sort;
                showSuppliers(sort);
                toggleFilterPopup('suppliers-filter-popup');
            }
        });

        // Fechar pop-ups de filtro ao clicar fora
        window.addEventListener('click', (e) => {
            if (!dronesFilterBtn.contains(e.target) && !dronesFilterPopup.contains(e.target)) {
                dronesFilterPopup.style.display = 'none';
            }
            if (!suppliersFilterBtn.contains(e.target) && !suppliersFilterPopup.contains(e.target)) {
                suppliersFilterPopup.style.display = 'none';
            }
             if (e.target == budgetRequestModal) {
                budgetRequestModal.style.display = "none";
            }
        });

        // NOVO: Lógica do Orçamento
        requestBudgetBtn.addEventListener('click', openBudgetModal);
        budgetRequestCloseBtn.addEventListener('click', () => budgetRequestModal.style.display = 'none');
        document.querySelectorAll('input[name="budget-type"]').forEach(cb => {
            cb.addEventListener('change', handleBudgetTypeChange);
        });
        document.getElementById('budget-next-step-btn').addEventListener('click', goToBudgetStep2);
        document.getElementById('budget-back-step-btn').addEventListener('click', () => {
             document.getElementById('budget-step-2').style.display = 'none';
             document.getElementById('budget-step-1').style.display = 'block';
        });
        document.getElementById('budget-back-step-2-btn').addEventListener('click', () => {
             document.getElementById('budget-step-3').style.display = 'none';
             document.getElementById('budget-step-2').style.display = 'block';
        });
        document.getElementById('budget-send-whatsapp-btn').addEventListener('click', sendBudgetToWhatsapp);
        
        // Inicializa a renderização das seções principais
        renderDroneVisitorList();
        showSuppliers();
        // ...chamar outras funções de renderização inicial se necessário

        // Lembre-se de manter todos os seus outros event listeners existentes
        // ... (todo o resto do seu código de event listeners)
    });

    // --- MANTER TODAS AS SUAS OUTRAS FUNÇÕES ---
    // (handleLogin, handleLogout, setupAppForUser, switchTab, renderProducts, calculate, etc.)
    // ... cole aqui o restante de todas as suas funções JavaScript que não foram modificadas.
    // É crucial que elas permaneçam para o portal continuar funcionando.
</script>
