<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Galvão Drones</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-orange': '#EF7E13',
                        'brand-green': '#0E5847',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #EF7E13; animation: spin 1s ease infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .sidebar-link.active { background-color: #e5e7eb; color: #1f2937; }
        .dark .sidebar-link.active { background-color: #374151; color: #f9fafb; }
        .modal-tab.active { border-color: #EF7E13; color: #EF7E13; }
        #calculator-popup::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 20px;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }
        .dark #calculator-popup::after {
            border-top-color: #1f2937; /* gray-800 */
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900">

    <!-- TELA DE LOGIN -->
    <div id="login-view" class="flex items-center justify-center min-h-screen">
        <div id="login-card" class="w-full max-w-md p-8 space-y-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg">
            <div id="login-header" class="text-center">
                <div class="mx-auto mb-4 h-16 w-16 text-brand-green dark:text-brand-orange"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-full h-full"><path d="M12.0006 10.25C11.0341 10.25 10.2506 11.0335 10.2506 12C10.2506 12.9665 11.0341 13.75 12.0006 13.75C12.9671 13.75 13.7506 12.9665 13.7506 12C13.7506 11.0335 12.9671 10.25 12.0006 10.25Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12ZM12.0006 8.5C10.0676 8.5 8.50061 10.067 8.50061 12C8.50061 13.933 10.0676 15.5 12.0006 15.5C13.9336 15.5 15.5006 13.933 15.5006 12C15.5006 10.067 13.9336 8.5 12.0006 8.5ZM5.75 12C5.75 11.5858 5.41421 11.25 5 11.25H3C2.58579 11.25 2.25 11.5858 2.25 12C2.25 12.4142 2.58579 12.75 3 12.75H5C5.41421 12.75 5.75 12.4142 5.75 12ZM21 11.25H19C18.5858 11.25 18.25 11.5858 18.25 12C18.25 12.4142 18.5858 12.75 19 12.75H21C21.4142 12.75 21.75 12.4142 21.75 12C21.75 11.5858 21.4142 11.25 21 11.25ZM12 5.75C12.4142 5.75 12.75 5.41421 12.75 5V3C12.75 2.58579 12.4142 2.25 12 2.25C11.5858 2.25 11.25 2.58579 11.25 3V5C11.25 5.41421 11.5858 5.75 12 5.75ZM12 21.75C12.4142 21.75 12.75 21.4142 12.75 21V19C12.75 18.5858 12.4142 18.25 12 18.25C11.5858 18.25 11.25 18.5858 11.25 19V21C11.25 21.4142 11.5858 21.75 12 21.75Z"></path></svg></div>
                <h1 class="text-2xl font-bold text-brand-green dark:text-gray-100">Portal Galvão Drones</h1>
                <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Selecione um perfil para acessar</p>
            </div>
            <div id="button-login-container" class="space-y-4 pt-4">
                <button data-username="mikhaell" class="login-button group relative flex w-full justify-center rounded-lg border border-transparent bg-brand-green py-3 px-4 text-sm font-semibold text-white hover:bg-green-700">Acessar como Administrador</button>
                <button data-username="vendas" class="login-button group relative flex w-full justify-center rounded-lg border border-transparent bg-brand-orange py-3 px-4 text-sm font-semibold text-white hover:bg-orange-600">Acessar como Vendedor</button>
                <button data-username="market" class="login-button group relative flex w-full justify-center rounded-lg border border-transparent bg-blue-600 py-3 px-4 text-sm font-semibold text-white hover:bg-blue-700">Acessar como Marketing</button>
                <button data-username="consultas" class="login-button group relative flex w-full justify-center rounded-lg border border-transparent bg-gray-500 py-3 px-4 text-sm font-semibold text-white hover:bg-gray-600">Acessar como Consulta</button>
            </div>
            <div id="error-message" class="hidden p-4 mt-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert"><span class="font-medium">Erro de Acesso:</span> Usuário inválido.</div>
            <div id="success-message" class="hidden text-center">
                <div class="spinner mx-auto"></div>
                <p class="mt-4 font-semibold text-lg text-brand-green dark:text-gray-200">Login bem-sucedido!</p>
                <p class="text-gray-600 dark:text-gray-400">Redirecionando...</p>
            </div>
        </div>
    </div>

    <!-- TELA DO DASHBOARD -->
    <div id="dashboard-view" class="hidden">
        <div class="flex h-screen bg-gray-100 dark:bg-gray-900">
            <div id="sidebar-menu" class="fixed inset-y-0 left-0 w-64 bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-200 ease-in-out z-30 flex flex-col">
                <div class="flex items-center justify-center h-20 border-b dark:border-gray-700 px-4">
                    <a href="#" data-page="perfil" class="sidebar-link flex items-center w-full">
                        <div id="sidebar-profile-picture" class="w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-700 bg-cover bg-center flex-shrink-0 flex items-center justify-center">
                            <span id="sidebar-profile-placeholder" class="text-xs text-gray-500">Foto</span>
                        </div>
                        <div class="ml-3 overflow-hidden">
                            <p id="sidebar-user-name" class="font-semibold text-sm text-gray-800 dark:text-white truncate"></p>
                            <p id="sidebar-user-role" class="text-xs text-gray-500 dark:text-gray-400 truncate"></p>
                        </div>
                    </a>
                </div>
                <nav id="sidebar-nav" class="flex-1 px-2 py-4 space-y-1">
                    <a href="#" data-page="dashboard" class="sidebar-link active flex items-center px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg><span class="font-medium">Dashboard</span></a>
                    <a href="#" data-page="consultas" class="sidebar-link flex items-center px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg><span class="font-medium">Consultas</span></a>
                    <a href="#" data-page="drones" class="sidebar-link flex items-center px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg><span class="font-medium">Drones</span></a>
                    <a href="#" data-page="marketing" class="sidebar-link flex items-center px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-2.236 9.168-5.584C18.354 5.166 18 6.545 18 8c0 3.314-2.686 6-6 6H6.636A3.991 3.991 0 015.436 13.683z" /></svg><span class="font-medium">Marketing</span></a>
                    <a href="#" data-page="produtos" class="sidebar-link flex items-center px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg><span class="font-medium">Produtos</span></a>
                    <div class="pt-2 mt-auto border-t border-gray-200 dark:border-gray-700">
                        <a href="#" data-page="perfil" class="sidebar-link flex items-center px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg><span class="font-medium">Meu Perfil</span></a>
                        <a href="#" data-page="admin" id="admin-link" class="sidebar-link hidden flex items-center px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg><span class="font-medium">Administração</span></a>
                        <a href="#" data-page="sobre" class="sidebar-link flex items-center px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><span class="font-medium">Sobre Galvão Drones</span></a>
                    </div>
                </nav>
            </div>

            <!-- Conteúdo Principal -->
            <div class="flex flex-col flex-1 overflow-y-auto">
                <div class="flex items-center justify-between h-20 px-6 bg-white dark:bg-gray-800 border-b dark:border-gray-700">
                    <button id="menu-button" class="md:hidden text-gray-600 dark:text-gray-300 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                    <h1 id="page-title" class="text-2xl font-semibold text-gray-800 dark:text-white">Dashboard</h1>
                    <button id="logout-button" class="px-4 py-2 text-sm font-medium text-white bg-brand-orange rounded-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-orange">Sair</button>
                </div>
                <div id="main-content" class="p-6">
                    <div id="dashboard-page" class="page-content">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h2 class="text-xl font-bold text-gray-800 dark:text-white">Bem-vindo(a), <span id="welcome-user-name">Usuário</span>!</h2>
                            <p class="mt-1 text-gray-600 dark:text-gray-400">Seu perfil de acesso é: <span id="welcome-user-role" class="font-semibold">Indefinido</span>.</p>
                        </div>
                        <div id="vendedor-content" class="hidden mt-6"><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow"><h3 class="text-lg font-bold text-brand-green dark:text-brand-orange">Painel do Vendedor</h3><p class="mt-2 text-gray-600 dark:text-gray-400">Acesse aqui suas ferramentas de vendas, consulte o status de clientes e registre novas propostas.</p></div></div>
                    </div>
                    <div id="admin-page" class="page-content hidden">
                        <div class="mb-6"><h2 class="text-2xl font-bold text-gray-800 dark:text-white">Configurações do Sistema</h2><p class="mt-1 text-gray-600 dark:text-gray-400">Selecione uma opção de configuração no menu lateral, ou clique nos atalhos abaixo:</p></div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <a href="#" id="manage-users-button" class="block bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow"><h3 class="text-lg font-bold text-brand-orange">Gerir Usuários</h3><p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Crie e gerencie acessos temporários.</p></a>
                            <a href="#" id="manage-products-button" class="block bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow"><h3 class="text-lg font-bold text-brand-orange">Gerir Produtos</h3><p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Adicione ou edite produtos do sistema.</p></a>
                            <a href="#" id="manage-suppliers-button" class="block bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow"><h3 class="text-lg font-bold text-brand-orange">Gerir Fornecedores</h3><p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Cadastre e edite fornecedores.</p></a>
                        </div>
                    </div>
                    <!-- Drones Page Content -->
                    <div id="drones-page" class="page-content hidden">
                        <div class="mb-6">
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Catálogo de Drones</h2>
                            <p class="mt-1 text-gray-600 dark:text-gray-400">Explore nossa linha completa de drones e acessórios.</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4 mb-6">
                            <div class="relative flex-grow">
                                <input type="text" id="drones-search-input" placeholder="Buscar drones ou acessórios..." class="w-full rounded-md border-gray-300 shadow-sm pl-10 pr-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                                </div>
                            </div>
                            <button id="drones-search-button" class="bg-brand-green text-white px-4 py-2 rounded-md hover:bg-green-700">Buscar</button>
                            <div class="relative">
                                <button id="drones-filter-button" class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 flex items-center justify-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V19l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" /></svg>
                                    Filtrar
                                </button>
                                <div id="drones-filter-panel" class="absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 hidden z-10">
                                    <h4 class="font-semibold text-gray-800 dark:text-white mb-2">Preço</h4>
                                    <div class="flex gap-2 mb-4">
                                        <input type="number" id="drones-min-price" placeholder="Min" class="w-1/2 rounded-md border-gray-300 shadow-sm text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <input type="number" id="drones-max-price" placeholder="Max" class="w-1/2 rounded-md border-gray-300 shadow-sm text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-white mb-2">Ordenar por</h4>
                                    <div class="space-y-1 text-sm">
                                        <div><label class="flex items-center"><input type="radio" name="drones-sort" value="alpha-asc" class="rounded text-brand-orange"> <span class="ml-2 dark:text-gray-300">Nome (A-Z)</span></label></div>
                                        <div><label class="flex items-center"><input type="radio" name="drones-sort" value="alpha-desc" class="rounded text-brand-orange"> <span class="ml-2 dark:text-gray-300">Nome (Z-A)</span></label></div>
                                        <div><label class="flex items-center"><input type="radio" name="drones-sort" value="price-asc" class="rounded text-brand-orange"> <span class="ml-2 dark:text-gray-300">Preço (Menor)</span></label></div>
                                        <div><label class="flex items-center"><input type="radio" name="drones-sort" value="price-desc" class="rounded text-brand-orange"> <span class="ml-2 dark:text-gray-300">Preço (Maior)</span></label></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="drones-search-results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Product cards will be rendered here -->
                        </div>
                    </div>
                    <!-- Consultas Page Content -->
                    <div id="consultas-page" class="page-content hidden">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h2 class="text-xl font-bold text-brand-green dark:text-brand-orange">Página de Consultas</h2>
                            <p class="mt-2 text-gray-600 dark:text-gray-400">Aqui você pode realizar consultas rápidas sobre produtos e serviços.</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4 mb-6 mt-6">
                            <div class="relative flex-grow">
                                <input type="text" id="consultas-search-input" placeholder="Buscar consultas ou produtos..." class="w-full rounded-md border-gray-300 shadow-sm pl-10 pr-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                                </div>
                            </div>
                            <button id="consultas-search-button" class="bg-brand-green text-white px-4 py-2 rounded-md hover:bg-green-700">Buscar</button>
                            <div class="relative">
                                <button id="consultas-filter-button" class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 flex items-center justify-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V19l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" /></svg>
                                    Filtrar
                                </button>
                                <div id="consultas-filter-panel" class="absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 hidden z-10">
                                    <h4 class="font-semibold text-gray-800 dark:text-white mb-2">Preço</h4>
                                    <div class="flex gap-2 mb-4">
                                        <input type="number" id="consultas-min-price" placeholder="Min" class="w-1/2 rounded-md border-gray-300 shadow-sm text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <input type="number" id="consultas-max-price" placeholder="Max" class="w-1/2 rounded-md border-gray-300 shadow-sm text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-white mb-2">Ordenar por</h4>
                                    <div class="space-y-1 text-sm">
                                        <div><label class="flex items-center"><input type="radio" name="consultas-sort" value="alpha-asc" class="rounded text-brand-orange"> <span class="ml-2 dark:text-gray-300">Nome (A-Z)</span></label></div>
                                        <div><label class="flex items-center"><input type="radio" name="consultas-sort" value="alpha-desc" class="rounded text-brand-orange"> <span class="ml-2 dark:text-gray-300">Nome (Z-A)</span></label></div>
                                        <div><label class="flex items-center"><input type="radio" name="consultas-sort" value="price-asc" class="rounded text-brand-orange"> <span class="ml-2 dark:text-gray-300">Preço (Menor)</span></label></div>
                                        <div><label class="flex items-center"><input type="radio" name="consultas-sort" value="price-desc" class="rounded text-brand-orange"> <span class="ml-2 dark:text-gray-300">Preço (Maior)</span></label></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="consultas-search-results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Product cards will be rendered here -->
                        </div>
                    </div>
                    <!-- Marketing Page Content -->
                    <div id="marketing-page" class="page-content hidden">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h2 class="text-xl font-bold text-brand-green dark:text-brand-orange">Painel de Marketing</h2>
                            <p class="mt-2 text-gray-600 dark:text-gray-400">Gerencie campanhas, crie conteúdo e analise métricas de marketing.</p>
                            <!-- Adicione mais conteúdo específico para marketing aqui -->
                        </div>
                    </div>
                    <div id="perfil-page" class="page-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-1">
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow text-center">
                                    <div id="profile-picture-container" class="relative w-32 h-32 mx-auto rounded-full bg-gray-200 dark:bg-gray-700 mb-4 cursor-pointer bg-cover bg-center flex items-center justify-center">
                                        <span id="profile-picture-placeholder" class="text-gray-500">Adicionar Foto</span>
                                    </div>
                                    <input type="file" id="profile-picture-input" class="hidden" accept="image/*">
                                    <h3 id="profile-page-name" class="text-xl font-bold text-gray-800 dark:text-white"></h3>
                                    <p id="profile-page-role" class="text-sm text-gray-500 dark:text-gray-400"></p>
                                    <button id="profile-share-button" class="mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-brand-orange border border-brand-orange rounded-md hover:bg-orange-50 dark:hover:bg-gray-700 focus:outline-none">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" /></svg>
                                        <span>Compartilhar Contato</span>
                                    </button>
                                </div>
                            </div>
                            <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                                <div class="space-y-4">
                                    <div><h4 class="text-lg font-bold text-brand-green dark:text-brand-orange border-b pb-2">Meus Dados</h4></div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div><label class="block text-sm font-medium">Nome</label><input type="text" id="profile-firstname" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                                        <div><label class="block text-sm font-medium">Sobrenome</label><input type="text" id="profile-lastname" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                                    </div>
                                    <div><label class="block text-sm font-medium">Nome de Usuário</label><input type="text" id="profile-username" readonly class="mt-1 w-full rounded-md border-gray-300 shadow-sm bg-gray-100 dark:bg-gray-700"></div>
                                    <div><label class="block text-sm font-medium">WhatsApp</label><input type="tel" id="profile-whatsapp" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                                    
                                    <div class="pt-4"><h4 class="text-lg font-bold text-brand-green dark:text-brand-orange border-b pb-2">Dados da Empresa</h4></div>
                                    <div><label class="block text-sm font-medium">CNPJ</label><input type="text" id="company-cnpj" readonly class="mt-1 w-full rounded-md border-gray-300 shadow-sm bg-gray-100 dark:bg-gray-700"></div>
                                    <div><label class="block text-sm font-medium">Endereço</label><input type="text" id="company-address" readonly class="mt-1 w-full rounded-md border-gray-300 shadow-sm bg-gray-100 dark:bg-gray-700"></div>
                                    <div><label class="block text-sm font-medium">Telefone</label><div class="flex items-center"><input type="text" id="company-phone" readonly class="mt-1 w-full rounded-l-md border-gray-300 shadow-sm bg-gray-100 dark:bg-gray-700"><button id="company-whatsapp-button" class="bg-green-500 text-white p-2 rounded-r-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.487 5.235 3.487 8.413C23.948 18.661 18.614 24 .057 24zM7.51 18.385l.331.195c1.866 1.099 4.041 1.742 6.331 1.742 5.207 0 9.46-4.252 9.461-9.46S19.378 1.42 14.171 1.42c-2.533 0-4.903.995-6.696 2.789-1.793 1.793-2.787 4.163-2.787 6.696.001 2.163.574 4.298 1.695 6.151l.215.36.004.004-1.677 6.124z"></path></svg></button></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="sobre-page" class="page-content hidden">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h2 class="text-2xl font-bold text-brand-green dark:text-brand-orange border-b-2 border-brand-orange pb-2 mb-4">Sobre a Galvão Drones</h2>
                            <div class="space-y-4 text-gray-700 dark:text-gray-300">
                                <div>
                                    <h3 class="font-semibold text-lg">Nossa Missão</h3>
                                    <p>Oferecer as mais avançadas soluções em tecnologia de drones, capacitando profissionais e empresas a atingirem novos patamares de eficiência, segurança e inovação.</p>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-lg">Nossa Visão</h3>
                                    <p>Ser a referência nacional em vendas, manutenção e treinamento de drones, reconhecida pela excelência técnica, atendimento personalizado e por impulsionar o mercado de VANTs no Brasil.</p>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-lg">Nossos Valores</h3>
                                    <ul class="list-disc list-inside ml-4">
                                        <li><b>Inovação:</b> Busca contínua por tecnologias de ponta.</li>
                                        <li><b>Qualidade:</b> Compromisso com a excelência em produtos e serviços.</li>
                                        <li><b>Segurança:</b> Prioridade máxima em todas as operações e treinamentos.</li>
                                        <li><b>Conhecimento:</b> Capacitação e disseminação de informações técnicas precisas.</li>
                                        <li><b>Parceria:</b> Construção de relacionamentos sólidos e de confiança com clientes e fornecedores.</li>
                                    </ul>
                                </div>
                                <div class="mt-6 pt-4 border-t dark:border-gray-700 flex flex-wrap gap-4 justify-center">
                                    <a href="https://wa.me/556236360668" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.487 5.235 3.487 8.413C23.948 18.661 18.614 24 .057 24zM7.51 18.385l.331.195c1.866 1.099 4.041 1.742 6.331 1.742 5.207 0 9.46-4.252 9.461-9.46S19.378 1.42 14.171 1.42c-2.533 0-4.903.995-6.696 2.789-1.793 1.793-2.787 4.163-2.787 6.696.001 2.163.574 4.298 1.695 6.151l.215.36.004.004-1.677 6.124z"></path></svg>
                                        <span>WhatsApp</span>
                                    </a>
                                    <a href="https://www.instagram.com/galvao_drones" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                                        <span>Instagram</span>
                                    </a>
                                    <a href="https://www.youtube.com/@Galv%C3%A3oDronesofc" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
                                        <span>YouTube</span>
                                    </a>
                                    <a href="https://www.google.com/maps/search/?api=1&query=Galvão+Drones" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                                        <span>Rotas</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL GERIR USUÁRIOS -->
    <div id="user-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl relative max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
                <div class="flex border-b border-gray-200 dark:border-gray-700">
                    <button id="create-user-tab" class="modal-tab py-2 px-4 border-b-2 font-medium text-sm">Criar Novo Usuário</button>
                    <button id="edit-user-tab" class="modal-tab py-2 px-4 border-b-2 font-medium text-sm hidden">Alterar Usuário</button>
                </div>
                <button id="close-user-modal" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white text-2xl">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <div id="user-form-container">
                    <form id="create-user-form" class="space-y-4">
                        <div><label for="new-user-name" class="block text-sm font-medium">Nome</label><input type="text" id="new-user-name" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="new-user-username" class="block text-sm font-medium">Nome de Usuário</label><input type="text" id="new-user-username" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="new-user-password" class="block text-sm font-medium">Senha</label><input type="text" id="new-user-password" readonly class="mt-1 w-full rounded-md border-gray-300 shadow-sm bg-gray-100"></div>
                        <div><label for="new-user-phone" class="block text-sm font-medium">Telefone (WhatsApp)</label><input type="tel" id="new-user-phone" placeholder="Ex: 62912345678" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="new-user-type" class="block text-sm font-medium">Tipo de Usuário</label><select id="new-user-type" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option>Vendedor</option><option>Market</option><option>Consultas</option><option>Administrador</option></select></div>
                        <div id="validity-container" class="hidden"><label for="new-user-validity" class="block text-sm font-medium">Validade do Acesso</label><select id="new-user-validity" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="7">7 dias</option><option value="15">15 dias</option><option value="30">30 dias</option></select></div>
                        <button type="submit" class="w-full bg-brand-orange text-white py-2 rounded-md hover:bg-orange-600">Criar Usuário</button>
                    </form>
                </div>
                <div id="invite-container" class="hidden text-center">
                    <h3 class="text-lg font-bold text-brand-green dark:text-brand-orange mb-4">Usuário Criado com Sucesso!</h3>
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-md mb-4 text-left">
                        <p><strong>Usuário:</strong> <span id="invite-username"></span></p>
                        <p><strong>Senha:</strong> <span id="invite-password"></span></p>
                    </div>
                    <button id="send-invite-button" class="w-full flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-white bg-green-500 rounded-md hover:bg-green-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.487 5.235 3.487 8.413C23.948 18.661 18.614 24 .057 24zM7.51 18.385l.331.195c1.866 1.099 4.041 1.742 6.331 1.742 5.207 0 9.46-4.252 9.461-9.46S19.378 1.42 14.171 1.42c-2.533 0-4.903.995-6.696 2.789-1.793 1.793-2.787 4.163-2.787 6.696.001 2.163.574 4.298 1.695 6.151l.215.36.004.004-1.677 6.124z"></path></svg><span>Enviar Convite</span></button>
                </div>
                <div id="user-list-container" class="hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white dark:bg-gray-800">
                            <thead class="bg-gray-50 dark:bg-gray-700"><tr><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuário</th><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th></tr></thead>
                            <tbody id="user-list-tbody" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                        </table>
                    </div>
                </div>
                <div id="edit-user-form-container" class="hidden">
                    <form id="edit-user-form" class="space-y-4">
                        <input type="hidden" id="edit-user-index">
                        <div><label for="edit-user-name" class="block text-sm font-medium">Nome</label><input type="text" id="edit-user-name" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="edit-user-username" class="block text-sm font-medium">Nome de Usuário</label><input type="text" id="edit-user-username" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="edit-user-phone" class="block text-sm font-medium">Telefone (WhatsApp)</label><input type="tel" id="edit-user-phone" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="edit-user-type" class="block text-sm font-medium">Tipo de Usuário</label><select id="edit-user-type" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option>Vendedor</option><option>Market</option><option>Consultas</option><option>Administrador</option></select></div>
                        <div class="flex gap-4 pt-4"><button type="submit" class="w-full bg-brand-green text-white py-2 rounded-md hover:bg-green-700">Salvar Alterações</button><button type="button" id="cancel-edit-button" class="w-full bg-gray-500 text-white py-2 rounded-md hover:bg-gray-600">Cancelar</button></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL GERIR PRODUTOS -->
    <div id="product-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl relative max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
                    <div class="flex border-b border-gray-200 dark:border-gray-700">
                        <button id="create-product-tab" class="modal-tab py-2 px-4 border-b-2 font-medium text-sm">Criar Produto</button>
                        <button id="list-product-tab" class="modal-tab py-2 px-4 border-b-2 font-medium text-sm">Listar Produtos</button>
                    </div>
                <button id="close-product-modal" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white text-2xl">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <div id="create-product-container">
                    <form id="product-form" class="space-y-4">
                        <input type="hidden" id="edit-product-index">
                        <div><label for="product-id" class="block text-sm font-medium">ID do produto</label><input type="text" id="product-id" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="product-name" class="block text-sm font-medium">Nome do produto</label><input type="text" id="product-name" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="product-spec" class="block text-sm font-medium">Especificação</label><textarea id="product-spec" rows="3" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></textarea></div>
                        <div><label for="product-price" class="block text-sm font-medium">Preço de venda</label><input type="number" step="0.01" id="product-price" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div id="product-supplier-fields-container" class="space-y-4 pt-2">
                            <div class="p-3 border rounded-md border-gray-200 dark:border-gray-600"><label class="block text-sm font-medium mb-2">Fornecedor 1</label><div class="grid grid-cols-2 gap-4"><div><label for="product-supplier-name-1" class="block text-xs font-medium">Fornecedor</label><input type="text" id="product-supplier-name-1" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div><div><label for="product-supplier-cost-1" class="block text-xs font-medium">Preço de custo</label><input type="number" step="0.01" id="product-supplier-cost-1" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div></div></div>
                        </div>
                        <button type="button" id="add-product-supplier-button" class="w-full text-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600">+ Adicionar Fornecedor</button>
                        <div class="flex gap-4 pt-4">
                            <button type="submit" class="w-full bg-brand-orange text-white py-2 rounded-md hover:bg-orange-600">Salvar Produto</button>
                            <button type="button" id="cancel-product-edit-button" class="w-full bg-gray-500 text-white py-2 rounded-md hover:bg-gray-600 hidden">Cancelar</button>
                        </div>
                    </form>
                </div>
                <div id="product-list-container" class="hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white dark:bg-gray-800">
                            <thead class="bg-gray-50 dark:bg-gray-700"><tr><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Preço</th><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th></tr></thead>
                            <tbody id="product-list-tbody" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL GERIR FORNECEDORES -->
    <div id="supplier-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-3xl relative max-h-[90vh] flex flex-col">
                <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
                    <div class="flex border-b border-gray-200 dark:border-gray-700">
                        <button id="create-supplier-tab" class="modal-tab py-2 px-4 border-b-2 font-medium text-sm">Criar Fornecedor</button>
                        <button id="list-supplier-tab" class="modal-tab py-2 px-4 border-b-2 font-medium text-sm">Listar Fornecedores</button>
                    </div>
                    <button id="close-supplier-modal" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white text-2xl">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto">
                    <div id="create-supplier-container">
                        <form id="supplier-form" class="space-y-4">
                            <input type="hidden" id="edit-supplier-index">
                            <div><label for="supplier-name" class="block text-sm font-medium">Nome do Fornecedor</label><input type="text" id="supplier-name" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                            <div><label for="supplier-address" class="block text-sm font-medium">Endereço</label><input type="text" id="supplier-address" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></div>
                            <div><label for="supplier-details" class="block text-sm font-medium">Detalhes</label><textarea id="supplier-details" rows="2" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></textarea></div>
                            <div>
                                <label class="block text-sm font-medium">Formas de Pagamento</label>
                                <div id="payment-methods-container" class="mt-2 grid grid-cols-2 sm:grid-cols-3 gap-2">
                                    <div><label class="flex items-center"><input type="checkbox" name="payment_method" value="Pix" class="rounded"> <span class="ml-2 text-sm">Pix</span></label></div>
                                    <div><label class="flex items-center"><input type="checkbox" name="payment_method" value="Dinheiro" class="rounded"> <span class="ml-2 text-sm">Dinheiro</span></label></div>
                                    <div><label class="flex items-center"><input type="checkbox" name="payment_method" value="Cartão" class="rounded"> <span class="ml-2 text-sm">Cartão</span></label></div>
                                    <div><label class="flex items-center"><input type="checkbox" name="payment_method" value="15 dias" class="rounded"> <span class="ml-2 text-sm">15 dias</span></label></div>
                                    <div><label class="flex items-center"><input type="checkbox" name="payment_method" value="30 dias" class="rounded"> <span class="ml-2 text-sm">30 dias</span></label></div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium">Produtos Fornecidos</label>
                                <div class="mt-2 grid grid-cols-2 sm:grid-cols-3 gap-2">
                                    <div><label class="flex items-center"><input type="checkbox" id="cat-equipamentos" name="product_type" value="Equipamentos" class="rounded"> <span class="ml-2 text-sm">Equipamentos</span></label></div>
                                    <div><label class="flex items-center"><input type="checkbox" name="product_type" value="Peças" class="rounded"> <span class="ml-2 text-sm">Peças</span></label></div>
                                    <div><label class="flex items-center"><input type="checkbox" name="product_type" value="Acessórios" class="rounded"> <span class="ml-2 text-sm">Acessórios</span></label></div>
                                </div>
                            </div>
                            <div id="product-lines-container" class="hidden pl-4 mt-2 space-y-2 border-l-2 border-brand-orange">
                                <label class="block text-sm font-medium">Linhas de Equipamentos</label>
                                <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                                    <div><label class="flex items-center"><input type="checkbox" name="product_line" value="Consumer" class="rounded"> <span class="ml-2 text-sm">Consumer</span></label></div>
                                    <div><label class="flex items-center"><input type="checkbox" name="product_line" value="Enterprise" class="rounded"> <span class="ml-2 text-sm">Enterprise</span></label></div>
                                    <div><label class="flex items-center"><input type="checkbox" name="product_line" value="Agriculture" class="rounded"> <span class="ml-2 text-sm">Agriculture</span></label></div>
                                </div>
                            </div>
                            <div class="flex gap-4 pt-4">
                                <button type="submit" class="w-full bg-brand-orange text-white py-2 rounded-md hover:bg-orange-600">Salvar Fornecedor</button>
                                <button type="button" id="cancel-supplier-edit-button" class="w-full bg-gray-500 text-white py-2 rounded-md hover:bg-gray-600 hidden">Cancelar</button>
                            </div>
                        </form>
                    </div>
                    <div id="supplier-list-container" class="hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white dark:bg-gray-800">
                                <thead class="bg-gray-50 dark:bg-gray-700"><tr><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fornecedor</th><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produtos</th><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Linhas</th><th class="py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th></tr></thead>
                                <tbody id="supplier-list-tbody" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
    </div>
    
    <!-- MODAL COMPARTILHAR PERFIL -->
    <div id="share-profile-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md relative">
            <button id="close-share-modal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white text-2xl">&times;</button>
            <div class="p-6">
                <h3 class="text-lg font-bold text-brand-green dark:text-brand-orange mb-4">Compartilhar Contato</h3>
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-md mb-4">
                    <p class="text-sm font-semibold mb-2">Pré-visualização da mensagem:</p>
                    <div id="share-message-preview" class="text-sm whitespace-pre-wrap"></div>
                </div>
                <div class="space-y-2">
                    <label class="block text-sm font-medium">Incluir na mensagem:</label>
                    <div><label class="flex items-center"><input type="checkbox" id="share-add-cnpj" class="share-option rounded"> <span class="ml-2 text-sm">CNPJ da Empresa</span></label></div>
                    <div><label class="flex items-center"><input type="checkbox" id="share-add-address" class="share-option rounded"> <span class="ml-2 text-sm">Endereço da Empresa</span></label></div>
                    <div><label class="flex items-center"><input type="checkbox" id="share-add-email" class="share-option rounded"> <span class="ml-2 text-sm">E-mail da Empresa</span></label></div>
                </div>
                <div class="mt-6">
                    <button id="final-share-button" disabled class="w-full flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-white bg-green-500 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:bg-gray-400 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.487 5.235 3.487 8.413C23.948 18.661 18.614 24 .057 24zM7.51 18.385l.331.195c1.866 1.099 4.041 1.742 6.331 1.742 5.207 0 9.46-4.252 9.461-9.46S19.378 1.42 14.171 1.42c-2.533 0-4.903.995-6.696 2.789-1.793 1.793-2.787 4.163-2.787 6.696.001 2.163.574 4.298 1.695 6.151l.215.36.004.004-1.677 6.124z"></path></svg>
                        <span>Compartilhar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- BOTÃO FLUTUANTE DA CALCULADORA -->
    <button id="calculator-fab" class="hidden fixed bottom-6 right-6 bg-brand-orange text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-orange-600 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
    </button>

    <!-- POPUP DA CALCULADORA -->
    <div id="calculator-popup" class="hidden absolute bottom-24 right-6 w-full max-w-sm bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-4 transform transition-all duration-300 origin-bottom-right scale-95 opacity-0">
        <div class="flex justify-between items-center mb-2">
            <h3 class="text-lg font-bold text-brand-green dark:text-brand-orange">Simulador</h3>
            <button id="close-calculator-popup" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white text-2xl">&times;</button>
        </div>
        <div class="space-y-4">
            <div><label for="popup-sale-value" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Valor da Venda (R$)</label><input type="number" id="popup-sale-value" step="0.01" placeholder="Ex: 1500.50" class="mt-1 block w-full appearance-none rounded-lg border border-gray-300 dark:border-gray-600 px-3 py-2 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:border-brand-orange focus:outline-none focus:ring-brand-orange sm:text-sm"></div>
            <div><label for="popup-installments" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nº de Parcelas</label><select id="popup-installments" class="mt-1 block w-full appearance-none rounded-lg border border-gray-300 dark:border-gray-600 px-3 py-2 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:border-brand-orange focus:outline-none focus:ring-brand-orange sm:text-sm"><option value="0">Selecione...</option></select></div>
        </div>
        <div id="popup-calculator-results" class="bg-gray-50 dark:bg-gray-900 p-3 mt-4 rounded-lg hidden">
            <div class="space-y-2 text-gray-700 dark:text-gray-300">
                <div class="flex justify-between items-baseline border-b pb-1 dark:border-gray-700"><span class="font-medium text-xs">Taxa:</span><span id="popup-fee-value" class="font-semibold text-sm">R$ 0,00</span></div>
                <div class="flex justify-between items-baseline border-b pb-1 dark:border-gray-700"><span class="font-medium text-xs">Parcela:</span><span id="popup-installment-value" class="font-semibold text-sm">R$ 0,00</span></div>
                <div class="flex justify-between items-baseline"><span class="font-medium text-xs">Total:</span><span id="popup-total-value" class="font-bold text-md text-brand-green dark:text-brand-orange">R$ 0,00</span></div>
            </div>
            <div class="mt-4">
                <button id="popup-whatsapp-share-button" class="w-full flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-white bg-green-500 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.487 5.235 3.487 8.413C23.948 18.661 18.614 24 .057 24zM7.51 18.385l.331.195c1.866 1.099 4.041 1.742 6.331 1.742 5.207 0 9.46-4.252 9.461-9.46S19.378 1.42 14.171 1.42c-2.533 0-4.903.995-6.696 2.789-1.793 1.793-2.787 4.163-2.787 6.696.001 2.163.574 4.298 1.695 6.151l.215.36.004.004-1.677 6.124z"></path></svg>
                    <span>Compartilhar</span>
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE RESPOSTA DA IA -->
    <div id="ai-response-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl relative max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
                <h3 id="ai-modal-title" class="text-lg font-bold text-brand-green dark:text-brand-orange">Assistente IA</h3>
                <button id="close-ai-modal" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white text-2xl">&times;</button>
            </div>
            <div id="ai-modal-content" class="p-6 overflow-y-auto">
                <!-- O conteúdo gerado pela IA ou o spinner aparecerá aqui -->
            </div>
        </div>
    </div>
    
    <!-- MODAL DE AJUDA AO CLIENTE -->
    <div id="customer-help-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl relative max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
                <h3 class="text-lg font-bold text-brand-green dark:text-brand-orange">Ajudar Cliente</h3>
                <button id="close-customer-help-modal" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white text-2xl">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <form id="customer-help-form">
                    <input type="hidden" id="customer-help-product-name">
                    <input type="hidden" id="customer-help-product-spec">
                    <div>
                        <label for="customer-question" class="block text-sm font-medium">Dúvida do Cliente:</label>
                        <textarea id="customer-question" rows="3" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm"></textarea>
                    </div>
                    <button type="submit" class="mt-4 w-full bg-brand-orange text-white py-2 rounded-md hover:bg-orange-600">Gerar Resposta</button>
                </form>
                <div id="customer-help-response" class="mt-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-md hidden">
                    <!-- A resposta da IA aparecerá aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL SENHA ADMIN -->
    <div id="admin-password-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-sm relative p-6">
            <h3 class="text-lg font-bold text-brand-green dark:text-brand-orange mb-4">Acesso Restrito</h3>
            <form id="admin-password-form">
                <div>
                    <label for="admin-password-input" class="block text-sm font-medium">Senha de Administrador:</label>
                    <input type="password" id="admin-password-input" required class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                </div>
                <div class="flex justify-end gap-4 mt-4">
                    <button type="button" id="cancel-admin-password" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">Cancelar</button>
                    <button type="submit" class="bg-brand-orange text-white px-4 py-2 rounded-md hover:bg-orange-600">Confirmar</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const loginView = document.getElementById("login-view");
            const dashboardView = document.getElementById("dashboard-view");
            const errorMessage = document.getElementById("error-message");
            const successMessage = document.getElementById("success-message");
            const loginHeader = document.getElementById("login-header");
            const logoutButton = document.getElementById("logout-button");
            const sidebarNav = document.getElementById("sidebar-nav");
            const pageTitle = document.getElementById("page-title");
            const mainContent = document.getElementById("main-content");
            const manageUsersButton = document.getElementById("manage-users-button");
            const userModal = document.getElementById("user-modal");
            const closeUserModal = document.getElementById("close-user-modal");
            const createUserForm = document.getElementById("create-user-form");
            const newUserUsernameInput = document.getElementById("new-user-username");
            const newUserPasswordInput = document.getElementById("new-user-password");
            const newUserTypeSelect = document.getElementById("new-user-type");
            const validityContainer = document.getElementById("validity-container");
            const userFormContainer = document.getElementById("user-form-container");
            const inviteContainer = document.getElementById("invite-container");
            const sendInviteButton = document.getElementById("send-invite-button");
            const createUserTab = document.getElementById("create-user-tab");
            const editUserTab = document.getElementById("edit-user-tab");
            const userListContainer = document.getElementById("user-list-container");
            const userListTbody = document.getElementById("user-list-tbody");
            const editUserFormContainer = document.getElementById("edit-user-form-container");
            const editUserForm = document.getElementById("edit-user-form");
            const cancelEditButton = document.getElementById("cancel-edit-button");

            const manageProductsButton = document.getElementById("manage-products-button");
            const productModal = document.getElementById("product-modal");
            const closeProductModal = document.getElementById("close-product-modal");
            const createProductTab = document.getElementById("create-product-tab");
            const listProductTab = document.getElementById("list-product-tab");
            const createProductContainer = document.getElementById("create-product-container");
            const productListContainer = document.getElementById("product-list-container");
            const productListTbody = document.getElementById("product-list-tbody");
            const productForm = document.getElementById("product-form");
            const cancelProductEditButton = document.getElementById("cancel-product-edit-button");
            const addProductSupplierButton = document.getElementById("add-product-supplier-button");
            const productSupplierFieldsContainer = document.getElementById("product-supplier-fields-container");

            const manageSuppliersButton = document.getElementById("manage-suppliers-button");
            const supplierModal = document.getElementById("supplier-modal");
            const closeSupplierModal = document.getElementById("close-supplier-modal");
            const createSupplierTab = document.getElementById("create-supplier-tab");
            const listSupplierTab = document.getElementById("list-supplier-tab");
            const createSupplierContainer = document.getElementById("create-supplier-container");
            const supplierListContainer = document.getElementById("supplier-list-container");
            const supplierListTbody = document.getElementById("supplier-list-tbody");
            const supplierForm = document.getElementById("supplier-form");
            const cancelSupplierEditButton = document.getElementById("cancel-supplier-edit-button");
            const catEquipamentosCheckbox = document.getElementById("cat-equipamentos");
            const productLinesContainer = document.getElementById("product-lines-container");

            const profilePictureContainer = document.getElementById("profile-picture-container");
            const profilePictureInput = document.getElementById("profile-picture-input");
            const profileShareButton = document.getElementById("profile-share-button");
            const shareProfileModal = document.getElementById("share-profile-modal");
            const closeShareModal = document.getElementById("close-share-modal");
            const shareMessagePreview = document.getElementById("share-message-preview");
            const finalShareButton = document.getElementById("final-share-button");

            const calculatorFab = document.getElementById("calculator-fab");
            const calculatorPopup = document.getElementById("calculator-popup");
            const closeCalculatorPopup = document.getElementById("close-calculator-popup");
            const popupWhatsappShareButton = document.getElementById("popup-whatsapp-share-button");

            const aiResponseModal = document.getElementById("ai-response-modal");
            const closeAiModal = document.getElementById("close-ai-modal");
            const aiModalTitle = document.getElementById("ai-modal-title");
            const aiModalContent = document.getElementById("ai-modal-content");

            const customerHelpModal = document.getElementById("customer-help-modal");
            const closeCustomerHelpModal = document.getElementById("close-customer-help-modal"); 
            const customerHelpForm = document.getElementById("customer-help-form");
            const customerHelpResponse = document.getElementById("customer-help-response");

            const buttonLoginContainer = document.getElementById("button-login-container");
            const adminPasswordModal = document.getElementById("admin-password-modal");
            const adminPasswordForm = document.getElementById("admin-password-form");
            const cancelAdminPassword = document.getElementById("cancel-admin-password");

            const menuButton = document.getElementById("menu-button");
            const sidebarMenu = document.getElementById("sidebar-menu");
            

            // Data
            const installmentRates = {
                2: 5.79, 3: 6.09, 4: 7.99, 5: 8.09, 6: 8.18, 7: 9.49, 8: 9.68, 9: 10.37, 10: 11.05, 11: 12.27, 12: 12.38
            };
            const currencyFormatter = new Intl.NumberFormat("pt-BR", {
                style: "currency",
                currency: "BRL"
            });
            const companyInfo = {
                name: "Galvão Drones",
                cnpj: "60.102.179/0001-10",
                address: "R. 16, 304 - Qd.10 Lt.24 - Setor Aeroviario, Goiânia - GO, 74435-240",
                phone: "6236360668",
                email: "contato@galvaodrones.com.br"
            };

            let loggedInUser = null;
            let users = [
                { name: "Mikhaell Galvão", username: "mikhaell", password: "mk0639", phone: "62984710639", role: "Administrador" },
                { name: "Equipe Vendas", username: "vendas", password: "", phone: "6291234567", role: "Vendedor" },
                { name: "Equipe Marketing", username: "market", password: "", phone: "6291234567", role: "Market" },
                { name: "Acesso Consulta", username: "consultas", password: "", phone: "6291234567", role: "Consultas" }
            ];
            let suppliers = [
                { name: "GoHobby Distribuidora de VANT LTDA", address: "", details: "A GoHobby é importadora exclusiva de drones profissionais e tecnologias anti-drone no Brasil.", paymentMethods: ["Cartão"], productTypes: ["Equipamentos"], productLines: ["Consumer", "Enterprise", "Agriculture"] }
            ];
            let products = [
                { id: "1037", name: "Gohobby Turbo – Micro SD 256GB", spec: "💾 Cartão Micro SD 256GB – Gohobby Turbo.\nMais espaço e velocidade para capturar todos os momentos do seu voo.", price: 254.53, suppliers: [{ name: "GoHobby Distribuidora de VANT LTDA", cost: 178.17 }] },
                { id: "1038", name: "Drone Phantom 4 Pro V2.0", spec: "🚁 Drone Phantom 4 Pro V2.0 – Câmera 4K, 30 min de voo, detecção de obstáculos em 5 direções.", price: 12500.00, suppliers: [{ name: "GoHobby Distribuidora de VANT LTDA", cost: 9000.00 }] },
                { id: "1039", name: "Bateria Extra para Mavic Air 2", spec: "🔋 Bateria de voo inteligente para DJI Mavic Air 2. Oferece até 34 minutos de voo.", price: 750.00, suppliers: [{ name: "GoHobby Distribuidora de VANT LTDA", cost: 500.00 }] }
            ];
            let productSupplierCount = 1;
            let adminAccessTimestamp = 0; // Timestamp for admin access validation

            // Functions
            function showDashboard(user) {
                loginView.classList.add("hidden");
                dashboardView.classList.remove("hidden");
                calculatorFab.classList.remove("hidden");

                document.getElementById("sidebar-user-name").textContent = user.name;
                document.getElementById("sidebar-user-role").textContent = user.role;
                document.getElementById("welcome-user-name").textContent = user.name.split(" ")[0];
                document.getElementById("welcome-user-role").textContent = user.role;

                // Hide all sidebar links and specific content by default
                document.querySelectorAll(".sidebar-link").forEach(link => link.classList.add("hidden"));
                document.getElementById("admin-link").classList.add("hidden");
                document.getElementById("vendedor-content").classList.add("hidden");
                
                // Show common links
                document.querySelector('[data-page="dashboard"]').classList.remove("hidden");
                document.querySelector('[data-page="drones"]').classList.remove("hidden");
                document.querySelector('[data-page="perfil"]').classList.remove("hidden");
                document.querySelector('[data-page="sobre"]').classList.remove("hidden");

                // Show role-specific links and content
                if (user.role === "Administrador") {
                    document.getElementById("admin-link").classList.remove("hidden");
                    document.querySelector('[data-page="consultas"]').classList.remove("hidden");
                    document.querySelector('[data-page="marketing"]').classList.remove("hidden");
                    document.querySelector('[data-page="produtos"]').classList.remove("hidden");
                } else if (user.role === "Vendedor") {
                    document.getElementById("vendedor-content").classList.remove("hidden");
                    document.querySelector('[data-page="consultas"]').classList.remove("hidden");
                    document.querySelector('[data-page="produtos"]').classList.remove("hidden");
                } else if (user.role === "Market") {
                    document.querySelector('[data-page="marketing"]').classList.remove("hidden");
                    document.querySelector('[data-page="produtos"]').classList.remove("hidden");
                } else if (user.role === "Consultas") {
                    // Only dashboard, drones, perfil, sobre are visible by default
                }
                
                // Set initial active page to dashboard
                switchPage('dashboard');
                document.querySelector('[data-page="dashboard"]').classList.add("active");
            }

            function showLogin() {
                dashboardView.classList.add("hidden");
                calculatorFab.classList.add("hidden");
                loginView.classList.remove("hidden");
                loginHeader.classList.remove("hidden");
                buttonLoginContainer.classList.remove("hidden");
                successMessage.classList.add("hidden");
                errorMessage.classList.add("hidden");
                loggedInUser = null;
            }

            function switchPage(pageId) {
                mainContent.querySelectorAll(".page-content").forEach(page => {
                    page.classList.add("hidden");
                });
                const targetPage = document.getElementById(pageId + "-page");
                if (targetPage) {
                    targetPage.classList.remove("hidden");
                    pageTitle.textContent = document.querySelector(`[data-page="${pageId}"] span`).textContent;
                }

                if (pageId === "perfil") {
                    populateProfilePage();
                } else if (pageId === "drones") {
                    // Initial render for drones page: show only model and specs (no price)
                    setupSearchAndFilter('drones', products, (product) => createProductCard(product, false));
                } else if (pageId === "consultas") {
                    // Initial render for consultas page: show model, specs, and price
                    setupSearchAndFilter('consultas', products, (product) => createProductCard(product, true));
                }
                sidebarMenu.classList.add("-translate-x-full"); // Close sidebar on mobile
            }

            function calculateInstallments(prefix) {
                const saleValueInput = document.getElementById(`${prefix}-sale-value`);
                const installmentsSelect = document.getElementById(`${prefix}-installments`);
                const resultsContainer = document.getElementById(`${prefix}-calculator-results`);

                const saleValue = parseFloat(saleValueInput.value) || 0;
                const installments = parseInt(installmentsSelect.value);

                if (saleValue > 0 && installments > 0) {
                    const feeRate = installmentRates[installments];
                    const feeAmount = saleValue * (feeRate / 100);
                    const totalAmount = saleValue + feeAmount;
                    const installmentValue = totalAmount / installments;

                    document.getElementById(`${prefix}-fee-value`).textContent = currencyFormatter.format(feeAmount);
                    document.getElementById(`${prefix}-installment-value`).textContent = `${installments}x de ${currencyFormatter.format(installmentValue)}`;
                    document.getElementById(`${prefix}-total-value`).textContent = currencyFormatter.format(totalAmount);
                    resultsContainer.classList.remove("hidden");
                } else {
                    resultsContainer.classList.add("hidden");
                }
            }

            function populateInstallmentOptions() {
                const selectElement = document.getElementById("popup-installments");
                for (const installments in installmentRates) {
                    const option = document.createElement("option");
                    option.value = installments;
                    option.textContent = `${installments}x (${installmentRates[installments].toString().replace(".", ",")}% taxa)`;
                    selectElement.appendChild(option);
                }
            }

            function shareOnWhatsApp(phoneNumber, message) {
                const formattedPhoneNumber = phoneNumber.startsWith("55") ? phoneNumber.replace(/\D/g, "") : "55" + phoneNumber.replace(/\D/g, "");
                const whatsappUrl = `https://wa.me/${formattedPhoneNumber}${message ? "?text=" + encodeURIComponent(message) : ""}`;
                window.open(whatsappUrl, "_blank");
            }

            function resetUserModal() {
                userFormContainer.classList.remove("hidden");
                inviteContainer.classList.add("hidden");
                userListContainer.classList.add("hidden");
                editUserFormContainer.classList.add("hidden");
                createUserForm.reset();
                validityContainer.classList.add("hidden");
                userModal.classList.add("hidden"); // Ensure modal is hidden
                createUserTab.classList.add("active");
                editUserTab.classList.remove("active");
            }

            function renderUserList() {
                userListTbody.innerHTML = "";
                users.forEach((user, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td class="py-3 px-4 text-sm">${user.name}</td>
                        <td class="py-3 px-4 text-sm">${user.username}</td>
                        <td class="py-3 px-4 text-sm">${user.role}</td>
                        <td class="py-3 px-4 text-sm space-x-2">
                            <button class="text-blue-500 hover:underline" data-action="edit" data-index="${index}">Alterar</button>
                            <button class="text-red-500 hover:underline" data-action="delete" data-index="${index}">Excluir</button>
                        </td>
                    `;
                    userListTbody.appendChild(row);
                });
            }

            function showUserListTab() {
                createUserTab.classList.remove("active");
                editUserTab.classList.add("active");
                userFormContainer.classList.add("hidden");
                inviteContainer.classList.add("hidden");
                editUserFormContainer.classList.add("hidden");
                userListContainer.classList.remove("hidden");
                renderUserList();
            }

            function openEditUserForm(index) {
                const user = users[index];
                document.getElementById("edit-user-index").value = index;
                document.getElementById("edit-user-name").value = user.name;
                document.getElementById("edit-user-username").value = user.username;
                document.getElementById("edit-user-phone").value = user.phone;
                document.getElementById("edit-user-type").value = user.role;
                userListContainer.classList.add("hidden");
                editUserFormContainer.classList.remove("hidden");
            }

            function renderSupplierList() {
                supplierListTbody.innerHTML = "";
                suppliers.forEach((supplier, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td class="py-3 px-4 text-sm">${supplier.name}</td>
                        <td class="py-3 px-4 text-sm">${supplier.productTypes.join(", ")}</td>
                        <td class="py-3 px-4 text-sm">${(supplier.productLines || []).join(", ")}</td>
                        <td class="py-3 px-4 text-sm space-x-2">
                            <button class="text-blue-500 hover:underline" data-action="edit" data-index="${index}">Alterar</button>
                            <button class="text-red-500 hover:underline" data-action="delete" data-index="${index}">Excluir</button>
                        </td>
                    `;
                    supplierListTbody.appendChild(row);
                });
            }

            function showSupplierListTab() {
                createSupplierTab.classList.remove("active");
                listSupplierTab.classList.add("active");
                createSupplierContainer.classList.add("hidden");
                supplierListContainer.classList.remove("hidden");
                renderSupplierList();
            }

            function openEditSupplierForm(index) {
                const supplier = suppliers[index];
                supplierForm.reset(); // Clear form first
                document.getElementById("edit-supplier-index").value = index;
                document.getElementById("supplier-name").value = supplier.name;
                document.getElementById("supplier-address").value = supplier.address;
                document.getElementById("supplier-details").value = supplier.details;

                supplierForm.querySelectorAll('input[name="payment_method"]').forEach(checkbox => {
                    checkbox.checked = supplier.paymentMethods.includes(checkbox.value);
                });
                supplierForm.querySelectorAll('input[name="product_type"]').forEach(checkbox => {
                    checkbox.checked = supplier.productTypes.includes(checkbox.value);
                });
                // Manually trigger change for product lines visibility
                catEquipamentosCheckbox.dispatchEvent(new Event("change")); 
                supplierForm.querySelectorAll('input[name="product_line"]').forEach(checkbox => {
                    checkbox.checked = (supplier.productLines || []).includes(checkbox.value);
                });

                cancelSupplierEditButton.classList.remove("hidden");
                listSupplierTab.classList.remove("active");
                createSupplierTab.classList.add("active");
                supplierListContainer.classList.add("hidden");
                createSupplierContainer.classList.remove("hidden");
            }

            function populateProfilePage() {
                if (!loggedInUser) {
                    console.error("No user logged in to populate profile page.");
                    // Optionally, redirect to login or show a message
                    return;
                }
                console.log("populateProfilePage called for user:", loggedInUser.name); // Log para depuração
                const [firstName, ...lastNameParts] = loggedInUser.name.split(" ");
                const lastName = lastNameParts.join(" ");

                document.getElementById("profile-page-name").textContent = loggedInUser.name;
                document.getElementById("profile-page-role").textContent = loggedInUser.role;
                document.getElementById("profile-firstname").value = firstName || "";
                document.getElementById("profile-lastname").value = lastName || "";
                document.getElementById("profile-username").value = loggedInUser.username;
                document.getElementById("profile-whatsapp").value = loggedInUser.phone;

                document.getElementById("company-cnpj").value = companyInfo.cnpj;
                document.getElementById("company-address").value = companyInfo.address;
                document.getElementById("company-phone").value = companyInfo.phone;
            }

            function updateShareMessage() {
                let message = `*${loggedInUser.name}*\n${loggedInUser.role} - ${companyInfo.name}\n\n*WhatsApp:* wa.me/55${loggedInUser.phone.replace(/\D/g, "")}\n*Empresa:* wa.me/55${companyInfo.phone.replace(/\D/g, "")}`;

                if (document.getElementById("share-add-cnpj").checked) {
                    message += `\n*CNPJ:* ${companyInfo.cnpj}`;
                }
                if (document.getElementById("share-add-address").checked) {
                    message += `\n*Endereço:* ${companyInfo.address}`;
                }
                if (document.getElementById("share-add-email").checked) {
                    message += `\n*E-mail:* ${companyInfo.email}`;
                }
                shareMessagePreview.innerHTML = message.replace(/\n/g, "<br>").replace(/\*(.*?)\*/g, "<b>$1</b>");
                finalShareButton.disabled = false;
            }

            function renderProductList() {
                productListTbody.innerHTML = "";
                products.forEach((product, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td class="py-3 px-4 text-sm">${product.id}</td>
                        <td class="py-3 px-4 text-sm">${product.name}</td>
                        <td class="py-3 px-4 text-sm">${currencyFormatter.format(product.price)}</td>
                        <td class="py-3 px-4 text-sm space-x-2">
                            <button class="text-blue-500 hover:underline" data-action="edit" data-index="${index}">Alterar</button>
                            <button class="text-red-500 hover:underline" data-action="delete" data-index="${index}">Excluir</button>
                        </td>
                    `;
                    productListTbody.appendChild(row);
                });
            }

            function showProductListTab() {
                createProductTab.classList.remove("active");
                listProductTab.classList.add("active");
                createProductContainer.classList.add("hidden");
                productListContainer.classList.remove("hidden");
                renderProductList();
            }

            function openEditProductForm(index) {
                const product = products[index];
                productForm.reset(); // Clear form first
                document.getElementById("edit-product-index").value = index;
                document.getElementById("product-id").value = product.id;
                document.getElementById("product-name").value = product.name;
                document.getElementById("product-spec").value = product.spec;
                document.getElementById("product-price").value = product.price;

                productSupplierFieldsContainer.innerHTML = ""; // Clear existing supplier fields
                product.suppliers.forEach((supplier, i) => {
                    const supplierDiv = document.createElement("div");
                    supplierDiv.className = "p-3 border rounded-md border-gray-200 dark:border-gray-600";
                    supplierDiv.innerHTML = `
                        <label class="block text-sm font-medium mb-2">Fornecedor ${i + 1}</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="product-supplier-name-${i + 1}" class="block text-xs font-medium">Fornecedor</label>
                                <input type="text" id="product-supplier-name-${i + 1}" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                            </div>
                            <div>
                                <label for="product-supplier-cost-${i + 1}" class="block text-xs font-medium">Preço de custo</label>
                                <input type="number" step="0.01" id="product-supplier-cost-${i + 1}" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                            </div>
                        </div>
                    `;
                    productSupplierFieldsContainer.appendChild(supplierDiv);
                });
                productSupplierCount = product.suppliers.length; // Update count for new additions

                cancelProductEditButton.classList.remove("hidden");
                listProductTab.classList.remove("active");
                createProductTab.classList.add("active");
                productListContainer.classList.add("hidden");
                createProductContainer.classList.remove("hidden");
            }

            function shareCalculationOnWhatsApp() {
                const saleValue = currencyFormatter.format(parseFloat(document.getElementById("popup-sale-value").value) || 0);
                const installments = document.getElementById("popup-installments").value;
                const totalValue = document.getElementById("popup-total-value").textContent;
                const feeValue = document.getElementById("popup-fee-value").textContent;
                const installmentValue = document.getElementById("popup-installment-value").textContent.replace(/.*de /, ""); // Get only the value

                const message = `*Simulação de Pagamento*\n\nValor da Venda: *${saleValue}*\nParcelamento: *${installments}x*\n\n*Resultado:*\n- Taxa da Máquina: *${feeValue}*\n- Valor da Parcela: *${installmentValue}*\n- Valor Total: *${totalValue}*`;
                shareOnWhatsApp("", message); // Share with no specific number, opens default WhatsApp share
            }

            // Function to create a product card (now accepts showPrice parameter)
            function createProductCard(product, showPrice) {
                const card = document.createElement("div");
                card.className = "bg-white dark:bg-gray-800 p-4 rounded-lg shadow";
                card.dataset.name = product.name;
                card.dataset.spec = product.spec;

                let cardContent = `
                    <h3 class="font-bold text-lg text-brand-green dark:text-brand-orange">${product.name}</h3>
                    <div class="mt-2 text-sm text-gray-600 dark:text-gray-400 space-y-1">${product.spec.replace(/\n/g, "<br>")}</div>
                `;

                if (showPrice) {
                    cardContent += `
                        <div class="mt-4">
                            <p class="text-sm font-medium">Valor de Venda: <span class="font-bold text-lg text-brand-green dark:text-brand-orange">${currencyFormatter.format(product.price)}</span></p>
                        </div>
                    `;
                }

                // Conditionally display supplier costs only if loggedInUser exists and is Administrator
                if (loggedInUser && loggedInUser.role === "Administrador") {
                    cardContent += `
                        <div class="mt-2">
                            <p class="text-sm font-semibold">Custos por Fornecedor:</p>
                            <ul class="text-sm list-disc list-inside">
                                ${product.suppliers.map(s => `<li>${s.name}: ${currencyFormatter.format(s.cost)}</li>`).join("")}
                            </ul>
                        </div>
                    `;
                }

                cardContent += `
                    <div class="mt-4 pt-4 border-t dark:border-gray-700 grid grid-cols-2 gap-2 text-sm">
                        <button data-action="generate-description" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-1 px-2 rounded-md hover:bg-gray-300">Gerar Descrição</button>
                        <button data-action="create-arguments" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-1 px-2 rounded-md hover:bg-gray-300">Criar Argumentos</button>
                        <button data-action="whatsapp" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-1 px-2 rounded-md hover:bg-gray-300">WhatsApp</button>
                        <button data-action="customer-help" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-1 px-2 rounded-md hover:bg-gray-300">Ajudar Cliente</button>
                    </div>
                `;
                card.innerHTML = cardContent;
                return card;
            }

            // New generic function to setup search and filter for a given page
            function setupSearchAndFilter(pagePrefix, dataArray, resultRenderer) {
                const searchInput = document.getElementById(`${pagePrefix}-search-input`);
                const searchButton = document.getElementById(`${pagePrefix}-search-button`);
                const filterButton = document.getElementById(`${pagePrefix}-filter-button`);
                const filterPanel = document.getElementById(`${pagePrefix}-filter-panel`);
                const minPriceInput = document.getElementById(`${pagePrefix}-min-price`);
                const maxPriceInput = document.getElementById(`${pagePrefix}-max-price`);
                const sortRadios = document.querySelectorAll(`input[name="${pagePrefix}-sort"]`);
                const resultsContainer = document.getElementById(`${pagePrefix}-search-results`);

                function performSearch() {
                    const searchTerm = searchInput.value.toLowerCase();
                    let sortBy = '';
                    sortRadios.forEach(radio => {
                        if (radio.checked) {
                            sortBy = radio.value;
                        }
                    });
                    const minPrice = parseFloat(minPriceInput.value) || 0;
                    const maxPriceVal = maxPriceInput.value;
                    const maxPrice = maxPriceVal ? parseFloat(maxPriceVal) : Infinity;

                    let filteredItems = dataArray.filter(item => {
                        const matchesSearch = item.name.toLowerCase().includes(searchTerm) || (item.spec && item.spec.toLowerCase().includes(searchTerm));
                        const matchesPrice = item.price >= minPrice && item.price <= maxPrice;
                        return matchesSearch && matchesPrice;
                    });

                    if (sortBy) {
                        if (sortBy === "alpha-asc") {
                            filteredItems.sort((a, b) => a.name.localeCompare(b.name));
                        } else if (sortBy === "alpha-desc") {
                            filteredItems.sort((a, b) => b.name.localeCompare(a.name));
                        } else if (sortBy === "price-asc") {
                            filteredItems.sort((a, b) => a.price - b.price);
                        } else if (sortBy === "price-desc") {
                            filteredItems.sort((a, b) => b.price - a.price);
                        }
                    }
                    // Pass the showPrice parameter to the resultRenderer based on the pagePrefix
                    const showPriceForCurrentPage = (pagePrefix === 'consultas');
                    renderResults(filteredItems, showPriceForCurrentPage);
                    if (filterPanel) filterPanel.classList.add("hidden"); // Close filter panel after search
                }

                function renderResults(results, showPrice) {
                    if (resultsContainer) {
                        resultsContainer.innerHTML = "";
                        if (results.length === 0) {
                            resultsContainer.innerHTML = '<p class="text-gray-600 dark:text-gray-400 text-center col-span-full">Nenhum item encontrado com os critérios de busca.</p>';
                            return;
                        }
                        results.forEach(item => {
                            resultsContainer.appendChild(resultRenderer(item, showPrice));
                        });
                    }
                }

                // Event Listeners for this specific search/filter instance
                if (searchButton) searchButton.addEventListener("click", performSearch);
                if (filterButton) {
                    filterButton.addEventListener("click", (e) => {
                        e.stopPropagation();
                        console.log(`Botão de filtro para ${pagePrefix} clicado!`); // Log para depuração
                        if (filterPanel) filterPanel.classList.toggle("hidden");
                    });
                }
                // Only attach input listeners if the elements exist
                if (minPriceInput) minPriceInput.addEventListener("input", performSearch);
                if (maxPriceInput) maxPriceInput.addEventListener("input", performSearch);
                sortRadios.forEach(radio => radio.addEventListener("change", performSearch));

                // Close filter panel when clicking outside this specific filter panel
                document.addEventListener("click", e => {
                    if (filterPanel && !filterPanel.classList.contains("hidden") && !filterPanel.contains(e.target) && e.target !== filterButton) {
                        filterPanel.classList.add("hidden");
                    }
                });

                // Event delegation for product card buttons within this results container
                if (resultsContainer) {
                    resultsContainer.addEventListener("click", e => {
                        const button = e.target.closest("button");
                        if (button) {
                            const action = button.dataset.action;
                            const card = button.closest(".bg-white");
                            const productName = card.dataset.name;
                            const productSpec = card.dataset.spec;

                            if (action === "generate-description" || action === "create-arguments") {
                                handleAIAssist(action, productName, productSpec);
                            } else if (action === "whatsapp") {
                                const message = `Olá! Tenho interesse no produto: *${productName}*\n\n${productSpec.replace(/\n/g, "%0A")}\n\nPreço: *${currencyFormatter.format(products.find(p => p.name === productName).price)}*`;
                                shareOnWhatsApp(companyInfo.phone, message);
                            } else if (action === "customer-help") {
                                handleCustomerHelp(productName, productSpec);
                            }
                        }
                    });
                }

                // Initial render when the page is loaded or switched to
                const showPriceForCurrentPage = (pagePrefix === 'consultas');
                renderResults(dataArray, showPriceForCurrentPage);
            }

            async function callGeminiAPI(prompt, title) {
                aiModalTitle.textContent = title;
                aiModalContent.innerHTML = '<div class="flex justify-center items-center"><div class="spinner"></div></div>';
                aiResponseModal.classList.remove("hidden");

                const apiKey = ""; // Canvas will inject the API key
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`; 
                
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        aiModalContent.innerText = text;
                    } else {
                        aiModalContent.innerText = "Não foi possível gerar uma resposta. Tente novamente.";
                    }
                } catch (error) {
                    console.error("Erro na API Gemini:", error);
                    aiModalContent.innerText = "Erro ao conectar com a IA. Verifique o console para mais detalhes.";
                }
            }

            function handleAIAssist(action, productName, productSpec) {
                let prompt, title;
                const productInfo = `Nome: ${productName}\nEspecificações: ${productSpec}`;

                switch (action) {
                    case "generate-description":
                        prompt = `Gere uma descrição curta e cativante para o seguinte produto, focando nos benefícios para o cliente. Use emojis e linguagem de vendas:\n\n${productInfo}`;
                        title = "Descrição do Produto (IA)";
                        break;
                    case "create-arguments":
                        prompt = `Crie 3 argumentos de venda persuasivos para o seguinte produto, destacando seus diferenciais e valor para o cliente:\n\n${productInfo}`;
                        title = "Argumentos de Venda (IA)";
                        break;
                    default:
                        return;
                }
                callGeminiAPI(prompt, title);
            }

            function handleCustomerHelp(productName, productSpec) {
                customerHelpModal.classList.remove("hidden");
                document.getElementById("customer-help-product-name").value = productName;
                document.getElementById("customer-help-product-spec").value = productSpec;
            }

            function promptForAdminPassword() {
                return new Promise(resolve => {
                    adminPasswordModal.classList.remove("hidden");
                    adminPasswordForm.onsubmit = (e) => {
                        e.preventDefault();
                        const adminPasswordInput = document.getElementById("admin-password-input");
                        if (adminPasswordInput.value === "@0639") {
                            adminPasswordModal.classList.add("hidden");
                            adminPasswordInput.value = ""; // Clear password
                            adminAccessTimestamp = Date.now(); // Update timestamp
                            resolve(true);
                        } else {
                            // Using a custom message box instead of alert()
                            const messageBox = document.createElement('div');
                            messageBox.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
                            messageBox.innerHTML = `
                                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-sm relative p-6 text-center">
                                    <h3 class="text-lg font-bold text-red-600 mb-4">Erro de Senha</h3>
                                    <p class="text-gray-700 dark:text-gray-300 mb-6">Senha incorreta. Tente novamente.</p>
                                    <button id="close-message-box" class="bg-brand-orange text-white px-4 py-2 rounded-md hover:bg-orange-600">OK</button>
                                </div>
                            `;
                            document.body.appendChild(messageBox);
                            document.getElementById('close-message-box').onclick = () => {
                                messageBox.remove();
                            };
                            adminPasswordInput.value = ""; // Clear password
                            resolve(false);
                        }
                    };
                    cancelAdminPassword.onclick = () => {
                        adminPasswordModal.classList.add("hidden");
                        document.getElementById("admin-password-input").value = ""; // Clear password
                        resolve(false);
                    };
                });
            }

            // Event Listeners

            // Login functionality
            buttonLoginContainer.addEventListener("click", e => {
                if (e.target.classList.contains("login-button")) {
                    const username = e.target.dataset.username;
                    errorMessage.classList.add("hidden");
                    loggedInUser = users.find(user => user.username === username);

                    if (loggedInUser) {
                        buttonLoginContainer.classList.add("hidden");
                        loginHeader.classList.add("hidden");
                        successMessage.classList.remove("hidden");
                        // Reduced login screen time to 1 second
                        setTimeout(() => {
                            showDashboard(loggedInUser);
                        }, 1000); // Changed from 2000 to 1000
                    } else {
                        errorMessage.classList.remove("hidden");
                    }
                }
            });

            logoutButton.addEventListener("click", e => {
                e.preventDefault();
                showLogin();
            });

            // Sidebar navigation
            sidebarNav.addEventListener("click", async e => {
                const targetLink = e.target.closest(".sidebar-link");
                if (targetLink) {
                    e.preventDefault();
                    const pageId = targetLink.dataset.page;

                    if (pageId === "admin" && loggedInUser.role === "Administrador") {
                        // Check if admin access is still valid (within 5 minutes)
                        if (Date.now() - adminAccessTimestamp < 300000) { // 300,000 ms = 5 minutes
                            document.querySelectorAll(".sidebar-link").forEach(link => link.classList.remove("active"));
                            targetLink.classList.add("active");
                            pageTitle.textContent = targetLink.querySelector("span").textContent;
                            switchPage(pageId);
                            return;
                        }
                        const authorized = await promptForAdminPassword();
                        if (authorized) {
                            document.querySelectorAll(".sidebar-link").forEach(link => link.classList.remove("active"));
                            targetLink.classList.add("active");
                            pageTitle.textContent = targetLink.querySelector("span").textContent;
                            switchPage(pageId);
                        }
                    } else if (pageId !== "admin") { // For non-admin links or if not admin role
                        document.querySelectorAll(".sidebar-link").forEach(link => link.classList.remove("active"));
                        targetLink.classList.add("active");
                        pageTitle.textContent = targetLink.querySelector("span").textContent;
                        switchPage(pageId);
                    }
                }
            });

            // Mobile menu toggle
            menuButton.addEventListener("click", () => {
                sidebarMenu.classList.toggle("-translate-x-full");
            });

            // Calculator FAB and Popup
            calculatorFab.addEventListener("click", () => {
                calculatorPopup.classList.remove("hidden", "scale-95", "opacity-0");
                calculatorPopup.classList.add("scale-100", "opacity-100");
            });

            closeCalculatorPopup.addEventListener("click", () => {
                calculatorPopup.classList.add("scale-95", "opacity-0");
                setTimeout(() => calculatorPopup.classList.add("hidden"), 300); // Hide after transition
            });

            // Close calculator popup when clicking outside
            document.addEventListener("click", e => {
                if (!calculatorPopup.classList.contains("hidden") && !calculatorPopup.contains(e.target) && !calculatorFab.contains(e.target)) {
                    closeCalculatorPopup.click();
                }
            });

            // Calculator input and select events
            document.getElementById("popup-sale-value").addEventListener("input", () => calculateInstallments("popup"));
            document.getElementById("popup-installments").addEventListener("change", () => calculateInstallments("popup"));
            popupWhatsappShareButton.addEventListener("click", shareCalculationOnWhatsApp);

            // User Management Modal
            manageUsersButton.addEventListener("click", e => {
                e.preventDefault();
                userModal.classList.remove("hidden");
                if (loggedInUser.role === "Administrador") {
                    editUserTab.classList.remove("hidden");
                } else {
                    editUserTab.classList.add("hidden");
                }
                createUserTab.click(); // Default to create user tab
            });

            closeUserModal.addEventListener("click", resetUserModal);
            userModal.addEventListener("click", e => {
                if (e.target === userModal) {
                    resetUserModal();
                }
            });

            newUserUsernameInput.addEventListener("input", () => {
                const username = newUserUsernameInput.value;
                const currentYear = new Date().getFullYear();
                newUserPasswordInput.value = username.length >= 3 ? username.substring(0, 3).toLowerCase() + currentYear : "";
            });

            newUserTypeSelect.addEventListener("change", () => {
                if (newUserTypeSelect.value === "Consultas") {
                    validityContainer.classList.remove("hidden");
                } else {
                    validityContainer.classList.add("hidden");
                }
            });

            createUserForm.addEventListener("submit", e => {
                e.preventDefault();
                const newUser = {
                    name: document.getElementById("new-user-name").value,
                    username: newUserUsernameInput.value,
                    password: newUserPasswordInput.value,
                    phone: document.getElementById("new-user-phone").value,
                    role: newUserTypeSelect.value
                };
                if (newUser.role === "Consultas") {
                    newUser.validity = document.getElementById("new-user-validity").value;
                }
                users.push(newUser);
                document.getElementById("invite-username").textContent = newUser.username;
                document.getElementById("invite-password").textContent = newUser.password;
                userFormContainer.classList.add("hidden");
                inviteContainer.classList.remove("hidden");
            });

            sendInviteButton.addEventListener("click", () => {
                const phoneNumber = document.getElementById("new-user-phone").value;
                const invitedUsername = document.getElementById("invite-username").textContent;
                const invitedPassword = document.getElementById("invite-password").textContent;
                const currentUrl = window.location.href;
                const inviteMessage = `Olá! Você foi convidado para acessar o Portal Galvão Drones.%0A%0A*Link de Acesso:* ${currentUrl}%0A*Usuário:* ${invitedUsername}%0A*Senha:* ${invitedPassword}%0A%0AAtenciosamente,%0AEquipe Galvão Drones.`;
                shareOnWhatsApp(phoneNumber, inviteMessage.replace(/%0A/g, "\n"));
            });

            createUserTab.addEventListener("click", () => {
                editUserTab.classList.remove("active");
                createUserTab.classList.add("active");
                userListContainer.classList.add("hidden");
                editUserFormContainer.classList.add("hidden");
                userFormContainer.classList.remove("hidden");
                inviteContainer.classList.add("hidden"); // Hide invite container when switching back
            });

            editUserTab.addEventListener("click", showUserListTab);
            cancelEditButton.addEventListener("click", showUserListTab);

            userListTbody.addEventListener("click", e => {
                const target = e.target;
                if (target.tagName === "BUTTON") {
                    const action = target.dataset.action;
                    const index = parseInt(target.dataset.index);
                    if (action === "edit") {
                        openEditUserForm(index);
                    } else if (action === "delete") {
                        users.splice(index, 1);
                        renderUserList();
                    }
                }
            });

            editUserForm.addEventListener("submit", e => {
                e.preventDefault();
                const index = document.getElementById("edit-user-index").value;
                users[index] = {
                    ...users[index], // Keep existing properties
                    name: document.getElementById("edit-user-name").value,
                    username: document.getElementById("edit-user-username").value,
                    phone: document.getElementById("edit-user-phone").value,
                    role: document.getElementById("edit-user-type").value
                };
                showUserListTab();
            });

            // Product Management Modal
            manageProductsButton.addEventListener("click", e => {
                e.preventDefault();
                productModal.classList.remove("hidden");
                listProductTab.click(); // Default to list products tab
            });

            closeProductModal.addEventListener("click", () => {
                productModal.classList.add("hidden");
            });
            productModal.addEventListener("click", e => {
                if (e.target === productModal) {
                    productModal.classList.add("hidden");
                }
            });

            createProductTab.addEventListener("click", () => {
                listProductTab.classList.remove("active");
                createProductTab.classList.add("active");
                productListContainer.classList.add("hidden");
                createProductContainer.classList.remove("hidden");
                productForm.reset(); // Clear form for new product
                document.getElementById("edit-product-index").value = ""; // Clear edit index
                cancelProductEditButton.classList.add("hidden"); // Hide cancel button for new product
                productSupplierFieldsContainer.innerHTML = `
                    <div class="p-3 border rounded-md border-gray-200 dark:border-gray-600">
                        <label class="block text-sm font-medium mb-2">Fornecedor 1</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="product-supplier-name-1" class="block text-xs font-medium">Fornecedor</label>
                                <input type="text" id="product-supplier-name-1" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                            </div>
                            <div>
                                <label for="product-supplier-cost-1" class="block text-xs font-medium">Preço de custo</label>
                                <input type="number" step="0.01" id="product-supplier-cost-1" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                            </div>
                        </div>
                    </div>
                `;
                productSupplierCount = 1;
            });

            listProductTab.addEventListener("click", showProductListTab);
            cancelProductEditButton.addEventListener("click", showProductListTab);

            productListTbody.addEventListener("click", e => {
                const target = e.target;
                if (target.tagName === "BUTTON") {
                    const action = target.dataset.action;
                    const index = parseInt(target.dataset.index);
                    if (action === "edit") {
                        openEditProductForm(index);
                    } else if (action === "delete") {
                        products.splice(index, 1);
                        renderProductList();
                    }
                }
            });

            productForm.addEventListener("submit", e => {
                e.preventDefault();
                const index = document.getElementById("edit-product-index").value;
                const suppliersData = [];
                const supplierDivs = productSupplierFieldsContainer.querySelectorAll(".p-3");
                supplierDivs.forEach((div, i) => {
                    const name = document.getElementById(`product-supplier-name-${i + 1}`).value;
                    const cost = document.getElementById(`product-supplier-cost-${i + 1}`).value;
                    if (name && cost) {
                        suppliersData.push({ name: name, cost: parseFloat(cost) });
                    }
                });

                const newProduct = {
                    id: document.getElementById("product-id").value,
                    name: document.getElementById("product-name").value,
                    spec: document.getElementById("product-spec").value,
                    price: parseFloat(document.getElementById("product-price").value),
                    suppliers: suppliersData
                };

                if (index === "") { // New product
                    products.push(newProduct);
                } else { // Edit existing product
                    products[index] = newProduct;
                }
                productForm.reset();
                showProductListTab();
            });

            addProductSupplierButton.addEventListener("click", () => {
                productSupplierCount++;
                const newSupplierDiv = document.createElement("div");
                newSupplierDiv.className = "p-3 border rounded-md border-gray-200 dark:border-gray-600";
                newSupplierDiv.innerHTML = `
                    <label class="block text-sm font-medium mb-2">Fornecedor ${productSupplierCount}</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="product-supplier-name-${productSupplierCount}" class="block text-xs font-medium">Fornecedor</label>
                            <input type="text" id="product-supplier-name-${productSupplierCount}" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                        </div>
                        <div>
                            <label for="product-supplier-cost-${productSupplierCount}" class="block text-xs font-medium">Preço de custo</label>
                            <input type="number" step="0.01" id="product-supplier-cost-${productSupplierCount}" class="mt-1 w-full rounded-md border-gray-300 shadow-sm">
                        </div>
                    </div>
                `;
                productSupplierFieldsContainer.appendChild(newSupplierDiv);
            });

            // Supplier Management Modal
            manageSuppliersButton.addEventListener("click", e => {
                e.preventDefault();
                supplierModal.classList.remove("hidden");
                listSupplierTab.click(); // Default to list suppliers tab
            });

            closeSupplierModal.addEventListener("click", () => {
                supplierModal.classList.add("hidden");
            });
            supplierModal.addEventListener("click", e => {
                if (e.target === supplierModal) {
                    supplierModal.classList.add("hidden");
                }
            });

            createSupplierTab.addEventListener("click", () => {
                listSupplierTab.classList.remove("active");
                createSupplierTab.classList.add("active");
                supplierListContainer.classList.add("hidden");
                createSupplierContainer.classList.remove("hidden");
                supplierForm.reset(); // Clear form for new supplier
                document.getElementById("edit-supplier-index").value = ""; // Clear edit index
                cancelSupplierEditButton.classList.add("hidden"); // Hide cancel button for new supplier
            });

            listSupplierTab.addEventListener("click", () => {
                createSupplierTab.classList.remove("active");
                listSupplierTab.classList.add("active");
                createSupplierContainer.classList.add("hidden");
                supplierListContainer.classList.remove("hidden");
                renderSupplierList();
            });

            catEquipamentosCheckbox.addEventListener("change", () => {
                productLinesContainer.classList.toggle("hidden", !catEquipamentosCheckbox.checked);
            });

            supplierListTbody.addEventListener("click", e => {
                const target = e.target;
                if (target.tagName === "BUTTON") {
                    const action = target.dataset.action;
                    const index = parseInt(target.dataset.index);
                    if (action === "edit") {
                        openEditSupplierForm(index);
                    } else if (action === "delete") {
                        suppliers.splice(index, 1);
                        renderSupplierList();
                    }
                }
            });

            cancelSupplierEditButton.addEventListener("click", () => {
                createSupplierContainer.classList.add("hidden");
                supplierListContainer.classList.remove("hidden");
                renderSupplierList();
            });

            supplierForm.addEventListener("submit", e => {
                e.preventDefault();
                const index = document.getElementById("edit-supplier-index").value;
                const newSupplier = {
                    name: document.getElementById("supplier-name").value,
                    address: document.getElementById("supplier-address").value,
                    details: document.getElementById("supplier-details").value,
                    paymentMethods: Array.from(supplierForm.querySelectorAll('input[name="payment_method"]:checked')).map(cb => cb.value),
                    productTypes: Array.from(supplierForm.querySelectorAll('input[name="product_type"]:checked')).map(cb => cb.value),
                    productLines: Array.from(supplierForm.querySelectorAll('input[name="product_line"]:checked')).map(cb => cb.value)
                };

                if (index === "") { // New supplier
                    suppliers.push(newSupplier);
                } else { // Edit existing supplier
                    suppliers[index] = newSupplier;
                }
                supplierForm.reset();
                catEquipamentosCheckbox.dispatchEvent(new Event("change")); // Update product lines visibility
                showSupplierListTab();
            });

            // Profile Picture and Share
            profilePictureContainer.addEventListener("click", () => profilePictureInput.click());

            profilePictureInput.addEventListener("change", e => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById("sidebar-profile-picture").style.backgroundImage = `url('${e.target.result}')`;
                        profilePictureContainer.style.backgroundImage = `url('${e.target.result}')`;
                        document.getElementById("profile-picture-placeholder").classList.add("hidden");
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById("company-whatsapp-button").addEventListener("click", () => {
                shareOnWhatsApp(companyInfo.phone);
            });

            profileShareButton.addEventListener("click", () => {
                shareProfileModal.classList.remove("hidden");
                updateShareMessage();
            });

            closeShareModal.addEventListener("click", () => shareProfileModal.classList.add("hidden"));
            shareProfileModal.addEventListener("click", e => {
                if (e.target === shareProfileModal) {
                    shareProfileModal.classList.add("hidden");
                }
            });

            document.querySelectorAll(".share-option").forEach(checkbox => {
                checkbox.addEventListener("change", updateShareMessage);
            });

            finalShareButton.addEventListener("click", () => {
                const message = shareMessagePreview.innerText;
                shareOnWhatsApp("", message);
            });

            // AI Response Modal
            closeAiModal.addEventListener("click", () => aiResponseModal.classList.add("hidden"));
            aiResponseModal.addEventListener("click", e => {
                if (e.target === aiResponseModal) {
                    aiResponseModal.classList.add("hidden");
                }
            });

            // Customer Help Modal
            closeCustomerHelpModal.addEventListener("click", () => customerHelpModal.classList.add("hidden")); 
            customerHelpModal.addEventListener("click", e => {
                if (e.target === customerHelpModal) {
                    customerHelpModal.classList.add("hidden");
                }
            });

            customerHelpForm.addEventListener("submit", async e => {
                e.preventDefault();
                const productName = document.getElementById("customer-help-product-name").value;
                const productSpec = document.getElementById("customer-help-product-spec").value;
                const customerQuestion = document.getElementById("customer-question").value;

                const prompt = `Responda a seguinte dúvida de um cliente: "${customerQuestion}". Use as seguintes informações sobre o produto para basear sua resposta:\nNome do Produto: ${productName}\nEspecificações: ${productSpec}`;

                customerHelpResponse.innerHTML = '<div class="flex justify-center items-center"><div class="spinner"></div></div>';
                customerHelpResponse.classList.remove("hidden");

                const apiKey = ""; // Canvas will inject the API key
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`; 
                
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        customerHelpResponse.innerText = text;
                    } else {
                        customerHelpResponse.innerText = "Não foi possível gerar uma resposta. Tente novamente.";
                    }
                } catch (error) {
                    console.error("Erro na API Gemini:", error);
                    customerHelpResponse.innerText = "Erro ao conectar com a IA. Verifique o console para mais detalhes.";
                }
            });

            // Initial setup
            populateInstallmentOptions();

            // Setup search and filter for Drones page (no price)
            setupSearchAndFilter('drones', products, createProductCard);

            // Setup search and filter for Consultas page (with price)
            setupSearchAndFilter('consultas', products, createProductCard);
        });
    </script>
</body>
</html>
