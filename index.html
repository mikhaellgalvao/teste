<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Consultas Internas - Galvão Drones</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230E5847'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-12h2v4h4v2h-4v4h-2v-4H7v-2h4V8z'%3E%3C/path%3E%3Cpath d='M13.25 7.15c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L8.4 9.16c-.24.24-.36.58-.36.92s-.12.68.36.92l.71.71c.24.24.58.36.92.36s-.68-.12.92-.36l2.93-2.93c-.24-.24-.36-.58-.36-.92s-.12-.68-.36-.92l-.71-.71zM10.75 16.85c.24.24.58.36.92.36s-.68-.12.92-.36l2.93-2.93c-.24-.24-.36-.58-.36-.92s-.12-.68-.36-.92l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36l-2.93 2.93c-.24.24-.36.58-.36.92s-.12.68.36.92l.71.71zM18.8 8.4l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L13.3 9.77c-.24.24-.36.58-.36.92s-.12.68.36.92l.71.71c-.24.24-.58.36-.92.36s-.68-.12.92-.36l3.85-3.85c-.24-.24-.36-.58-.36.92s-.12-.68-.36-.92zM5.2 15.6l.71.71c-.24.24-.58.36-.92.36s-.68-.12-.92.36l3.85-3.85c-.24.24-.36.58-.36.92s-.12.68-.36.92l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L5.2 14.68c-.24.24-.36.58-.36.92s-.12.68.36.92z'%3E%3C/path%3E%3C/svg%3E" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        :root {
            --primary-color: #EF7E13; /* Laranja Galvão Drones */
            --secondary-color: #0E5847; /* Verde Galvão Drones */
            --light-grey: #f4f7f6; /* Ligeiramente alterado para tom mais suave */
            --medium-grey: #ecf0f1;
            --dark-grey: #bdc3c7;
            --danger-color: #e74c3c;
            --whatsapp-color: #25D366;
            --instagram-color: #C13584;
            --youtube-color: #FF0000;
            --help-color: #5865F2;
        }
        body {
            font-family: 'Roboto', sans-serif; margin: 0; background-color: var(--light-grey); color: #333;
            display: flex; justify-content: center; align-items: center; min-height: 100vh; position: relative;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://images.pexels.com/photos/2246476/pexels-photo-2246476.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            background-size: cover; background-position: center; background-repeat: no-repeat; opacity: 0.1; z-index: -1;
            transition: background-image 0.5s ease-in-out, opacity 0.5s ease-in-out;
        }
        body.visitor-mode-bg::before {
            background-image: url('https://i.imgur.com/b3lg2eE.png'); background-size: contain;
            background-position: center center; background-repeat: no-repeat; opacity: 0.5;
        }
        .container { width: 100%; max-width: 1200px; margin: 20px; z-index: 1; }
        #login-screen {
            background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%; max-width: 400px; text-align: center; transition: opacity 0.5s ease; margin: auto;
        }
        #company-logo { max-width: 300px; width: 80%; display: block; margin: 0 auto 10px auto; }
        #portal-subtitle { color: #555; margin-top: 0; margin-bottom: 40px; font-size: 1.2em; font-weight: 400; }
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: 500; color: #555; }
        .input-group input, .input-group select, .input-group textarea {
            width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 16px; font-family: 'Roboto', sans-serif;
        }
        .action-button {
            width: 100%; padding: 15px; background-color: var(--primary-color); color: white; border: none;
            border-radius: 5px; font-size: 18px; font-weight: 700; cursor: pointer; transition: background-color 0.3s; margin-top: 10px;
        }
        .action-button:hover { opacity: 0.9; }
        #login-error { color: var(--danger-color); margin-top: 15px; font-weight: 500; display: none; }
        #visitor-mode-button { background-color: var(--dark-grey); }
        #visitor-mode-button:hover { background-color: #95a5a6; }
        #app-screen {
            display: none; background-color: white; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden; transition: opacity 0.5s ease;
        }
        header {
            background-color: var(--secondary-color); color: white; padding: 15px 25px;
            display: flex; justify-content: space-between; align-items: center; height: 60px;
            position: relative;
            z-index: 1000;
        }
        header > #nav-toggle-btn {
            display: none;
        }
        #profile-icon-container {
            width: 40px; height: 40px; border-radius: 50%; overflow: hidden; cursor: pointer;
            border: 2px solid white; display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; transition: transform 0.2s ease-in-out; order: 0; margin-right: 15px;
        }
        #profile-icon-container:hover { transform: scale(1.05); }
        #profile-icon { width: 100%; height: 100%; object-fit: cover; display: block; }
        .header-left { display: flex; align-items: center; gap: 10px; height: 100%; order: 1; flex-grow: 0; justify-content: flex-start; }
        .header-title-container { order: 2; flex-grow: 1; text-align: center; }
        header > div:last-child { order: 3; margin-left: 15px; }
        header h1 { margin: 0; font-size: 24px; }
        header #logout-button {
            background-color: var(--danger-color); color: white; border: none;
            padding: 8px 15px; border-radius: 5px; font-weight: 500; cursor: pointer;
            transition: background-color 0.3s; display: block;
        }
        header #logout-button:hover { background-color: #c0392b; }
        .visitor-header #welcome-message { display: none; }
        #change-password-link { display: none !important; }
        .app-body { display: flex; position: relative; min-height: calc(100vh - 60px); }
        nav {
            width: 200px; min-width: 200px; background-color: var(--medium-grey); padding: 20px 0;
            border-right: 1px solid var(--dark-grey); transition: transform 0.3s ease; box-sizing: border-box;
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        .nav-item-group { width: 100%; position: relative; }
        .sub-nav { background-color: var(--dark-grey); padding-left: 10px; }
        .sub-nav-button { font-size: 0.95em; padding: 10px 20px; border-bottom: 1px solid #c0c0c0; }
        .sub-nav-button:last-child { border-bottom: none; }
        .sub-nav-button.active, .sub-nav-button:hover { background-color: #a0a0a0; color: white; }
        @media (max-width: 768px) {
            nav {
                position: fixed; top: 0; left: 0; height: 100vh; width: 250px; min-width: 250px;
                transform: translateX(-100%); z-index: 999; box-shadow: 2px 0 5px rgba(0,0,0,0.2);
                padding-top: 60px; /* Deixa espaço para o header fixo */
                border-right: 1px solid var(--dark-grey);
            }
            nav.nav-open { transform: translateX(0); }
            .nav-header {
                display: flex; position: absolute; top: 0; width: 100%; height: 60px;
                background-color: var(--secondary-color); color: white; padding: 15px 20px;
                box-sizing: border-box; align-items: center;
            }
            .nav-header #nav-toggle-btn-close { font-size: 24px; background: none; border: none; color: white; cursor: pointer; padding: 0 10px; }
            .nav-header span { flex-grow: 1; text-align: center; margin-left: -20px; font-size: 1.2em; }
            .app-body { flex-direction: column; min-height: calc(100vh - 60px); }
            main { width: 100%; box-sizing: border-box; }
            header {
                padding: 10px 15px;
                position: sticky; /* Mantém o cabeçalho fixo no topo */
                top: 0;
                z-index: 1001;
                display: flex;
                align-items: center;
            }
            header h1 { font-size: 20px; }
            header > #nav-toggle-btn {
                display: block;
                order: -1; /* Força o botão a ser o primeiro elemento visual */
                margin-right: 10px; /* Espaçamento após o botão */
                font-size: 24px;
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                padding: 0;
            }
            header > #profile-icon-container { order: 0; margin-right: 10px; } /* Ajusta ordem */
            header > .header-left { order: 1; flex-grow: 1; justify-content: flex-start; } /* Ajusta ordem */
            header > .header-title-container { order: 2; flex-grow: 0; text-align: left; margin-left: auto; } /* Ajusta ordem */
            header > div:last-child { order: 3; } /* Ajusta ordem */

            #welcome-message {
                margin-left: 0; flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
                flex-shrink: 1; min-width: 0;
            }
            #profile-icon-container { margin-left: 5px; width: 35px; height: 35px; }
        }
        nav button {
            display: block; width: 100%; padding: 15px 20px; background: none; border: none;
            text-align: left; font-size: 16px; cursor: pointer; border-bottom: 1px solid #ddd;
            transition: background-color 0.3s, color 0.3s;
        }
        nav button.active, nav button:hover { background-color: var(--dark-grey); color: var(--secondary-color); font-weight: 700; }
        .nav-header {
            display: none; align-items: center; padding: 15px 20px;
            background-color: var(--dark-grey); color: var(--secondary-color); font-weight: 700;
        }
        .nav-header span { margin-left: 10px; }
        main {
            flex-grow: 1; padding: 30px; max-height: calc(100vh - 60px);
            overflow-y: auto; position: relative; transition: margin-left 0.3s ease;
        }
        @media (max-width: 768px) {
            main { padding: 20px; max-height: calc(100vh - 60px); width: 100%; }
            .header-left { gap: 10px; flex-grow: 1; }
            #welcome-message { margin-left: 0; flex-grow: 1; }
        }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .content-section h2, .content-section h3 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; color: var(--secondary-color); }
        .content-section h3 { border-bottom: 1px solid var(--dark-grey); font-size: 1.2em; margin-top: 30px; }
        #settings-options-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px; margin-top: 30px;
        }
        #settings-options-grid .card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
        #settings-options-grid .card h3 { color: var(--primary-color); font-size: 1.5em; margin-bottom: 10px; border-bottom: none; }
        #settings-options-grid .card p { font-size: 0.9em; color: #666; }
        .back-to-settings-button {
            background-color: var(--dark-grey); color: white; border: none; padding: 10px 15px;
            border-radius: 5px; cursor: pointer; font-weight: 500; transition: background-color 0.3s;
            margin-bottom: 20px; display: inline-block; width: auto;
        }
        .back-to-settings-button:hover { background-color: #95a5a6; }
        .search-bar { margin-bottom: 20px; position: relative; }
        .search-bar input {
            width: 100%; padding: 12px 12px 12px 40px; font-size: 16px; border-radius: 5px;
            border: 1px solid #ccc; box-sizing: border-box;
        }
        .search-bar::before {
            content: '🔎'; position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 18px; opacity: 0.6;
        }
        .card {
            position: relative; border: 1px solid #ddd; padding: 20px; margin-bottom: 15px;
            border-radius: 5px; transition: box-shadow 0.3s; z-index: 1;
        }
        .card::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("logo.png"); background-size: 50%; background-position: center;
            background-repeat: no-repeat; opacity: 0.15; z-index: -1; border-radius: 5px;
        }
        .card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .card h3 { margin-top: 0; color: var(--secondary-color); border: none; font-size: 1.3em; }
        .product-card { border-left: 5px solid var(--primary-color); }
        .supplier-card { border-left: 5px solid var(--secondary-color); }
        .info-card { border-left: 5px solid var(--secondary-color); }
        .product-spec { white-space: pre-wrap; line-height: 1.6; font-size: 0.95em; }
        .price { font-size: 1.2em; font-weight: 700; color: #27ae60; }
        .cost-price { font-size: 1.1em; font-weight: 700; color: var(--danger-color); background-color: #fdd; padding: 5px; border-radius: 4px; display: inline-block; margin-top: 10px; }
        .supplier-info { font-size: 0.9em; font-weight: 500; color: var(--secondary-color); background-color: #e8f8f5; padding: 5px 8px; border-radius: 4px; display: inline-block; margin-top: 10px; margin-left: 10px;}
        .product-suppliers-list { list-style: none; padding: 0; margin: 10px 0 0 0; font-size: 0.9em; }
        .product-suppliers-list li {
            background-color: #f8f8f8; padding: 5px 10px; border-radius: 3px;
            margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee;
        }
        .product-suppliers-list li .supplier-name-link { color: var(--secondary-color); text-decoration: none; font-weight: bold; }
        .product-suppliers-list li .cost-value { color: var(--danger-color); font-weight: 500; }
        .action-buttons-container { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; }
        .action-buttons-container button, .action-buttons-container a.action-button {
            color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;
            font-weight: 500; transition: background-color 0.3s; font-size: 0.9em; text-decoration: none;
            display: inline-flex; align-items: center; justify-content: center;
        }
        .gemini-button { background-color: var(--secondary-color); }
        .whatsapp-button { background-color: var(--whatsapp-color); }
        .instagram-button { background-color: var(--instagram-color); }
        .youtube-button { background-color: var(--youtube-color); }
        .google-maps-button { background-color: #4285F4; }
        .help-button { background-color: var(--help-color); }
        .action-buttons-container button:hover, .action-buttons-container a.action-button:hover { opacity: 0.9; }
        .calculator-container { margin-top: 20px; padding-top: 20px; border-top: 1px dashed var(--dark-grey); }
        .payment-method-selector label { display: inline-block; margin-right: 15px; cursor: pointer; font-size: 0.95em; }
        .payment-method-selector input { margin-right: 5px; }
        .installments-container { margin-top: 10px; }
        .calculate-product-btn { background-color: var(--secondary-color); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px;}
        .product-calculator-result, #general-calculator-result { margin-top: 15px; font-size: 1.1em; color: var(--secondary-color); background-color: #eaf5ff; padding: 15px; border-radius: 5px; }
        .result-vista { font-weight: bold; }
        .result-parcelado { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--dark-grey); }
        .result-parcelado small { font-size: 0.9em; font-weight: normal; color: #555; }
        .discount-option { margin-top: 10px; display: flex; align-items: center; gap: 10px; position: relative; }
        .discount-option input[type="number"] {
            width: 80px; padding: 8px; border-radius: 4px; border: 1px solid #ccc;
            background-color: transparent; position: relative; z-index: 1;
        }
        .discount-option label { margin-bottom: 0; }
        .discount-option::after {
            content: "max. 15%"; position: absolute; left: 105px; color: #ccc;
            font-size: 0.8em; opacity: 0.8; pointer-events: none; white-space: nowrap; transform: translateY(2px); z-index: 0;
        }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); padding-top: 60px; }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; position: relative; }
        .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .loader { border: 8px solid #f3f3f3; border-radius: 50%; border-top: 8px solid var(--primary-color); width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #scroll-to-top { position: fixed; bottom: 20px; right: 30px; z-index: 99; border: none; outline: none; background-color: var(--primary-color); color: white; cursor: pointer; padding: 12px 15px; border-radius: 50%; font-size: 18px; display: none; }
        #temp-user-list-container { margin-top: 30px; }
        .temp-user-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--medium-grey); }
        .temp-user-item:last-child { border-bottom: none; }
        .user-info p { margin: 0; }
        .user-info p small { color: #555; }
        .user-actions button { margin-left: 10px; padding: 5px 10px; border-radius: 4px; border: none; color: white; cursor: pointer; }
        .edit-btn { background-color: var(--primary-color); }
        .delete-btn { background-color: var(--danger-color); }
        .hidden { display: none !important; }
        #ai-chat-button {
            position: fixed; bottom: 90px; right: 30px; z-index: 99; border: none; outline: none;
            background-color: var(--secondary-color); color: white; cursor: pointer;
            padding: 15px 18px; border-radius: 50%; font-size: 24px; display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: background-color 0.3s, transform 0.3s;
        }
        #ai-chat-button:hover { background-color: #0A4538; transform: translateY(-3px); }
        #ai-chat-button:active { transform: translateY(0); }
        #ai-chat-modal .modal-content { max-width: 700px; text-align: left; }
        #ai-chat-modal-body { text-align: left; }
        #ai-question-input {
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;
            box-sizing: border-box; font-size: 1em; margin-bottom: 15px;
        }
        #submit-ai-question { width: auto; padding: 10px 20px; font-size: 1em; }
        #ai-response-area { white-space: pre-wrap; max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; }
        #supplier-password-modal .modal-content { max-width: 400px; text-align: center; }
        #supplier-password-modal .input-group input { text-align: center; }
        #supplier-password-modal .error-message { color: var(--danger-color); margin-top: 10px; display: none; }
        #change-password-modal .modal-content { max-width: 450px; text-align: center; }
        #change-password-modal .input-group { margin-bottom: 15px; }
        #change-password-modal .input-group label { font-size: 0.9em; }
        #change-password-modal .error-message { color: var(--danger-color); margin-top: 10px; font-weight: 500; display: none; }
        #change-password-modal .success-message { color: var(--secondary-color); margin-top: 10px; font-weight: 500; display: none; }
        #profile-section .profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
        #profile-section .profile-pic-large { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary-color); box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        #profile-section .profile-info h3 { margin: 0; font-size: 1.8em; color: var(--secondary-color); border-bottom: none; }
        #profile-section .profile-info p { margin: 5px 0; font-size: 1.1em; color: #555; }
        #profile-section .profile-edit-form .input-group { margin-bottom: 15px; }
        #profile-section .profile-edit-form .action-button { width: auto; padding: 10px 20px; margin-right: 10px; }
        #profile-section .profile-edit-form .action-button.secondary { background-color: var(--dark-grey); }
        #profile-section .profile-edit-form .action-button.secondary:hover { background-color: #95a5a6; }
        #profile-section .profile-feedback { margin-top: 15px; font-weight: bold; }
        #profile-section .profile-pic-upload-container { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        #profile-section .profile-pic-upload-container input[type="file"] { flex-grow: 1; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
        #profile-section .profile-pic-upload-container button { padding: 8px 15px; background-color: var(--secondary-color); color: white; border: none; border-radius: 5px; cursor: pointer; }
        #whatsapp-modal .modal-content { max-width: 500px; text-align: left; }
        #whatsapp-modal textarea {
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;
            box-sizing: border-box; font-size: 1em; min-height: 120px; margin-bottom: 15px;
        }
        #whatsapp-modal .profile-info-options { margin-bottom: 15px; }
        #whatsapp-modal .profile-info-options label { display: block; margin-bottom: 8px; font-weight: normal; font-size: 0.95em; }
        #whatsapp-modal .profile-info-options input[type="checkbox"] { margin-right: 8px; }
        #whatsapp-modal .action-button-group { display: flex; justify-content: flex-end; gap: 10px; }
        #whatsapp-modal .action-button-group .action-button { width: auto; }
        #whatsapp-modal .action-button-group .cancel-button { background-color: var(--dark-grey); }
        #whatsapp-modal .action-button-group .cancel-button:hover { background-color: #95a5a6; }

        /* Estilos para o novo modal de orçamento */
        #budget-modal .modal-content { max-width: 500px; }
        #budget-modal .modal-body-content div { margin-bottom: 15px; }
        #budget-modal .modal-body-content select, #budget-modal .modal-body-content textarea {
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;
        }
        #budget-modal .modal-body-content textarea { min-height: 100px; }
        #budget-modal .supplier-contact-info {
            display: flex; align-items: center; justify-content: space-between;
            background-color: var(--light-grey); padding: 10px; border-radius: 5px; margin-top: 15px;
        }
        #budget-modal .supplier-contact-info img { width: 40px; height: 40px; margin-right: 10px; }
        #budget-modal .supplier-contact-info .whatsapp-button { width: auto; margin-top: 0; }

        /* Estilos para os checkboxes do modal de orçamento */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal; /* Sobrescreve o estilo default de label */
        }
        .checkbox-group input[type="checkbox"] {
            margin-right: 5px;
            width: auto; /* Para não pegar o width: 100% de input-group input */
            padding: 0; /* Para não pegar o padding de input-group input */
            height: auto; /* Para não pegar o height de input-group input */
            box-sizing: content-box; /* Garante que padding e border não aumentem o tamanho */
        }

        .supplier-contacts-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .supplier-contacts-list li {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .edit-supplier-button {
            background-color: var(--dark-grey);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: auto; /* Empurra o botão para a direita */
            transition: background-color 0.3s;
        }

        .edit-supplier-button:hover {
            background-color: #95a5a6;
        }

        /* Modal para criar/editar fornecedor */
        #manage-supplier-modal .modal-content {
            max-width: 600px;
            text-align: left;
        }

        #manage-supplier-modal .input-group {
            margin-bottom: 10px;
        }

        #manage-supplier-modal .input-group label {
            margin-bottom: 3px;
            font-size: 0.9em;
        }

        #manage-supplier-modal .checkbox-group label {
            font-size: 0.9em;
        }

        #manage-supplier-modal .contact-entry {
            border: 1px solid var(--medium-grey);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            position: relative;
        }

        #manage-supplier-modal .remove-contact-button {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 0.8em;
            cursor: pointer;
        }

        #manage-supplier-modal .add-contact-button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* Modal de Busca para Alterar Fornecedor */
        #edit-supplier-search-modal .modal-content {
            max-width: 450px;
        }
        #edit-supplier-search-results-modal li {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #edit-supplier-search-results-modal li:hover {
            background-color: var(--light-grey);
        }
        /* Novas regras para o botão de filtro e o modal de filtro */
        .filter-sort-button {
            /* Removendo padding horizontal para deixar apenas o ícone centralizado */
            padding: 10px; 
            border-radius: 50%; /* Torna o botão circular */
            width: 40px; /* Largura e altura iguais para ser circular */
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em; /* Tamanho do ícone */
            margin-bottom: 15px;
            margin-left: auto; /* Alinha à direita */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* Sombra para destacar */
            /* Garante que o ícone em si seja da cor correta */
            color: white; 
            background-color: var(--secondary-color);
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .filter-sort-button:hover {
            background-color: #0A4538;
            transform: translateY(-2px);
        }
        .filter-sort-button:active {
            transform: translateY(0);
        }

        #filter-sort-modal .modal-content {
            max-width: 400px;
            margin: 10vh auto; /* Para ficar mais acima na tela */
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border: none; /* Remove a borda padrão do modal */
        }
        #filter-sort-modal .modal-body-content {
            padding: 10px;
        }
        #filter-sort-modal .modal-body-content h4 {
            margin-top: 15px; /* Adicionado um pouco de margem superior */
            margin-bottom: 10px;
            color: var(--primary-color);
            border-bottom: 1px solid var(--medium-grey);
            padding-bottom: 5px;
        }
        #filter-sort-modal .filter-options,
        #filter-sort-modal .sort-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        #filter-sort-modal .filter-options button,
        #filter-sort-modal .sort-options button {
            background-color: var(--medium-grey);
            color: var(--secondary-color);
            border: 1px solid var(--dark-grey);
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
            flex-shrink: 0; /* Impede que o botão encolha em telas pequenas */
        }
        #filter-sort-modal .filter-options button.active,
        #filter-sort-modal .sort-options button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: bold;
        }
        #filter-sort-modal .filter-options button:hover,
        #filter-sort-modal .sort-options button:hover {
            background-color: var(--light-grey);
            border-color: var(--primary-color);
        }
        #filter-sort-modal .search-filter-input {
            width: calc(100% - 20px); /* Ajustado para padding */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            margin-top: 10px;
            margin-bottom: 15px; /* Adicionado margem inferior */
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="login-screen">
            <img src="https://i.imgur.com/pgwtkKq.png" alt="Logotipo Galvão Drones" id="company-logo">
            <h2 id="portal-subtitle">Portal Interno</h2>
            <div class="input-group"><label for="username">Usuário</label><input type="text" id="username" placeholder="Digite seu nome"></div>
            <div class="input-group"><label for="password">Senha</label><input type="password" id="password" placeholder="Sua senha"></div>
            <button id="login-button" class="action-button">Entrar</button>
            <button id="visitor-mode-button" class="action-button">Modo Visitante</button>
            <p id="login-error">Usuário ou senha inválidos.</p>
        </div>

        <div id="app-screen">
            <header>
                <button id="nav-toggle-btn" class="nav-toggle-btn">☰</button>
                <div id="profile-icon-container">
                    <img id="profile-icon" src="https://i.imgur.com/8Yd00YF.png" alt="Foto de Perfil">
                </div>
                <div class="header-left">
                    <span id="welcome-message"></span>
                </div>
                <div class="header-title-container">
                    <h1>Portal Interno</h1>
                </div>
                <div>
                    <button id="logout-button">Sair</button>
                </div>
            </header>
            <div class="app-body">
                <nav>
                    <div class="nav-header">
                        <button id="nav-toggle-btn-close" class="nav-toggle-btn">✕</button>
                        <span>Menu</span>
                    </div>
                    <button class="nav-button" data-section="products-section" id="products-nav-button" style="order: 1;">Produtos</button>
                    <button class="nav-button" data-section="calculator-section" id="calculator-nav-button" style="order: 2;">Calculadora</button>
                    <button class="nav-button" data-section="suppliers-section" id="suppliers-nav-button" style="order: 3;">Fornecedores</button>

                    <div class="nav-item-group" style="order: 4;">
                        <button class="nav-button" data-section="settings-section" id="settings-nav-button">Configurações</button>
                        <div class="sub-nav" id="settings-sub-nav" style="display: none;">
                            <button class="nav-button sub-nav-button" data-section="manage-users-section" id="manage-users-nav-button">Gerir Usuários</button>
                            <button class="nav-button sub-nav-button" data-section="create-product-section" id="create-product-nav-button">Criar Produto</button>
                            <button class="nav-button sub-nav-button" data-section="edit-product-section" id="edit-product-nav-button">Alterar Produto</button>
                        </div>
                    </div>

                    <button class="nav-button" data-section="drones-visitor-section" id="drones-nav-button" style="order: 5;">Drones</button>
                    <button class="nav-button" data-section="info-section" id="info-empresa-nav-button" style="order: 6;">Info Empresa</button>
                    <button class="nav-button" data-section="marketing-section" id="marketing-nav-button" style="order: 7;">Marketing</button>
                    <button class="nav-button hidden" data-section="profile-section" id="profile-nav-button" style="order: 8;">Meu Perfil</button>
                </nav>
                <main id="main-content">
                    <section id="products-section" class="content-section active">
                        <h2>Consulta de Produtos</h2>
                        <div class="search-bar"><input type="text" id="product-search" placeholder="Pesquisar por nome ou especificação..."></div>
                        <button id="open-product-filter-sort-modal" class="filter-sort-button" title="Filtros e Ordenação">
                            <i class="fas fa-sliders-h"></i>
                        </button>
                        <div id="product-list"></div>
                    </section>
                    <section id="calculator-section" class="content-section">
                        <h2>Calculadora Geral</h2>
                        <div class="card">
                           <div class="input-group">
                                <label for="general-valor-base">Valor Base</label>
                                <input type="number" id="general-valor-base" class="input-full" placeholder="Digite o valor para simulação">
                           </div>
                           <div class="input-group">
                                <label>Forma de Pagamento</label>
                                <div id="general-payment-method-selector">
                                    <input type="radio" id="general-payment-vista" name="general-payment-method" value="vista" checked>
                                    <label for="general-payment-vista">À vista</label>
                                    <input type="radio" id="general-payment-parcelado" name="general-payment-method" value="parcelado">
                                    <label for="general-payment-parcelado">Parcelado</label>
                                </div>
                           </div>
                           <div class="discount-option hidden" id="general-discount-option">
                               <label for="general-discount-percentage">Desconto (%):</label>
                               <input type="number" id="general-discount-percentage" min="0" max="15" value="0">
                           </div>
                           <div class="input-group hidden" id="general-installments-container">
                                <label for="general-parcelas">Número de Parcelas</label>
                                <select id="general-parcelas">
                                    <option value="1">1x</option><option value="2">2x</option><option value="3">3x</option><option value="4">4x</option><option value="5">5x</option><option value="6">6x</option><option value="7">7x</option><option value="8">8x</option><option value="9">9x</option><option value="10">10x</option><option value="11">11x</option><option value="12">12x</option>
                                </select>
                           </div>
                           <button id="general-calculate-button" class="action-button" style="width: auto; padding: 10px 20px;">Calcular</button>
                           <div id="general-calculator-result">O resultado da simulação aparecerá aqui.</div>
                          </div>
                    </section>
                    <section id="suppliers-section" class="content-section">
                        <h2>Fornecedores (Acesso Confidencial)</h2>
                        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                            <button id="open-budget-modal-button" class="action-button" style="width: auto;">Fazer Orçamento</button>
                            <button id="open-create-supplier-modal-button" class="action-button" style="width: auto; background-color: var(--secondary-color);">Criar Fornecedor</button>
                            <button id="open-edit-supplier-search-modal-button" class="action-button" style="width: auto; background-color: var(--secondary-color);">Alterar Fornecedor</button>
                        </div>
                        <button id="open-supplier-filter-sort-modal" class="filter-sort-button" title="Filtros e Ordenação">
                            <i class="fas fa-sliders-h"></i>
                        </button>
                        <div id="supplier-list"></div>
                    </section>

                    <section id="settings-section" class="content-section">
                        <h2>Configurações do Sistema</h2>
                        <p>Selecione uma opção de configuração no menu lateral, ou clique nos atalhos abaixo:</p>
                        <div id="settings-options-grid"></div>
                    </section>

                    <section id="manage-users-section" class="content-section">
                        <button class="back-to-settings-button" onclick="window.switchTab('settings-section')">← Voltar para Configurações</button>
                        <h2>Gerir Usuários Temporários</h2>
                        <div class="card">
                            <h3>Criar Usuário Temporário</h3>
                            <form id="create-temp-user-form">
                                <div class="input-group"><label for="temp-username">Nome de Usuário</label><input type="text" id="temp-username" required></div>
                                <div class="input-group"><label for="temp-password">Senha</label><input type="text" id="temp-password" required></div>
                                <div class="input-group"><label for="temp-duration">Duração do Acesso</label><select id="temp-duration"><option value="1">1 Hora</option><option value="8">8 Horas</option><option value="24" selected>24 Horas</option><option value="72">72 Horas</option></select></div>
                                <button type="submit" class="action-button">Criar Usuário</button>
                                <p id="temp-user-feedback" style="margin-top: 15px; font-weight: bold;"></p>
                            </form>
                        </div>
                        <div id="temp-user-list-container">
                            <h3>Usuários Temporários Ativos</h3>
                            <div id="temp-user-list" class="card"></div>
                        </div>
                    </section>

                    <section id="create-product-section" class="content-section">
                        <button class="back-to-settings-button" onclick="window.switchTab('settings-section')">← Voltar para Configurações</button>
                        <h2>Criar Novo Produto</h2>
                        <div class="card">
                            <form id="create-product-form">
                                <div class="input-group"><label for="new-product-name">Nome do Produto</label><input type="text" id="new-product-name" required></div>
                                <div class="input-group"><label for="new-product-spec">Especificações</label><textarea id="new-product-spec" rows="5"></textarea></div>
                                <div class="input-group"><label for="new-product-sale-price">Preço de Venda (R$)</label><input type="number" id="new-product-sale-price" step="0.01" min="0" required></div>
                                <div class="input-group"><label for="new-product-cost-price">Preço de Custo (R$)</label><input type="number" id="new-product-cost-price" step="0.01" min="0"></div>
                                <div class="input-group">
                                    <label for="new-product-supplier">Fornecedor Principal</label>
                                    <select id="new-product-supplier">
                                        </select>
                                </div>
                                <button type="submit" class="action-button">Salvar Novo Produto</button>
                                <p id="create-product-feedback" style="margin-top: 15px; font-weight: bold;"></p>
                            </form>
                        </div>
                    </section>

                    <section id="edit-product-section" class="content-section">
                        <button class="back-to-settings-button" onclick="window.switchTab('settings-section')">← Voltar para Configurações</button>
                        <h2>Alterar Produto Existente</h2>
                        <div class="card">
                            <div class="input-group">
                                <label for="edit-product-search-input">Buscar Produto (ID ou Nome)</label>
                                <input type="text" id="edit-product-search-input" placeholder="Digite o ID ou nome do produto">
                                <button id="search-product-to-edit" class="action-button" style="width: auto; margin-top: 10px;">Buscar</button>
                            </div>
                            <div id="edit-product-search-results" style="margin-top: 15px;"></div>

                            <div id="edit-product-display" style="margin-top: 20px;">
                                <p>Use a busca acima para carregar os dados do produto.</p>
                            </div>
                            <form id="edit-product-form" class="hidden">
                                <input type="hidden" id="edit-product-id">
                                <div class="input-group"><label for="edit-product-name">Nome do Produto</label><input type="text" id="edit-product-name" required></div>
                                <div class="input-group"><label for="edit-product-spec">Especificações</label><textarea id="edit-product-spec" rows="5"></textarea></div>
                                <div class="input-group"><label for="edit-product-sale-price">Preço de Venda (R$)</label><input type="number" id="edit-product-sale-price" step="0.01" min="0" required></div>
                                <div class="input-group"><label for="edit-product-cost-price">Preço de Custo (R$)</label><input type="number" id="edit-product-cost-price" step="0.01" min="0"></div>
                                <div class="input-group">
                                    <label for="edit-product-supplier">Fornecedor Principal</label>
                                    <select id="edit-product-supplier">
                                        </select>
                                </div>
                                <button type="submit" class="action-button">Salvar Alterações</button>
                                <p id="edit-product-feedback" class="profile-feedback"></p>
                            </form>
                        </div>
                    </section>

                    <section id="drones-visitor-section" class="content-section">
                        <h2>Modelos de Drones</h2>
                        <div class="search-bar"><input type="text" id="drone-visitor-search" placeholder="Pesquisar por modelo ou especificação..."></div>
                        <div id="drone-visitor-list"></div>
                    </section>
                    <section id="info-section" class="content-section">
                        <h2>Informações da Empresa</h2>
                        <div class="card info-card">
                            <p><strong>Nome da Empresa:</strong> Galvão Drones</p>
                            <p id="cnpj-display-line"><strong>CNPJ:</strong> 60.102.179/0001-10</p>
                            <p><strong>Endereço:</strong> Rua 16, nº 304 – Setor Aeroviário, Goiânia – GO, CEP: 74435-240</p>
                            <p><a href="https://www.google.com/maps/search/?api=1&query=Rua+16,+304,+Setor+Aerovi%C3%A1rio,+Goi%C3%A2nia+-+GO,+74435-240" target="_blank" class="action-button google-maps-button" style="width: auto; padding: 10px 15px; margin-right: 10px;">Ver no Google Maps</a></p>
                            <p><strong>Contato:</strong> <span id="company-phone">(62) 3636-0668</span></p>
                            <div class="contact-buttons-container" style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                                <a href="https://www.instagram.com/galvao_drones" target="_blank" class="action-button instagram-button" style="width: auto; padding: 10px 15px;">Instagram</a>
                                <a href="https://wa.me/556236360668" target="_blank" class="action-button whatsapp-button" id="company-whatsapp-link" style="width: auto; padding: 10px 15px;">WhatsApp</a>
                                <a href="https://www.youtube.com/@galvaodrones" target="_blank" class="action-button youtube-button" style="width: auto; padding: 10px 15px;">YouTube</a>
                            </div>
                            <p><strong>Website:</strong> <a href="https://www.galvaodrones.com.br" target="_blank">www.galvaodrones.com.br</a></p>
                        </div>
                    </section>

                    <section id="profile-section" class="content-section">
                        <h2>Meu Perfil</h2>
                        <div class="card">
                            <div class="profile-header">
                                <img id="profile-pic-display" src="https://i.imgur.com/8Yd00YF.png" alt="Foto de Perfil">
                                <div class="profile-info">
                                    <h3 id="profile-display-name"></h3>
                                    <p id="profile-email"></p>
                                    <p id="profile-phone"></p>
                                </div>
                            </div>
                            <form id="profile-edit-form" class="profile-edit-form">
                                <h3>Alterar Dados</h3>
                                <div class="input-group">
                                    <label for="edit-display-name">Nome de Exibição</label>
                                    <input type="text" id="edit-display-name" required>
                                </div>
                                <div class="input-group">
                                    <label for="edit-email">Email</label>
                                    <input type="email" id="edit-email">
                                </div>
                                <div class="input-group">
                                    <label for="edit-phone">Celular para Atendimento (WhatsApp)</label>
                                    <input type="tel" id="edit-phone" placeholder="Ex: 62988887777">
                                </div>
                                <div class="input-group profile-pic-upload-container">
                                    <label for="edit-profile-pic">Alterar Foto de Perfil</label>
                                    <input type="file" id="edit-profile-pic" accept="image/*">
                                    <button type="button" id="upload-profile-pic-button">Carregar Foto</button>
                                </div>
                                <button type="submit" class="action-button">Salvar Alterações do Perfil</button>
                                <button type="button" id="open-change-password-modal" class="action-button secondary">Alterar Senha</button>
                                <p id="profile-feedback" class="profile-feedback"></p>
                            </form>
                        </div>
                    </section>

                    <section id="marketing-section" class="content-section">
                        <h2>Conteúdo para Marketing</h2>
                        <p>Aqui você encontra materiais visuais e informativos para suas campanhas de marketing da Galvão Drones.</p>
                        <div class="marketing-content">
                            <div class="marketing-item">
                                <h3>Logo Oficial Galvão Drones (Cor Padrão - PNG)</h3>
                                <img src="https://i.imgur.com/pgwtkKq.png" alt="Logo Galvão Drones Cor Padrão">
                                <a href="https://i.imgur.com/pgwtkKq.png" download="galvao_drones_logo_padrao.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Oficial Galvão Drones (Fundo Transparente - PNG)</h3>
                                <img src="https://i.imgur.com/ZsH8VeQ.png" alt="Logo Galvão Drones Fundo Transparente">
                                <a href="https://i.imgur.com/ZsH8VeQ.png" download="galvao_drones_logo_transparente.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Galvão Drones (Versão Clara - PNG)</h3>
                                <img src="https://i.imgur.com/0CpzT9r.png" alt="Logo Galvão Drones Versão Clara">
                                <a href="https://i.imgur.com/0CpzT9r.png" download="galvao_drones_logo_clara.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Galvão Drones (Versão Esverdeada - PNG)</h3>
                                <img src="https://i.imgur.com/UX00mxn.png" alt="Logo Galvão Drones Versão Esverdeada">
                                <a href="https://i.imgur.com/UX00mxn.png" download="galvao_drones_logo_esverdeada.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Galvão Drones (Fundo Laranja - JPG)</h3>
                                <img src="https://i.imgur.com/b9gygL7.png" alt="Logo Galvão Drones Fundo Laranja">
                                <a href="https://i.imgur.com/b9gygL7.png" download="galvao_drones_logo_fundo_laranja.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Logo Galvão Drones (Fundo Preto - JPG)</h3>
                                <img src="https://i.imgur.com/5dpZZuY.png" alt="Logo Galvão Drones Fundo Preto">
                                <a href="https://i.imgur.com/5dpZZuY.png" download="galvao_drones_logo_fundo_preto.png" class="download-button">Baixar Logo PNG</a>
                            </div>
                            <div class="marketing-item">
                                <h3>Guia de Estilo da Marca Galvão Drones</h3>
                                <p>Um PDF completo com diretrizes de uso da marca, paleta de cores e tipografia.</p>
                                <a href="https://drive.google.com/uc?export=download&id=1bcg8UuCBSfaPB5ktacHz5KfWgGY5ir-a" download="guia_de_estilo_galvao_drones.pdf" class="download-button">Baixar Guia de Estilo (PDF)</a>
                            </div>
                        </div>
                    </section>
                </main>
            </div>
        </div>
    </div>

    <button id="scroll-to-top" title="Voltar ao topo">⬆</button>
    <button id="ai-chat-button" title="Falar com a IA">🤖</button>

    <div id="main-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h3 id="modal-title">Aviso</h3>
            <div id="modal-body"></div>
        </div>
    </div>

    <div id="ai-chat-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h3>Fale com a IA da Galvão Drones</h3>
            <div id="ai-chat-modal-body">
                <div class="input-group">
                    <label for="ai-question-input">Qual a sua pergunta?</label>
                    <textarea id="ai-question-input" rows="4" placeholder="Ex: Quais as principais diferenças entre o DJI Mini 4 Pro e o Air 3S?"></textarea>
                </div>
                <button id="submit-ai-question" class="action-button">Enviar Pergunta</button>
                <div class="loader" style="display: none;"></div>
                <div id="ai-response-area" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <div id="supplier-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="supplier-password-close-button">×</span>
            <h3>Acesso Restrito</h3>
            <p>Por favor, digite a senha para acessar as informações de fornecedores:</p>
            <div class="input-group">
                <input type="password" id="supplier-access-password" placeholder="Digite a senha">
            </div>
            <button id="submit-supplier-password" class="action-button">Acessar</button>
            <p id="supplier-password-error" class="error-message">Senha incorreta.</p>
        </div>
    </div>

    <div id="change-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="change-password-close-button">×</span>
            <h3 id="change-password-modal-title">Alterar Senha</h3>
            <p id="change-password-message">Por favor, defina uma nova senha para sua conta.</p>
            <div class="input-group">
                <label for="new-password">Nova Senha (mín. 6 dígitos)</label>
                <input type="password" id="new-password">
            </div>
            <div class="input-group">
                <label for="confirm-new-password">Confirmar Nova Senha</label>
                <input type="password" id="confirm-new-password">
            </div>
            <button id="submit-change-password" class="action-button">Salvar Nova Senha</button>
            <p id="change-password-error" class="error-message">Senhas não conferem ou são muito curtas.</p>
            <p id="change-password-success" class="success-message">Senha alterada com sucesso!</p>
        </div>
    </div>

    <div id="whatsapp-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="whatsapp-close-button">×</span>
            <h3>Personalizar Mensagem do WhatsApp</h3>
            <textarea id="whatsapp-message-input"></textarea>
            <div class="profile-info-options">
                <h4>Incluir Informações do Perfil:</h4>
                <label>
                    <input type="checkbox" id="include-display-name"> Nome de Exibição (<span id="whatsapp-display-name-preview"></span>)
                </label>
                <label>
                    <input type="checkbox" id="include-email"> Email (<span id="whatsapp-email-preview"></span>)
                </label>
                <label>
                    <input type="checkbox" id="include-phone"> Celular para Atendimento (<span id="whatsapp-phone-preview"></span>)
                </label>
            </div>
            <div class="action-button-group">
                <button id="send-whatsapp-button" class="action-button whatsapp-button">Enviar via WhatsApp</button>
                <button id="cancel-whatsapp-button" class="action-button cancel-button">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="budget-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="budget-close-button">×</span>
            <h3>Solicitar Orçamento ao Fornecedor</h3>
            <div id="budget-modal-body-content" class="modal-body-content">
                <div class="input-group">
                    <label>Categoria do Drone</label>
                    <div class="checkbox-group" id="drone-category-checkboxes">
                        <label><input type="checkbox" name="drone-category" value="Consumer"> Consumer</label>
                        <label><input type="checkbox" name="drone-category" value="Enterprise"> Enterprise</label>
                        <label><input type="checkbox" name="drone-category" value="Agriculture"> Agriculture</label>
                    </div>
                </div>

                <div class="input-group hidden" id="item-type-group">
                    <label>Tipo de Item</label>
                    <div class="checkbox-group" id="item-type-checkboxes">
                        <label><input type="checkbox" name="item-type" value="Equipamentos"> Equipamentos</label>
                        <label><input type="checkbox" name="item-type" value="Pecas"> Peças</label>
                    </div>
                </div>

                <div class="input-group hidden" id="equipment-details-group">
                    <label for="equipment-details">Modelos, quantidades e baterias (Ex: DJI Mini 4 Pro x2, Baterias x4)</label>
                    <textarea id="equipment-details" rows="5" placeholder="Descreva os modelos, quantidades e baterias..."></textarea>
                </div>

                <div class="input-group hidden" id="spare-parts-details-group">
                    <label for="spare-parts-details">Peças necessárias (Ex: Hélices DJI Mini 3 x4, Motor x1)</label>
                    <textarea id="spare-parts-details" rows="5" placeholder="Descreva as peças e quantidades..."></textarea>
                </div>

                <div class="input-group hidden" id="supplier-select-group">
                    <label>Selecione o(s) Fornecedor(es)</label>
                    <div class="checkbox-group" id="budget-supplier-checkboxes">
                        </div>
                </div>

                <div id="selected-supplier-contact" class="supplier-contact-info hidden">
                    <span id="selected-supplier-name-display"></span>
                    <a href="#" class="action-button whatsapp-button" id="send-budget-whatsapp">
                        <img src="https://i.imgur.com/XF9rY8D.png" alt="WhatsApp" style="height: 20px; width: 20px; margin-right: 5px; vertical-align: middle;">
                        Solicitar Orçamento
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="manage-supplier-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="manage-supplier-close-button">×</span>
            <h3 id="manage-supplier-modal-title"></h3>
            <form id="manage-supplier-form">
                <input type="hidden" id="supplier-id-to-edit">
                <div class="input-group">
                    <label for="supplier-name">Nome do Fornecedor</label>
                    <input type="text" id="supplier-name" required>
                </div>
                <div class="input-group">
                    <label for="supplier-details">Detalhes</label>
                    <textarea id="supplier-details" rows="3"></textarea>
                </div>
                <div class="input-group">
                    <label for="supplier-payment">Condições de Pagamento</label>
                    <textarea id="supplier-payment" rows="2"></textarea>
                </div>
                <div class="input-group">
                    <label for="supplier-products">Produtos Principais</label>
                    <input type="text" id="supplier-products">
                </div>
                <div class="input-group">
                    <label>Categorias</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="supplier-category" value="Consumer"> Consumer</label>
                        <label><input type="checkbox" name="supplier-category" value="Enterprise"> Enterprise</label>
                        <label><input type="checkbox" name="supplier-category" value="Agriculture"> Agriculture</label>
                        <label><input type="checkbox" name="supplier-category" value="Equipamentos"> Equipamentos</label>
                        <label><input type="checkbox" name="supplier-category" value="Pecas"> Peças</label>
                    </div>
                </div>

                <h4>Contatos:</h4>
                <div id="supplier-contacts-container">
                    </div>
                <button type="button" class="add-contact-button" id="add-supplier-contact-button">Adicionar Contato</button>

                <button type="submit" class="action-button" id="save-supplier-button" style="margin-top: 20px;">Salvar Fornecedor</button>
                <p id="manage-supplier-feedback" style="margin-top: 15px; font-weight: bold;"></p>
            </form>
        </div>
    </div>

    <div id="edit-supplier-search-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="edit-supplier-search-close-button">×</span>
            <h3>Buscar Fornecedor para Alterar</h3>
            <div class="input-group">
                <label for="edit-supplier-search-input-modal">Nome do Fornecedor</label>
                <input type="text" id="edit-supplier-search-input-modal" placeholder="Digite o nome do fornecedor">
            </div>
            <button id="search-supplier-to-edit-modal-button" class="action-button">Buscar</button>
            <div id="edit-supplier-search-results-modal"></div>
        </div>
    </div>

    <div id="filter-sort-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="filter-sort-close-button">×</span>
            <h3 id="filter-sort-modal-title">Filtros e Ordenação</h3>
            <div class="modal-body-content">
                <input type="text" id="filter-sort-search-input" class="search-filter-input" placeholder="Pesquisar por palavra-chave...">

                <h4 id="sort-options-title">Ordenar por:</h4>
                <div class="sort-options" id="filter-sort-order-buttons">
                    </div>

                <h4 id="category-options-title">Filtrar por Categoria:</h4>
                <div class="filter-options" id="filter-sort-category-buttons">
                    </div>

                <button id="apply-filter-sort-button" class="action-button" style="width: auto; margin-top: 20px;">Aplicar Filtros</button>
            </div>
        </div>
    </div>
</body>
</html>
/* Estilos para o modo visitante */
        body.visitor-mode #products-nav-button,
        body.visitor-mode #calculator-nav-button,
        body.visitor-mode #drones-nav-button,
        body.visitor-mode #info-empresa-nav-button,
        body.visitor-mode #marketing-nav-button,
        body.visitor-mode #profile-nav-button {
            display: block; /* Mostra apenas os botões permitidos no modo visitante */
        }

        body.visitor-mode #suppliers-nav-button,
        body.visitor-mode #settings-nav-button,
        body.visitor-mode #manage-users-nav-button,
        body.visitor-mode #create-product-nav-button,
        body.visitor-mode #edit-product-nav-button {
            display: none !important; /* Esconde botões de administração */
        }

        body.visitor-mode #open-budget-modal-button,
        body.visitor-mode #open-create-supplier-modal-button,
        body.visitor-mode #open-edit-supplier-search-modal-button {
            display: none !important; /* Esconde botões de fornecedores */
        }

        body.visitor-mode #ai-chat-button {
            display: block; /* Garante que o botão da IA apareça no modo visitante */
        }

        /* Estilos para o conteúdo de marketing */
        .marketing-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .marketing-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }

        .marketing-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .marketing-item h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: none; /* Remove a borda padrão */
        }

        .marketing-item img {
            max-width: 100%;
            height: auto;
            border: 1px solid #eee;
            border-radius: 5px;
            margin-bottom: 15px;
            object-fit: contain; /* Garante que a imagem se ajuste sem cortar */
            max-height: 150px; /* Limita a altura das imagens */
        }

        .marketing-item p {
            font-size: 0.9em;
            color: #666;
            flex-grow: 1; /* Permite que o parágrafo ocupe espaço extra */
            margin-bottom: 15px;
        }

        .marketing-item .download-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
            display: inline-block; /* Permite padding e margem */
            width: auto; /* Ajusta a largura ao conteúdo */
            margin-top: auto; /* Empurra o botão para baixo */
        }

        .marketing-item .download-button:hover {
            background-color: #d86c0f;
        }

        /* Estilos para o modo mobile específico do marketing */
        @media (max-width: 768px) {
            .marketing-content {
                grid-template-columns: 1fr; /* Uma coluna em telas pequenas */
                gap: 20px;
            }
        }
document.addEventListener('DOMContentLoaded', () => {
    const loginScreen = document.getElementById('login-screen');
    const appScreen = document.getElementById('app-screen');
    const loginButton = document.getElementById('login-button'); // Corrigido para o ID do botão
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginError = document.getElementById('login-error');
    const visitorModeButton = document.getElementById('visitor-mode-button');
    const welcomeMessage = document.getElementById('welcome-message');
    const profileIcon = document.getElementById('profile-icon');
    const logoutButton = document.getElementById('logout-button');
    const navButtons = document.querySelectorAll('nav button');
    const contentSections = document.querySelectorAll('.content-section');
    const scrollToTopButton = document.getElementById('scroll-to-top');
    const aiChatButton = document.getElementById('ai-chat-button');
    const aiChatModal = document.getElementById('ai-chat-modal');
    const aiQuestionInput = document.getElementById('ai-question-input');
    const submitAiQuestionButton = document.getElementById('submit-ai-question');
    const aiResponseArea = document.getElementById('ai-response-area');
    const aiLoader = document.querySelector('#ai-chat-modal .loader');
    const openChangePasswordModalButton = document.getElementById('open-change-password-modal'); // Corrigido ID
    const changePasswordModal = document.getElementById('change-password-modal');
    const newPasswordInput = document.getElementById('new-password');
    const confirmNewPasswordInput = document.getElementById('confirm-new-password');
    const submitChangePasswordButton = document.getElementById('submit-change-password');
    const changePasswordError = document.getElementById('change-password-error');
    const changePasswordSuccess = document.getElementById('change-password-success');
    const changePasswordCloseButton = document.querySelector('#change-password-modal .close-button');
    const profileSection = document.getElementById('profile-section');
    const profileEditForm = document.getElementById('profile-edit-form');
    const profilePicUploadInput = document.getElementById('edit-profile-pic');
    const uploadProfilePicButton = document.getElementById('upload-profile-pic-button');
    const profilePicDisplay = document.getElementById('profile-pic-display'); // Corrigido ID para img de exibição
    const profileDisplayName = document.getElementById('profile-display-name');
    const profileEmail = document.getElementById('profile-email');
    const profilePhone = document.getElementById('profile-phone');
    const editDisplayNameInput = document.getElementById('edit-display-name');
    const editEmailInput = document.getElementById('edit-email');
    const editPhoneInput = document.getElementById('edit-phone');
    const whatsappModal = document.getElementById('whatsapp-modal');
    const whatsappMessageInput = document.getElementById('whatsapp-message-input');
    const includeDisplayNameCheckbox = document.getElementById('include-display-name');
    const includeEmailCheckbox = document.getElementById('include-email');
    const includePhoneCheckbox = document.getElementById('include-phone');
    const whatsappDisplayNamePreview = document.getElementById('whatsapp-display-name-preview');
    const whatsappEmailPreview = document.getElementById('whatsapp-email-preview');
    const whatsappPhonePreview = document.getElementById('whatsapp-phone-preview');
    const sendWhatsappButton = document.getElementById('send-whatsapp-button');
    const cancelWhatsappButton = document.getElementById('cancel-whatsapp-button');
    const whatsappCloseButton = document.querySelector('#whatsapp-modal .close-button');
    const budgetModal = document.getElementById('budget-modal');
    const budgetCloseButton = document.querySelector('#budget-modal .close-button');
    const droneCategoryCheckboxes = document.querySelectorAll('#drone-category-checkboxes input[type="checkbox"]');
    const itemTypeGroup = document.getElementById('item-type-group');
    const itemTypeCheckboxes = document.querySelectorAll('#item-type-checkboxes input[type="checkbox"]');
    const equipmentDetailsGroup = document.getElementById('equipment-details-group');
    const equipmentDetailsTextarea = document.getElementById('equipment-details');
    const sparePartsDetailsGroup = document.getElementById('spare-parts-details-group');
    const sparePartsDetailsTextarea = document.getElementById('spare-parts-details');
    const budgetSupplierSelectGroup = document.getElementById('supplier-select-group');
    const budgetSupplierCheckboxesContainer = document.getElementById('budget-supplier-checkboxes');
    const selectedSupplierContactDiv = document.getElementById('selected-supplier-contact');
    const selectedSupplierNameDisplay = document.getElementById('selected-supplier-name-display');
    const sendBudgetWhatsappButton = document.getElementById('send-budget-whatsapp');
    const openBudgetModalButton = document.getElementById('open-budget-modal-button');
    const openCreateSupplierModalButton = document.getElementById('open-create-supplier-modal-button');
    const manageSupplierModal = document.getElementById('manage-supplier-modal');
    const manageSupplierCloseButton = document.querySelector('#manage-supplier-modal .close-button');
    const manageSupplierForm = document.getElementById('manage-supplier-form');
    const addSupplierContactButton = document.getElementById('add-supplier-contact-button');
    const supplierContactsContainer = document.getElementById('supplier-contacts-container');
    const openEditSupplierSearchModalButton = document.getElementById('open-edit-supplier-search-modal-button');
    const editSupplierSearchModal = document.getElementById('edit-supplier-search-modal');
    const editSupplierSearchInputModal = document.getElementById('edit-supplier-search-input-modal');
    const searchSupplierToEditModalButton = document.getElementById('search-supplier-to-edit-modal-button');
    const editSupplierSearchResultsModal = document.getElementById('edit-supplier-search-results-modal');
    const supplierIdToEditInput = document.getElementById('supplier-id-to-edit');
    const supplierNameInput = document.getElementById('supplier-name');
    const supplierDetailsTextarea = document.getElementById('supplier-details');
    const supplierPaymentTextarea = document.getElementById('supplier-payment');
    const supplierProductsInput = document.getElementById('supplier-products');
    const supplierCategoryCheckboxes = document.querySelectorAll('#manage-supplier-modal input[name="supplier-category"]');
    const manageSupplierFeedback = document.getElementById('manage-supplier-feedback');
    const saveSupplierButton = document.getElementById('save-supplier-button'); // Adicionado
    const productsNavButton = document.getElementById('products-nav-button');
    const calculatorNavButton = document.getElementById('calculator-nav-button');
    const suppliersNavButton = document.getElementById('suppliers-nav-button');
    const settingsNavButton = document.getElementById('settings-nav-button');
    const dronesNavButton = document.getElementById('drones-nav-button');
    const infoEmpresaNavButton = document.getElementById('info-empresa-nav-button');
    const marketingNavButton = document.getElementById('marketing-nav-button');
    const profileNavButton = document.getElementById('profile-nav-button');
    const manageUsersNavButton = document.getElementById('manage-users-nav-button');
    const createProductNavButton = document.getElementById('create-product-nav-button');
    const editProductNavButton = document.getElementById('edit-product-nav-button');
    const settingsSubNav = document.getElementById('settings-sub-nav');
    const productList = document.getElementById('product-list');
    const supplierList = document.getElementById('supplier-list');
    const productSearchInput = document.getElementById('product-search');
    const droneVisitorList = document.getElementById('drone-visitor-list');
    const droneVisitorSearchInput = document.getElementById('drone-visitor-search');
    const mainModal = document.getElementById('main-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const createTempUserForm = document.getElementById('create-temp-user-form');
    const tempUserFeedback = document.getElementById('temp-user-feedback');
    const tempUserListContainer = document.getElementById('temp-user-list-container'); // Corrigido ID
    const newProductNameInput = document.getElementById('new-product-name');
    const newProductSpecInput = document.getElementById('new-product-spec');
    const newProductSalePriceInput = document.getElementById('new-product-sale-price');
    const newProductCostPriceInput = document.getElementById('new-product-cost-price');
    const newProductSupplierSelect = document.getElementById('new-product-supplier');
    const editProductSearchInput = document.getElementById('edit-product-search-input');
    const searchProductToEditButton = document.getElementById('search-product-to-edit');
    const editProductSearchResults = document.getElementById('edit-product-search-results');
    const editProductDisplay = document.getElementById('edit-product-display');
    const editProductForm = document.getElementById('edit-product-form');
    const editProductSupplierInput = document.getElementById('edit-product-supplier');
    const generalCalcValorBase = document.getElementById('general-valor-base');
    const generalCalcPaymentRadios = document.querySelectorAll('input[name="general-payment-method"]');
    const generalCalcInstallmentsContainer = document.getElementById('general-installments-container');
    const generalCalcParcelasSelect = document.getElementById('general-parcelas');
    const generalCalculateButton = document.getElementById('general-calculate-button');
    const generalCalculatorResult = document.getElementById('general-calculator-result');
    const generalDiscountOption = document.getElementById('general-discount-option');
    const generalDiscountPercentageInput = document.getElementById('general-discount-percentage');
    const tempUsernameInput = document.getElementById('temp-username');
    const tempPasswordInput = document.getElementById('temp-password');
    const tempDurationSelect = document.getElementById('temp-duration');
    const openProductFilterSortModalButton = document.getElementById('open-product-filter-sort-modal');
    const openSupplierFilterSortModalButton = document.getElementById('open-supplier-filter-sort-modal');
    const filterSortModal = document.getElementById('filter-sort-modal');
    const filterSortCloseButton = document.getElementById('filter-sort-close-button');
    const filterSortModalTitle = document.getElementById('filter-sort-modal-title');
    const filterSortSearchInput = document.getElementById('filter-sort-search-input');
    const filterSortOrderButtons = document.getElementById('filter-sort-order-buttons');
    const filterSortCategoryButtons = document.getElementById('filter-sort-category-buttons');
    const applyFilterSortButton = document.getElementById('apply-filter-sort-button');
    const sortOptionsTitle = document.getElementById('sort-options-title');
    const categoryOptionsTitle = document.getElementById('category-options-title');


    // Dados e Variáveis de Estado (mantidos do seu código original)
    const currentYear = new Date().getFullYear();
    let USERS = {
        'mikhaell': { password: 'mk0639', role: 'admin', type: 'permanent', firstLogin: false, displayName: 'Mikhaell Galvão', email: 'contato@galvaodrones.com.br', phone: '6236360668', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'Maikhon':  { password: `mai${currentYear}`, role: 'admin', type: 'permanent', firstLogin: false, displayName: 'Maikhon', email: 'maikhon@galvaodrones.com.br', phone: '62987654321', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'Ryan':     { password: `rya${currentYear}`, role: 'admin', type: 'permanent', firstLogin: false, displayName: 'Ryan', email: 'ryan@galvaodrones.com.br', phone: '62912345678', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'Fineias':  { password: `fin${currentYear}`, role: 'seller', type: 'permanent', firstLogin: false, displayName: 'Fineias', email: 'fineias@galvaodrones.com.br', phone: '62998765432', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'Rafael':   { password: `raf${currentYear}`, role: 'seller', type: 'permanent', firstLogin: false, displayName: 'Rafael', email: 'rafael@galvaodrones.com.br', phone: '62991234567', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'Eduardo':  { password: `edu${currentYear}`, role: 'seller', type: 'permanent', firstLogin: true, displayName: 'Eduardo', email: 'eduardo@galvaodrones.com.br', phone: '62988881111', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'Afranio':  { password: `afr${currentYear}`, role: 'marketing', type: 'permanent', firstLogin: false, displayName: 'Afranio Marketing', email: 'afranio@galvaodrones.com.br', phone: '62988885555', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },

        'mikhaellven': { password: `mik${currentYear}`, role: 'seller', type: 'permanent', firstLogin: true, displayName: 'Mikhaell Vendedor', email: 'mikhaell.ven@galvaodrones.com.br', phone: '62988882222', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'maikhonven':  { password: `mai${currentYear}`, role: 'seller', type: 'permanent', firstLogin: true, displayName: 'Maikhon Vendedor', email: 'maikhon.ven@galvaodrones.com.br', phone: '62988883333', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'ryanven':     { password: `rya${currentYear}`, role: 'seller', type: 'permanent', firstLogin: true, displayName: 'Ryan Vendedor', email: 'ryan.ven@galvaodrones.com.br', phone: '62988884444', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
    };
    const CONFIDENTIAL_CODE = '@0639';

    let PRODUCTS = [
        { id: 1, name: 'DJI Neo Standard', spec: '🛸 DJI Neo Standard ou Combo fly more\n🎥 Grava em 4K/30fps\n⏱️ Até 18 minutos de voo\n📡 Alcance de até 6 km\n⚖️ Peso de apenas 135 g\n🎮 Controle via app, com controle ou controle motion ( três versões)', salePrice: 1900,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 1340 }] },
        { id: 2, name: 'DJI Neo Combo', spec: '🛸 DJI Neo Standard ou Combo fly more\n🎥 Grava em 4K/30fps\n⏱️ Até 18 minutos de voo\n📡 Alcance de até 6 km\n⚖️ Peso de apenas 135 g\n🎮 Controle via app, com controle ou controle motion ( três versões)', salePrice: 3500,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2460 }] },
        { id: 3, name: 'DJI Mini 3 (sem tela)', spec: '🛸 DJI Mini 3\n🎥 Grava em 4K HDR a 30fps\n⏱️ Até 38 minutos de voo\n📡 Distância de até 18 km\n⚖️ Peso leve: 249 g\n🎮 Controle com ou sem tela (duas versões)', salePrice: 3990,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2990 }] },
        { id: 4, name: 'DJI Mini 3 (com tela)', spec: '🛸 DJI Mini 3\n🎥 Grava em 4K HDR a 30fps\n⏱️ Até 38 minutos de voo\n📡 Distância de até 18 km\n⚖️ Peso leve: 249 g\n🎮 Controle com ou sem tela (duas versões)', salePrice: 4785,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 3785 }] },
        { id: 5, name: 'DJI Flip Fly More Combo (com tela)', spec: '🛸 DJI Flip\n🎥 4K a 60fps (com slow motion de até 100fps!)\n⏱️ Até 31 minutos no ar\n📡 Alcance médio de 13 km\n⚖️ Menos de 249 g\n🎮 Disponível com ou sem controle com tela', salePrice: 7990,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 5320 }] },
        { id: 64, name: 'DJI Mini 4 Pro Fly More Combo Plus (com tela)', spec: '🛸 DJI Mini 4 Pro\n🎥 Incrível 4K HDR a 100fps + fotos de 48 MP\n⏱️ Até 45 minutos no air\n📡 Alcance de até 25 km\n⚖️ Abaixo de 249 g\n🎮 Controle com tela (DJI RC 2)', salePrice: 9000.00,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 6990.00 }] },
        { id: 67, name: 'DJI Avata 2 Fly More Combo (1 bateria)', spec: '🛸 DJI Avata 2\n🎥 Gravação 4K 60fps com lente ultrawide\n⏱️ Até 23 minutos de voo imersivo\n📡 Alcance de até 13 km\n⚖️ Peso de 377 g\n🎮 Controle por movimento + óculos FPV (sem tela)', salePrice: 10590.00,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 7069.91 }] },
        { id: 68, name: 'DJI Avata 2 Fly More Combo (3 baterias)', spec: '🛸 DJI Avata 2\n🎥 Gravação 4K 60fps com lente ultrawide\n⏱️ Até 23 minutos de voo imersivo\n📡 Alcance de até 13 km\n⚖️ Peso de 377 g\n🎮 Controle por movimento + óculos FPV (sem tela)', salePrice: 12990.00,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 8674.53 }] },
        { id: 65, name: 'DJI Air 3S Standard (sem tela)', spec: '🛸 DJI Air 3S (Versão Standard)\n🎥 4K 60fps com sensores duplos (wide + tele)\n⏱️ Até 45 minutos no ar\n📡 Alcance de 32 km\n⚖️ Peso de 724 g\n🎮 Controle sem tela (standard)', salePrice: 12790.00,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 8532.92 }] },
        { id: 72, name: 'DJI Mavic 4 Pro Combo (com tela)', spec: '🚀 DJI Mavic 4 Pro\n🎥 5.1K a 120fps com sensor 4/3 CMOS\n⏱️ Até 46 minutos de voo\n📡 Alcance de até 32 km\n⚖️ 958 g\n🎮 Controle com tela (DJI RC Pro)', salePrice: 26670.00,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 19920.00 }] },
        { id: 71, name: 'DJI Mavic 4 Pro Creator Combo (HDMI, 512GB)', spec: '🚀 DJI Mavic 4 Pro Creator Combo\nMesmo conjunto do Mavic 4 Pro com:\n🎒 Acessórios profissionais\n🔋 Baterias extras e hub inteligente\n🧳 Maleta reforçada para transporte\n🎮 Controle com tela (DJI RC Pro 2)', salePrice: 35650.00,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 26650.00 }] },
        { id: 39, name: 'DJI Mavic 3 Multispectral', spec: '🌱 DJI Mavic 3 Multispectral (Versão Standard)\n🎥 Câmera RGB 20 MP + 4 sensores multispectrais\n⏱️ Até 43 minutos por voo\n📡 Alcance de 15 km\n⚖️ 951 g\n🎮 Controle com tela (DJI RC Pro Enterprise)\n🧪 Ideal para agricultura de precisão e NDVI', salePrice: 44302.70,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 31011.89 }] },
        { id: 40, name: 'DJI Mavic 3 Thermal', spec: '🔥 DJI Mavic 3 Thermal (Versão Standard)\n🎥 4K + câmera térmica 640x512 px\n⏱️ Até 45 minutos por voo\n📡 Alcance de 15 km\n⚖️ 920 g\n🎮 Controle com tela (DJI RC Pro Enterprise)\n🔥 Ideal para inspeção, resgate e segurança', salePrice: 42533.55,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 29773.48 }] },
        { id: 41, name: 'DJI Mavic 3 Enterprise', spec: '🗺️ DJI Mavic 3 Enterprise (Versão Standard)\n🎥 Câmera RGB 20 MP com obturador mecânico\n🗺️ Compatível com RTK, alto-falante e holofote\n⏱️ Até 45 minutos de voo\n📡 Alcance de 15 km\n⚖️ 915 g\n🎮 Controle com tela (DJI RC Pro Enterprise)\n📐 Indicado para mapeamentos e medições técnicas', salePrice: 31474.83,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 22032.38 }] },
        { id: 42, name: 'DJI Matrice 4T', spec: '🛠️ DJI Matrice 4T (Versão Standard)\n🎥 RGB 48 MP + Zoom híbrido 56x + Câmera térmica de alta resolução\n🧭 Visão tripla: Wide, Zoom e Térmica\n⏱️ Até 55 minutos por voo\n📡 Alcance de até 20 km\n⚖️ Peso: 3,7 kg\n🎮 Controle DJI RC Plus com tela de 7” ultra brilhante\n💼 IP55 – Ideal para resgate, combate a incêndio e inspeções', salePrice: 61589.97,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 43112.98 }] },
        { id: 43, name: 'DJI Matrice 4E', spec: '🛠️ DJI Matrice 4E (Versão Standard)\n🎥 Câmera ampla de 20 MP com obturador mecânico\n🧭 Suporte a RTK, payloads e expansões avançadas\n⏱️ Até 55 minutos de voo\n📡 Alcance de até 20 km\n⚖️ Peso: 3,4 kg\n🎮 Controle DJI RC Plus\n🔧 Ideal para mapeamento, segurança e vigilância industrial', salePrice: 46075.84,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 32253.09 }] },
        { id: 113, name: 'DJI Matrice 30T', spec: '🛠️ DJI Matrice 30T (Versão Standard)\n🎥 Câmera Wide 48 MP + Zoom Híbrido + Câmera Térmica\n⏱️ Até 41 minutos por voo\n📡 Alcance de até 15 km\n⚖️ Peso: 3,77 kg\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Proteção IP55 – Ideal para operações em campo aberto', salePrice: 67494.47,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 48663.51 }] },
        { id: 114, name: 'DJI Matrice 350 RTK', spec: '🛠️ DJI Matrice 350 RTK (Versão Standard)\n🎥 Compatível com payloads L2, P1, H30T e sensores externos\n🧭 RTK integrado para mapeamento de alta precisão\n⏱️ Até 55 minutos de voo\n📡 Alcance de até 20 km\n⚖️ Peso médio de 3,8 kg sem carga\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Estrutura reforçada com proteção IP55', salePrice: 51991.62,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 37485.95 }] },
        { id: 44, name: 'GOHOBBY SENTINEL', spec: '🛡️ GOHOBBY Sentinel\nUm sistema passivo de detecção, sem interferências, ideal para monitoramento discreto:\n📡 Frequências: 2.4 GHz, 5.1 GHz, 5.8 GHz\n🛩️ Protocolos suportados: DJI (O1–O4), Autel, eWiFi, PAL, NTSC, LightBridge, Datalink\n📍 Alcance de detecção: até 5 km\n🔁 Detecção simultânea: até 10 drones\n⏱️ Tempo de localização: ≤ 3 s\n🕒 Autonomia da bateria: até 12 h\n🎯 Precisão de localização: ≤ 3 m\n💻 Tela: 6.3” touchscreen\n🌐 Conectividade: Wi‑Fi e LTE\n⚖️ Peso: 0,65 kg + bateria externa (~0,6 kg)\n⚙️ IP: IP54', salePrice: 155128.57,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 108590.00 }] },
        { id: 45, name: 'SKYFEND HUNTER', spec: '🌩️ Skyfend Hunter (AFA100)\nUm jammer portátil com detecção e contra-ação integrada, típico “gun”:\n📡 Detecção omnidirecional: até 2 km\n🚫 Jamming direcional: até 3 km\n📶 Cobertura de frequência: 400 MHz–6 GHz (RF + GNSS: GPS, Glonass, Beidou, Galileo)\n⏱️ Autonomia: até 8 h em espera e 1 h com jamming ativo\n🕌 Tela: touchscreen 3,5”\n🔄 Adaptabilidade: adaptação automática de frequência\n⚙️ IP: IP65\n⚖️ Peso: aprox. 6,5 kg', salePrice: 379745.85,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 265822.10 }] },
        { id: 46, name: 'SKYFEND BLADER', spec: '⚡ Skyfend Blader\nUm jammer portátil de alta potência, enxuto e focado na neutralização:\n🌐 Alcance de jamming: até 1,5 km\n📶 Cobertura de frequência: 868 MHz, 915 MHz, 1.2 GHz, 1.4 GHz, 1.6 GHz, 2.4 GHz, 4.95 GHz, 5.2–5.8 GHz\n⏱️ Jamming ativado: até 30 min\n🧭 Direção e campo de visão: azimute ±15°, pitch ±10°\n⚖️ Peso: ≈ 4 kg\n⚙️ IP: IP65', salePrice: 151898.28,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 106328.80 }] },
        { id: 31, name: 'Câmera DJI Osmo Pocket 3 Standard', spec: '📷 DJI Osmo Pocket 3 Standard\n🎥 Gravação em 4K com sensor grande\n📱 Tela articulada touchscreen\n🔁 Gimbal mecânico de 3 eixos\n💡 Ideal para criadores que filmam em movimento\n🔋 Autonomia de até 120 minutos\n📦 Compacta e leve: cabe no bolso', salePrice: 6990,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 4658.47 }] },
        { id: 92, name: 'Câmera DJI Osmo Action 4 Adventure Combo', spec: '📷 DJI Osmo Action 4 Adventure Combo\n🎥 Vídeos em 4K HDR a 120 fps\n🌊 À prova d’agua até 18 metros (sem case)\n🔋 Inclui 2 baterias extras + suporte de carregamento\n📱 Controle via app DJI Mimo\n📦 Pensada para esportes e ambientes extremos', salePrice: 4790.00,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 3194.13 }] },
        { id: 94, name: 'Câmera DJI Osmo Action 4 Standard Combo', spec: '📷 DJI Osmo Action 4 Standard Combo\n🎥 4K ultra amplo com estabilização RockSteady\n🎯 Lente grande angular com excelente captação de luz\n📱 Integração total com o app DJI\n🧳 Compacta, ideal para vloggers e aventureiros iniciantes', salePrice: 3490.00,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 2400.00 }] },
        { id: 93, name: 'Câmera DJI Osmo Action 5 Pro Standard Combo', spec: '📷 DJI Osmo Action 5 Pro Standard Combo\n🎥 4K a 120 fps com sensor aprimorado para pouca luz\n🌀 Estabilização RockSteady 3.0 + HorizonSteady\n🔋 Bateria de longa duração com carregamento rápido\n🎧 Áudio com 3 microfones e cancelamento de ruído\n📦 Perfeita para profissionais e criadores exigentes', salePrice: 4490.00,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 2992.69 }] },
        { id: 97, name: 'Estabilizador DJI Osmo Mobile 7P', spec: '🎮 DJI Osmo Mobile 7P BR\n📱 Compatível com celulares grandes\n🌀 Modos de acompanhamento e gestos\n🔋 Bateria para até 10h de uso', salePrice: 2090.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 1396.50 }] },
        { id: 96, name: 'Estabilizador DJI Osmo Mobile 7', spec: '🎮 DJI Osmo Mobile 7 BR\n📱 Novo sistema de equilíbrio automático\n🔋 Leve, com autonomia prolongada\n🧠 Integração nativa com app DJI', salePrice: 1249.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 835.23 }] },
        { id: 99, name: 'Estabilizador DJI Osmo Mobile 6', spec: '🎮 DJI Osmo Mobile 6 (Cinza Escuro ou Platinum)\n🔋 6h de uso, com ActiveTrack 5.0\n📱 Compacto e retrátil\n🧲 Design magnético para montagem rápida', salePrice: 1390.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 930.10 }] },
        { id: 95, name: 'Estabilizador DJI Osmo Mobile SE', spec: '🎮 DJI Osmo Mobile SE\n📱 Versão acessível e eficiente\n🎯 Boa estabilidade para vídeos casuais\n🧳 Ideal para iniciantes', salePrice: 990.00,
            sources: [{ supplierName: 'Arroroba Celulares', costPrice: 663.49 }] },
        { id: 33, name: 'Estabilizador DJI RS 3 Pro Combo', spec: '🎮 DJI RS 3 Pro Combo\n🎥 Suporte para câmeras profissionais até 4,5 kg\n🧠 LIDAR focagem + ActiveTrack Pro\n🔋 Até 12h de uso com bateria BG30', salePrice: 7990,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 5790.00 }] },
        { id: 35, name: 'Estabilizador DJI RS 4 Pro Combo', spec: '🎮 DJI RS 4 Pro Combo\n🎥 Suporte avançado para rigs pesados\n📡 Conectividade profissional\n🔋 Bateria BG70 de alta duração', salePrice: 12790,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 8900.00 }] },
        { id: 34, name: 'Estabilizador DJI RS 4 Mini', spec: '🎮 DJI RS 4 Mini\n🎥 Câmeras até 2 kg\n🔧 Ultra leve, com braço de rotação larga\n🔋 Até 10h com autonomia', salePrice: 3890,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2840.00 }] },
        { id: 32, name: 'Estabilizador DJI RS 3 Mini', spec: '🎮 DJI RS 3 Mini\n🎥 Ideal para câmeras mirrorless\n📦 Compacto e balanceado\n🔋 10h de bateria', salePrice: 2690,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2335.00 }] },
        { id: 18, name: 'Controle DJI Motion 3', spec: '🎮 DJI Motion 3\n🖐️ Controle por movimento\n🎮 Compatível com DJI Neo, Avata 2 e Air 3\n📡 Transmissão precisa + experiência imersiva', salePrice: 1099,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 734.09 }] },
        { id: 19, name: 'Controle DJI RC', spec: '🎮 DJI RC\n📱 Suporte para smartphone\n📡 Alcance até 10 km\n⚖️ Design leve e ergonômico', salePrice: 3290,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2195.65 }] },
        { id: 20, name: 'Controle DJI RC 2', spec: '🎮 DJI RC 2\n📺 Tela HD integrada\n📡 Alcance de até 20 km\n🔋 Autonomia de 4h', salePrice: 3590,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 2395.43 }] },
        { id: 21, name: 'Controle DJI RC Pro (HDMI)', spec: '🎮 DJI RC Pro (HDMI)\n🎥 Saída HDMI e sistema Android\n📡 Ultra responsivo com controle DJI Fly\n📺 Tela de alto brilho com 1000 nits', salePrice: 10990,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 7330.69 }] },
        { id: 100, name: 'Microfone DJI Mic 2 (2 TX + 1 RX + Case)', spec: '🎤 DJI Mic 2 (2 transmissores + 1 receptor + case)\n🎧 Áudio estéreo digital de altíssima fidelidade (24-bit)\n🔋 Gravação interna com backup automático\n📡 Alcance de até 250 metros em área aberto\n🧳 Case com recarga rápida e transporte seguro\n🔗 Compatível com câmeras DSLR, celulares e computadores', salePrice: 4090.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2731.69 }] },
        { id: 36, name: 'Microfone DJI Mic Mini (1 TX + 1 RX)', spec: '🎤 DJI Mic Mini (1 transmissor + 1 receptor)\n🎧 Super compacto e leve – ideal para creators\n🔋 Autonomia de até 6 horas por unidade\n📦 Sem case de recarga – prático para uso imediato\n🎯 Plug and play com portas USB-C e Lightning', salePrice: 859,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 523.29 }] },
        { id: 37, name: 'Microfone DJI Mic Mini (2 TX + 1 RX + Case)', spec: '🎤 DJI Mic Mini (2 transmissores + 1 receptor + case)\n🎧 Gravação estéreo dupla com sincronização inteligente\n🔋 Case de transporte com recarga automática\n📡 Conexão simultânea com dispositivos duplos\n📱 Perfeito para entrevistas, podcasts e vídeos de equipe.', salePrice: 1590,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 1062.43 }] },
        { id: 115, name: 'Bateria DJI Neo', spec: '🔋 Bateria DJI Neo\n⏱️ Autonomia de até 18 minutos por carga\n⚡ Tecnologia LiPo com proteção inteligente\n🔌 Recarga via hub ou carregador USB-C\n📦 Compatível exclusivamente com o DJI Neo', salePrice: 0,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 0 }] },
        { id: 12, name: 'Bateria DJI Avata', spec: '🔋 Bateria DJI Avata\n⏱️ Cerca de 18 minutos de voo FPV\n🎮 Ideal para uso com goggles e motion controller\n⚡ Proteção contra curto, descarga e superaquecimento\n📦 Peso médio: 162 g', salePrice: 1489,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 994.06 }] },
        { id: 13, name: 'Bateria DJI Avata 2', spec: '🔋 Bateria DJI Avata 2\n⏱️ Aproximadamente 23 minutos de voo imersivo\n📡 Otimizada para voos com DJI Goggles 3\n⚡ Equilíbrio entre leveza e performance\n📦 Recarregável via hub dedicado', salePrice: 1149,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 767.21 }] },
        { id: 104, name: 'Bateria Mini 3 Pro / 4 Pro', spec: '🔋 Bateria DJI Mini 3 / Mini 4 Pro (Standard)\n⏱️ Até 34 minutos de voo\n⚡ Compacta, com sensores de segurança\n🔋 Indicador de carga inteligente\n📦 Peso médio: 80 g', salePrice: 749.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 570.00 }] },
        { id: 105, name: 'Bateria Mini 3 Pro Plus', spec: '🔋 Bateria DJI Plus Mini 3 / Mini 4 Pro (Alta Capacidade)\n⏱️ Até 45 minutos por carga\n⚡ Ideal para voos longos e gravações contínuas\n🔋 Compatível com DJI Fly – modo “max performance”\n📦 Leve e resistente', salePrice: 1190.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 825.00 }] },
        { id: 15, name: 'Bateria DJI Air 3S / Air 3', spec: '🔋 Bateria DJI Air 3S / Air 3\n⏱️ Até 45 minutos por carga\n⚡ Células de alta densidade e vida útil prolongada\n📦 Compatível com modo de priorização de carga via hub\n🔋 Recarga otimizada via carregador 100W', salePrice: 1890,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 1261.94 }] },
        { id: 82, name: 'Bateria DJI Mini 2 / SE / 2 SE / 4K', spec: '🔋 Bateria DJI Mini 2 / SE / 2 SE / 4K\n⏱️ Entre 22 e 31 minutos de voo (varia conforme o modelo)\n⚡ Bateria compacta, estável e eficiente\n📦 Ideal para pilotos iniciantes ou voos recreativos\n🔋 Recarregável via hub Mini 2', salePrice: 649.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 433.38 }] },
        { id: 83, name: 'Bateria TB51 DJI Inspire 3', spec: '🔋 Bateria TB51 (Inspire 3)\n⏱️ Performance profissional com tempo estendido de voo\n📦 Sistema avançado de aquecimento automático\n⚡ Compatível com estação de carga DJI BS51\n🔋 Controle inteligente de ciclo e temperatura', salePrice: 3999.00,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 2669.76 }] },
        { id: 81, name: 'Bateria de alta capacidade DJI RS BG70', spec: '🔋 Bateria DJI RS BG70 (para RS 4 Pro)\n⏱️ Até 12 horas de autonomia contínua\n⚙️ Fixação direta no estabilizador RS 4 Pro\n📦 Indicador de status em tempo real\n🔋 Recarga via conector magnético de alta voltagem', salePrice: 1490.00,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 996.07 }] },
        { id: 79, name: 'Protetores de Hélices DJI Neo', spec: '🛡️ Protetores de Hélice DJI Neo\n⚙️ Leves, seguros e ideais para indoor', salePrice: 119.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 100.00 }] },
        { id: 78, name: 'Protetores de Hélices DJI Mini 3', spec: '🛡️ Protetores de Hélice DJI Mini 3\n⚙️ Encaixe rápido, protege hélices em espaços apertados', salePrice: 379.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 285.00 }] },
        { id: 77, name: 'Hélices DJI Neo – 2 Pares', spec: '🌀 Hélices DJI Neo – 2 Pares', salePrice: 79.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 53.06 }] },
        { id: 75, name: 'Hélices DJI Flip – 2 Pares', spec: '🌀 Hélices DJI Flip – 2 Pares', salePrice: 104.90,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 70.31 }] },
        { id: 73, name: 'Hélices DJI Mini 2/SE/2 SE/4K – 2 Pares', spec: '🌀 Hélices DJI Mini 2/SE/2 SE/4K – 2 Pares', salePrice: 119.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 433.38 }] },
        { id: 76, name: 'Hélices DJI Inspire 3 – Par', spec: '🌀 Hélices DJI Inspire 3 – Par', salePrice: 499.00,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 391.91 }] },
        { id: 74, name: 'Hélices DJI Avata 2 – 2 Pares', spec: '🌀 Hélices DJI Avata 2 – 2 Pares', salePrice: 109.00,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 70.31 }] },
        { id: 38, name: 'DJI Goggles 3', spec: '👓 DJI Goggles 3\n📺 Duas telas OLED 1080p de alta nitidez\n🧠 Sistema de head tracking imersivo com baixa latência\n🔋 Bateria interna com até 3 horas de autonomia\n📡 Transmissão O4 compatível com Avata 2, Mini 4 Pro,  Air 3 e Neo\n🧳 Ajuste ergonômico para conforto prolongado', salePrice: 6490,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 4327.89 }] },
        { id: 88, name: 'DJI Goggles N3', spec: '👓 DJI Goggles N3\n📺 Compatíveis com o DJI Neo e Motion Controller 3\n🔋 Bateria interna com até 2 horas de uso contínuo\n🌀 Imersão FPV com mínima latência\n📦 Design leve e dobrável, ideal para transporte', salePrice: 2990.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 1999.56 }] },
        { id: 25, name: 'Hub de Carregamento DJI Avata 2', spec: '🔁 Hub de Carregamento DJI Avata 2\n🔋 Sistema inteligente de carregamento e equalização\n⚡ Alta eficiência térmica\n🔌 Compatível com powerbanks USB-C PD\n📦 Ideal para voos FPV com múltiplas baterias', salePrice: 499,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 333.62 }] },
        { id: 26, name: 'Hub de Carregamento DJI Neo', spec: '🔁 Hub de Carregamento DJI Neo\n🔋 Carga sequencial de até 3 baterias\n⚡ Tempo médio por unidade: 75 minutos\n🔌 Compatível com carregadores 65W DJI\n📦 Leve, portátil e de encaixe rápido', salePrice: 419,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 280.00 }] },
        { id: 27, name: 'Hub de Carregamento DJI Mini 3 / 3 Pro / 4 Pro', spec: '🔁 Hub de Carregamento DJI Mini 3 / 3 Pro / 4 Pro\n🔋 Até 3 baterias com transferência de carga\n⚡ Balanceamento automático\n📦 Ideal para operação em campo', salePrice: 519,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 347.01 }] },
        { id: 28, name: 'Hub de Carregamento DJI Air 3 / Air 3S', spec: '🔁 Hub de Carregamento DJI Air 3 / Air 3S\n🔋 Gestão automática da ordem de carga\n⚡ Suporte a carregamento paralelo\n📱 Status visível via app DJI Fly\n📦 Compacto com LEDs indicadores', salePrice: 799,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 500.09 }] },
        { id: 29, name: 'Carregador USB-C DJI 100W', spec: '⚡ Carregador USB-C DJI 100W\n🔌 Carga dupla simultânea (hub + controle)\n⚡ Reconhecimento inteligente de voltagem\n⏱️ Carga total entre 60 e 90 min por bateria\n📱 Compatível com outros dispositivos USB-C', salePrice: 619,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 415.23 }] },
        { id: 30, name: 'Carregador USB-C DJI 65W', spec: '⚡ Carregador USB-C DJI 65W\n🔋 Leve e versátil\n⚡ Ideal para controles e baterias padrão DJI\n📦 Proteção contra sobrecarga e superaquecimento\n🧳 Perfeito para uso portátil', salePrice: 389,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 573.86 }] },
        { id: 16, name: 'Estação de Energia DJI Power 1000', spec: '🔌 DJI Power 1000\n⚡ Potência total: 1000W\n🔋 Bateria interna de longa duração (1024 Wh)\n🔌 Diversas saídas: USB-C, AC, DC e carregamento solar\n📦 Ideal para operações em campo, emergências e drones de grande porte\n🧳 Design robusto, com alça retrátil e tela inteligente', salePrice: 9590,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 6314.47 }] },
        { id: 17, name: 'Estação de Energia DJI Power 500', spec: '🔌 DJI Power 500\n⚡ Potência total: 500W\n🔋 Capacidade de 512 Wh\n🔌 Entradas e saídas para múltiplos dispositivos simultâneos\n📦 Portátil e eficiente para filmagens externas, inspeções ou backup em locais remotos\n🧳 Compacta e fácil de transportar', salePrice: 6190,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 4071.35 }] },
        { id: 80, name: 'Sistema DJI Focus Pro – All-In-One Combo', spec: '🎯 Sistema DJI Focus Pro – All-In-One Combo\n🎥 Foco automático inteligente para câmeras profissionais\n📡 Controle remoto de alta precisão com delay ultrabaixo\n🔋 Motor silencioso com bateria integrada de longa duração\n⚙️ Compatível com estabilizadores da linha RS e câmeras DSLR/cinema\n🧠 Modos: foco manual, automático e via reconhecimento facial\n📦 Inclui motor, controle, cabo de dados e acessórios profissionais\n🧳 Ideal para produções de alto nível, cinema, comerciais e conteúdo técnico', salePrice: 16990.00,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 11133.54 }] },
        { id: 86, name: 'Sistema DJI SDR Transmission Combo', spec: '📶 Sistema DJI SDR Transmission Combo\n📡 Transmissão de vídeo em tempo real com ultra baixa latência\n📺 Entrada HDMI para câmeras externas (profissionais ou drone FPV customizado)\n📱 Compatível com smartphones ou tablets via suportes dedicados\n🔌 Alimentação via bateria integrada ou ou fonte externa\n🎯 Ideal para transmissões ao vivo, monitoramento técnico ou gravações de precisão\n📦 Combo inclui receptor SDR, cabos, suporte de fixação e encaixes ajustáveis', salePrice: 5990.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 4004.27 }] },
        { id: 84, name: 'Suporte de Telefone SDR', spec: '📱 Suporte de Telefone SDR\n🧲 Suporte magnético com ajuste de ângulo e altura\n📦 Compatível com celulares de até 7”', salePrice: 579.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 257.45 }] },
        { id: 85, name: 'Suporte de Tablet SDR', spec: '💻 Suporte de Tablet SDR\n📐 Estrutura expandida para tablets de até 10”\n⚙️ Base firme com regulagem personalizada\n🧳 Ideal para visualização ampla em campo', salePrice: 579.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 500.09 }] },
        { id: 89, name: 'Hard Case Mavic Air 2 / Air 2S', spec: '🎒 Hard Case Mavic Air 2 / Air 2S\n💼 Proteção rígida + interior espumado', salePrice: 599.00,
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 339.72 }] },
        { id: 90, name: 'Kit Apoio DJI RC Plus', spec: '🎒 Kit Apoio DJI RC Plus\n🧳 Tira de ombro + apoio de cintura\n🎮 Ideal para longas operações', salePrice: 769.00,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 140.73 }] },
        { id: 91, name: 'Garrafa DJI 650mL – Preto Gradiente', spec: '🥤 Garrafa DJI 650mL – Preto Gradiente\n💧 Estilo DJI com hidratação', salePrice: 149.00,
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 79.88 }] },
        // Exemplo de produto com MÚLTIPLOS fornecedores
        { id: 1000, name: 'Bateria Universal P-Drone', spec: '🔋 Bateria de alta capacidade universal', salePrice: 1500.00,
            sources: [
                { supplierName: 'Arroba Celulares', costPrice: 1000.00 },
                { supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 950.00 }
            ]
        },
        { id: 1001, name: 'Kit Hélice Super Resistente (2 Pares)', spec: '🌀 Hélices de fibra de carbono para alta durabilidade.', salePrice: 250.00,
            sources: [
                { supplierName: 'DJI Grupo Multi', costPrice: 150.00 },
                { supplierName: 'Arroba Celulares', costPrice: 160.00 }
            ]
        },
        // --- NOVOS PRODUTOS E ATUALIZAÇÕES DA GOHOBBY ---
        // Novos kits de bateria para Mavic 3 (IDs exclusivas para evitar conflito com produtos base)
        { id: 1002, name: 'DJI MAVIC 3 THERMAL + KIT DE BATERIAS ENTERPRISE', spec: '🔥 DJI Mavic 3 Thermal com kit de baterias extra.\n🎥 4K + câmera térmica 640x512 px\n⏱️ Até 45 minutos por voo (com baterias extras)\n📡 Alcance de 15 km\n⚖️ 920 g\n🎮 Controle com tela (DJI RC Pro Enterprise)\n🔥 Ideal para inspeção, resgate e segurança', salePrice: 45700.00,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 31990.00 }] },
        { id: 1003, name: 'DJI MAVIC 3 ENTERPRISE + KIT DE BATERIAS ENTERPRISE', spec: '🗺️ DJI Mavic 3 Enterprise com kit de baterias extra.\n🎥 Câmera RGB 20 MP com obturador mecânico\n🗺️ Compatível com RTK, alto-falante e holofote\n⏱️ Até 45 minutos de voo (com baterias extras)\n📡 Alcance de 15 km\n⚖️ 915 g\n🎮 Controle com tela (DJI RC Pro Enterprise)\n📐 Indicado para mapeamentos e medições técnicas', salePrice: 34271.42,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 23990.00 }] },
        { id: 1004, name: 'DJI MAVIC 3 MULTISPECTRAL + KIT DE BATERIAS ENTERPRISE', spec: '🌱 DJI Mavic 3 Multispectral com kit de baterias extra.\n🎥 Câmera RGB 20 MP + 4 sensores multispectrais\n⏱️ Até 43 minutos por voo (com baterias extras)\n📡 Alcance de 15 km\n⚖️ 951 g\n🎮 Controle com tela (DJI RC Pro Enterprise)\n🧪 Ideal para agricultura de precisão e NDVI', salePrice: 47128.57,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 32990.00 }] },
        // Novos Matrice 4T e 4E com descrição atualizada de baterias
        { id: 1005, name: 'DJI MATRICE 4T - 2X BATERIA MATRICE 4 SERIES', spec: '🛠️ DJI Matrice 4T com 2 baterias da Série Matrice 4.\n🎥 RGB 48 MP + Zoom híbrido 56x + Câmera térmica de alta resolução\n🧭 Visão tripla: Wide, Zoom e Térmica\n⏱️ Até 55 minutos por voo\n📡 Alcance de até 20 km\n⚖️ Peso: 3,7 kg\n🎮 Controle DJI RC Plus com tela de 7” ultra brilhante\n💼 IP55 – Ideal para resgate, combate a incêndio e inspeções', salePrice: 64718.07,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 45302.65 }] },
        { id: 1006, name: 'DJI MATRICE 4E - 2X BATERIA MATRICE 4 SERIES', spec: '🛠️ DJI Matrice 4E com 2 baterias da Série Matrice 4.\n🎥 Câmera ampla de 20 MP com obturador mecânico\n🧭 Suporte a RTK, payloads e expansões avançadas\n⏱️ Até 55 minutos de voo\n📡 Alcance de até 20 km\n⚖️ Peso: 3,4 kg\n🎮 Controle DJI RC Plus\n🔧 Ideal para mapeamento, segurança e vigilância industrial', salePrice: 46075.84,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 32253.09 }] },
        // Novas variações de Matrice 30T com diferentes quantidades de bateria
        { id: 1007, name: 'DJI MATRICE 30T + 2x TB30 BATERIA INTELIGENTE', spec: '🛠️ DJI Matrice 30T com 2 baterias inteligentes TB30.\n🎥 Câmera Wide 48 MP + Zoom Híbrido + Câmera Térmica\n⏱️ Até 41 minutos por voo\n📡 Alcance de até 15 km\n⚖️ Peso: 3,77 kg\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Proteção IP55 – Ideal para operações em campo aberto', salePrice: 67125.62,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 46987.94 }] },
        { id: 1008, name: 'DJI MATRICE 30T + 4x TB30 BATERIA INTELIGENTE', spec: '🛠️ DJI Matrice 30T com 4 baterias inteligentes TB30.\n🎥 Câmera Wide 48 MP + Zoom Híbrido + Câmera Térmica\n⏱️ Até 41 minutos por voo\n📡 Alcance de até 15 km\n⚖️ Peso: 3,77 kg\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Proteção IP55 – Ideal para operações em campo aberto', salePrice: 74181.48,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 51927.04 }] },
        { id: 1009, name: 'DJI MATRICE 30T + 6x TB30 BATERIA INTELIGENTE', spec: '🛠️ DJI Matrice 30T com 6 baterias inteligentes TB30.\n🎥 Câmera Wide 48 MP + Zoom Híbrido + Câmera Térmica\n⏱️ Até 41 minutos por voo\n📡 Alcance de até 15 km\n⚖️ Peso: 3,77 kg\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Proteção IP55 – Ideal para operações em campo aberto', salePrice: 81237.35,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 56866.15 }] },
        { id: 1010, name: 'DJI MATRICE 30T + 8x TB30 BATERIA INTELIGENTE', spec: '🛠️ DJI Matrice 30T com 8 baterias inteligentes TB30.\n🎥 Câmera Wide 48 MP + Zoom Híbrido + Câmera Térmica\n⏱️ Até 41 minutos por voo\n📡 Alcance de até 15 km\n⚖️ Peso: 3,77 kg\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Proteção IP55 – Ideal para operações em campo aberto', salePrice: 88293.21,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 61805.25 }] },
        // Novas variações de Matrice 350 RTK com diferentes quantidades de bateria
        { id: 1011, name: 'DJI MATRICE 350 RTK + BS65 + 2X TB65 BATERIA', spec: '🛠️ DJI Matrice 350 RTK, Estação BS65 e 2 baterias TB65.\n🎥 Compatível com payloads L2, P1, H30T e sensores externos\n🧭 RTK integrado para mapeamento de alta precisão\n⏱️ Até 55 minutos de voo\n📡 Alcance de até 20 km\n⚖️ Peso médio de 3,8 kg sem carga\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Estrutura reforçada com proteção IP55', salePrice: 90840.01,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 63336.01 }] },
        { id: 1012, name: 'DJI MATRICE 350 RTK + BS65 + 4X TB65 BATERIA', spec: '🛠️ DJI Matrice 350 RTK, Estação BS65 e 4 baterias TB65.\n🎥 Compatível com payloads L2, P1, H30T e sensores externos\n🧭 RTK integrado para mapeamento de alta precisão\n⏱️ Até 55 minutos de voo\n📡 Alcance de até 20 km\n⚖️ Peso médio de 3,8 kg sem carga\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Estrutura reforçada com proteção IP55', salePrice: 101829.15,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 71280.41 }] },
        { id: 1013, name: 'DJI MATRICE 350 RTK + BS65 + 6X TB65 BATERIA', spec: '🛠️ DJI Matrice 350 RTK, Estação BS65 e 6 baterias TB65.\n🎥 Compatível com payloads L2, P1, H30T e sensores externos\n🧭 RTK integrado para mapeamento de alta precisão\n⏱️ Até 55 minutos de voo\n📡 Alcance de até 20 km\n⚖️ Peso médio de 3,8 kg sem carga\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Estrutura reforçada com proteção IP55', salePrice: 119068.24,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 83347.77 }] },
        { id: 1014, name: 'DJI MATRICE 350 RTK + BS65 + 8X TB65 BATERIA', spec: '🛠️ DJI Matrice 350 RTK, Estação BS65 e 8 baterias TB65.\n🎥 Compatível com payloads L2, P1, H30T e sensores externos\n🧭 RTK integrado para mapeamento de alta precisão\n⏱️ Até 55 minutos de voo\n📡 Alcance de até 20 km\n⚖️ Peso médio de 3,8 kg sem carga\n🎮 Controle DJI RC Plus com tela de 7”\n💼 Estrutura reforçada com proteção IP55', salePrice: 136307.34,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 95415.14 }] },
        // Novos Docks e seus combos
        { id: 1015, name: 'DJI DOCK + MATRICE 30T + 2x TB30 + RC PLUS', spec: '🚀 DJI Dock com Matrice 30T, 2 baterias TB30 e controle RC Plus.\nTotalmente automatizado, ideal para monitoramento remoto.', salePrice: 130148.68,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 91104.08 }] },
        { id: 1016, name: 'DJI DOCK 2 + MATRICE 3D + CARREGADOR + BATERIA + RC PRO', spec: '🚀 DJI Dock 2 com Matrice 3D, carregador, bateria e controle RC Pro.\nSolução compacta para implantação rápida e operações autônomas.', salePrice: 130636.17,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 91445.32 }] },
        { id: 1017, name: 'DJI DOCK 2 + MATRICE 3TD + CARREGADOR + BATERIA + RC PRO', spec: '🚀 DJI Dock 2 com Matrice 3TD (versão térmica), carregador, bateria e controle RC Pro.\nIdeal para inspeções térmicas autônomas e resposta rápida.', salePrice: 150078.14,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 105054.70 }] },
        // Itens diversos da GOHOBBY (atualizados ou novos)
        { id: 1018, name: 'DJI Mavic 2 Enterprise - Módulo RTK', spec: '🛰️ Módulo RTK para DJI Mavic 2 Enterprise.\nPrecisão centimétrica para levantamentos e mapeamentos.', salePrice: 3971.24,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 2779.87 }] },
        { id: 1019, name: 'DJI AL1 SPOTLIGHT (Matrice 4 Series)', spec: '💡 Holofote DJI AL1 para Matrice 4 Series.\nAcessório de iluminação para operações noturnas.', salePrice: 3743.81,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 2620.67 }] },
        { id: 1020, name: 'DJI AS1 SPEAKER (Matrice 4 Series)', spec: '📣 Alto-falante DJI AS1 para Matrice 4 Series.\nPermite comunicação em campo e operações de segurança.', salePrice: 2911.54,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 2038.08 }] },
        { id: 1021, name: 'DJI Mavic 3 Enterprise - Kit de Baterias', spec: '🔋 Kit de Baterias para DJI Mavic 3 Enterprise.\nGaranta maior tempo de voo para suas missões.', salePrice: 7812.40,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 5468.68 }] },
        { id: 1022, name: 'DJI MATRICE 4T Series - Bateria Individual', spec: '🔋 Bateria individual para DJI Matrice 4T Series.\nBateria de reposição ou adicional para Matrice 4T/4E.', salePrice: 2992.62,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 2094.84 }] },
        { id: 1023, name: 'DJI MATRICE 3D SERIES - Bateria Inteligente', spec: '🔋 Bateria Inteligente para DJI Matrice 3D Series.\nBateria de alta capacidade para os drones DJI Matrice 3D e 3TD.', salePrice: 3451.28,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 2415.90 }] },
        { id: 1024, name: 'DJI Mavic 3 - Speaker', spec: '📣 Alto-falante DJI para DJI Mavic 3.\nComunicação eficiente para operações com o Mavic 3.', salePrice: 1456.88,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 1258.58 }] },
        { id: 1025, name: 'DJI Mavic 3 Enterprise - Módulo RTK', spec: '🛰️ Módulo RTK para DJI Mavic 3 Enterprise.\nAumente a precisão de posicionamento do seu Mavic 3 Enterprise.', salePrice: 6987.17,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 4891.02 }] },
        { id: 1026, name: 'DJI Mavic 3 - Hub de carregamento', spec: '🔁 Hub de carregamento para DJI Mavic 3.\nCarrega múltiplas baterias do Mavic 3 de forma sequencial.', salePrice: 780.56,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 546.39 }] },
        { id: 1027, name: 'DJI Mavic 3 Enterprise - Hélices', spec: '🌀 Hélices de reposição para DJI Mavic 3 Enterprise.\nGaranta a segurança e performance do seu voo.', salePrice: 212.99,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 149.09 }] },
        { id: 1028, name: 'DJI Matrice 300 - Hélice 2110', spec: '🌀 Hélice 2110 para DJI Matrice 300 RTK.\nPeça essencial para a propulsão e estabilidade do drone.', salePrice: 591.55,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 414.08 }] },
        { id: 1029, name: 'DJI MATRICE 350 RTK + H30T PAYLOAD', spec: '🛠️ DJI Matrice 350 RTK com Payload H30T.\nSolução completa para inspeções, com câmera termográfica de alta resolução.', salePrice: 141237.96,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 101832.57 }] },
        { id: 1030, name: 'DJI Matrice 350 RTK - Hélices 2112', spec: '🌀 Hélices 2112 para DJI Matrice 350 RTK.\nAssegura a performance ideal de voo e a segurança da operação.', salePrice: 353.68,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 247.57 }] },
        { id: 1031, name: 'DJI Carregador Portátil 65W', spec: '⚡ Carregador Portátil DJI 65W.\nIdeal para carregar baterias de drones e outros dispositivos em movimento.', salePrice: 623.78,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 436.65 }] },
        { id: 1032, name: 'DJI WB37 - HUB de Carregamento (USB-C)', spec: '🔁 Hub de Carregamento WB37 com USB-C.\nCarrega as baterias WB37, essenciais para controles RC Plus e Smart Controller.', salePrice: 646.75,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 452.73 }] },
        { id: 1033, name: 'DJI WB37 - Bateria', spec: '🔋 Bateria DJI WB37.\nBateria de alta capacidade para controles remotos DJI RC Plus e Smart Controller.', salePrice: 875.44,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 612.80 }] },
        { id: 1034, name: 'DJI D-RTK Estação Móvel GNSS', spec: '🛰️ Estação Móvel DJI D-RTK GNSS.\nAumenta a precisão de posicionamento para mapeamentos e inspeções críticas.', salePrice: 27857.14,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 18753.81 }] },
        { id: 1035, name: 'DJI D-RTK Tripé', spec: ' tripod para Estação Móvel DJI D-RTK.\nEstabilidade essencial para operações RTK em campo.', salePrice: 3672.87,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 2571.01 }] },
        { id: 1036, name: 'Gohobby Turbo - Micro SD 128GB', spec: '💾 Cartão Micro SD 128GB - Gohobby Turbo.\nArmazenamento de alta velocidade para seus vídeos e fotos de drone.', salePrice: 195.14,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 136.60 }] },
        { id: 1037, name: 'Gohobby Turbo - Micro SD 256GB', spec: '💾 Cartão Micro SD 256GB - Gohobby Turbo.\nMais espaço e velocidade para capturar todos os momentos do seu voo.', salePrice: 254.53,
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 178.17 }] }
    ];

    let SUPPLIERS = [ // Use let para permitir que novos fornecedores sejam adicionados dinamicamente
        {
            id: 1,
            name: 'Arroba Celulares',
            details: 'Aroba celulares é um dos principais distribuidores e centros de manutenção de eletrônicos no Brasil.',
            payment: 'Aceitam pagamento a vista e parcelado em até 12x no cartão com taxas.',
            products: 'DJI Mini, Osmo Mobile, Acessórios',
            categories: ['Consumer', 'Equipamentos'],
            contacts: [
                { role: 'Atendimento Geral', name: 'Atendimento Arroba', whatsapp: '556281145767', email: '' }
            ]
        },
        {
            id: 2,
            name: 'DJI Grupo Multi',
            details: 'Atuam desde 2012 no mercado de drones e fotografia. Grupo Multi é importador de drones e estabilizadores.',
            payment: 'Aceitam pagamento a vista e parcelado em até 12x no cartão com taxas.',
            products: 'DJI Mini, DJI Air, Osmo Action, Acessórios',
            categories: ['Consumer', 'Equipamentos'],
            contacts: [
                { role: 'Atendimento Geral', name: 'Atendimento Grupo Multi', whatsapp: '551145731093', email: '' }
            ]
        },
        {
            id: 3,
            name: 'GoHobby Distribuidora de VANT LTDA',
            details: 'A GoHobby é importadora exclusiva de drones profissionais e tecnologias anti-drone no Brasil.',
            payment: 'Aceitam pagamento a vista e parcelado em até 12x no cartão com taxas.',
            products: 'DJI Mavic, DJI Matrice, Linha Enterprise, Soluções Anti-drone',
            categories: ['Enterprise', 'Agriculture', 'Equipamentos'],
            contacts: [
                { role: 'Gerente', name: 'Alexandre Elias', whatsapp: '5511955973434', email: '' }
            ]
        },
        // Fornecedores de peças
        {
            id: 4,
            name: 'Pedro - FlyUp (Anápolis)',
            details: 'Fornecedor de peças e serviços de manutenção em Anápolis.',
            payment: 'A combinar.',
            products: 'Peças diversas, componentes eletrônicos',
            categories: ['Pecas', 'Consumer'],
            contacts: [
                { role: 'Vendedor', name: 'Pedro', whatsapp: '556292065116', email: '' }
            ]
        },
        {
            id: 5,
            name: 'Eber - (Aparecida de Goiânia)',
            details: 'Especialista em peças e reparos de drones em Aparecida de Goiânia.',
            payment: 'A combinar.',
            products: 'Peças de reposição, baterias genéricas',
            categories: ['Pecas', 'Consumer', 'Enterprise'],
            contacts: [
                { role: 'Vendedor', name: 'Eber', whatsapp: '556293147403', email: '' }
            ]
        },
        {
            id: 6,
            name: 'Cristiano - (Goiânia)',
            details: 'Fornecedor local de peças e acessórios para drones em Goiânia.',
            payment: 'A combinar.',
            products: 'Peças e acessórios DJI, serviços de reparo',
            categories: ['Pecas', 'Consumer'],
            contacts: [
                { role: 'Vendedor', name: 'Cristiano', whatsapp: '556292506411', email: '' }
            ]
        },
        {
            id: 7,
            name: 'Agrobox Drones',
            details: 'Peças e Equipamentos para Agricultura. Local: Goiânia, Goiás.',
            payment: 'A combinar.',
            products: 'Peças e Equipamentos para Drones Agrícolas',
            categories: ['Agriculture', 'Equipamentos', 'Pecas'],
            contacts: [
                { role: 'Dono', name: 'Frederico', whatsapp: '5562982237211', email: '' },
                { role: 'Gerente', name: 'Marcos', whatsapp: '556281628361', email: '' },
                { role: 'Vendedor', name: 'Heverton', whatsapp: 'EM_BREVE', email: '' }
            ]
        }
    ];

    const INSTALLMENT_RATES = {
        1: 0.0309, 2: 0.0579, 3: 0.0609, 4: 0.0799, 5: 0.0809, 6: 0.0818,
        7: 0.0949, 8: 0.0966, 9: 0.1037, 10: 0.1105, 11: 0.1227, 12: 0.1238
    };

    const CONFIDENTIAL_SUPPLIER_PASSWORD = '@0639'; // Senha para acesso a fornecedores

    // --- Variáveis de Estado para Filtros e Ordenação ---
    let currentProductFilterState = { searchTerm: '', sortBy: 'default', category: '' };
    let currentSupplierFilterState = { searchTerm: '', sortBy: 'default', category: '' };
    let activeFilterTarget = ''; // 'products' or 'suppliers'

    // --- Funções de Utilidade ---
    const openModal = (modal) => { modal.style.display = 'block'; };
    const closeModal = (modal) => { modal.style.display = 'none'; };
    const formatCurrency = (value) => { return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value); };

    function getGreeting() {
        const hour = new Date().getHours();
        if (hour >= 6 && hour < 12) return 'Bom dia';
        if (hour >= 12 && hour < 18) return 'Boa tarde';
        return 'Boa noite';
    }

    // --- Login e Gestão de Sessão ---
    const handleLogin = (e) => {
        if (e) e.preventDefault();
        const username = usernameInput.value;
        const password = passwordInput.value;
        const user = USERS[username];

        if (user && user.password === password) {
            window.currentUser = { ...user, username: username }; // Armazena o usuário logado
            const storedProfile = localStorage.getItem(username + '_profile');
            if (storedProfile) {
                Object.assign(window.currentUser, JSON.parse(storedProfile));
            }
            loginError.style.display = 'none';
            closeModal(loginScreen);
            setupAppForUser();
            if (user.firstLogin) {
                showChangePasswordModal(true);
            }
        } else {
            loginError.textContent = 'Usuário ou senha inválidos.';
            loginError.style.display = 'block';
        }
    };

    const handleVisitorMode = () => {
        window.currentUser = { username: 'Visitante', role: 'visitor', isVisitor: true, displayName: 'Visitante', email: '', phone: '', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' };
        closeModal(loginScreen);
        setupAppForUser();
    };

    const handleLogout = () => {
        window.currentUser = null;
        window.pendingSupplierSectionAccess = false; // Reseta acesso a fornecedores
        localStorage.removeItem('currentUser');
        closeModal(appScreen);
        openModal(loginScreen);
        usernameInput.value = '';
        passwordInput.value = '';
        loginError.style.display = 'none';
        document.body.classList.remove('visitor-mode-bg');
        if (aiChatButton) aiChatButton.style.display = 'none';
        if (window.tempUserInterval) {
            clearInterval(window.tempUserInterval);
        }
    };

    const setupAppForUser = () => {
        const isVisitor = window.currentUser.isVisitor;
        const isAdmin = window.currentUser.role === 'admin';
        const isMarketing = window.currentUser.role === 'marketing';

        if (welcomeMessage) welcomeMessage.textContent = `Olá, ${window.currentUser.displayName || window.currentUser.username}!`;
        if (profileIcon) profileIcon.src = window.currentUser.profilePicUrl || 'https://i.imgur.com/8Yd00YF.png';

        if (productsNavButton) productsNavButton.style.display = isVisitor ? 'none' : 'block';
        if (calculatorNavButton) calculatorNavButton.style.display = isVisitor ? 'none' : 'block';
        if (suppliersNavButton) suppliersNavButton.style.display = isAdmin ? 'block' : 'none'; // Acesso a fornecedores apenas para admin (inicialmente)
        if (settingsNavButton) settingsNavButton.style.display = isAdmin ? 'block' : 'none';
        if (manageUsersNavButton) manageUsersNavButton.style.display = (isAdmin && window.currentUser.username === 'mikhaell') ? 'block' : 'none';
        if (createProductNavButton) createProductNavButton.style.display = isAdmin ? 'block' : 'none';
        if (editProductNavButton) editProductNavButton.style.display = isAdmin ? 'block' : 'none';
        if (dronesNavButton) dronesNavButton.style.display = 'block';
        if (infoEmpresaNavButton) infoEmpresaNavButton.style.display = 'block';
        if (marketingNavButton) marketingNavButton.style.display = isMarketing || isAdmin ? 'block' : 'none';
        if (profileNavButton) profileNavButton.classList.remove('hidden'); // Sempre visível para usuários logados
        if (aiChatButton) aiChatButton.style.display = 'block';

        openModal(appScreen); // Mostra a tela principal
        if (isVisitor) {
            document.body.classList.add('visitor-mode-bg');
            if (logoutButton) logoutButton.textContent = 'Sair do Modo Visitante';
            if (profileIcon) profileIcon.style.display = 'none';
            if (welcomeMessage) welcomeMessage.style.display = 'none';
            // Desabilitar contatos da empresa
            document.getElementById('cnpj-display-line').innerHTML = `<strong>CNPJ:</strong> <span style="filter: blur(4px);">60.102.179/0001-10</span> (Acesso Restrito)`;
            document.getElementById('company-phone').innerHTML = `<span style="filter: blur(4px);">(62) 3636-0668</span> (Acesso Restrito)`;
            document.getElementById('company-whatsapp-link').href = 'javascript:void(0);'; // Desabilitar link
            document.getElementById('company-whatsapp-link').style.opacity = 0.5;
            document.getElementById('company-whatsapp-link').style.pointerEvents = 'none';
            switchTab('drones-visitor-section'); // Aba padrão para visitante
        } else {
            document.body.classList.remove('visitor-mode-bg');
            if (logoutButton) logoutButton.textContent = 'Sair';
            if (profileIcon) profileIcon.style.display = 'flex';
            if (welcomeMessage) welcomeMessage.style.display = 'block';
            document.getElementById('cnpj-display-line').innerHTML = `<strong>CNPJ:</strong> 60.102.179/0001-10`;
            document.getElementById('company-phone').innerHTML = `(62) 3636-0668`;
            document.getElementById('company-whatsapp-link').href = 'https://wa.me/556236360668';
            document.getElementById('company-whatsapp-link').style.opacity = 1;
            document.getElementById('company-whatsapp-link').style.pointerEvents = 'auto';
            switchTab('products-section'); // Aba padrão para usuário logado
        }

        if (window.currentUser.type === 'temporary' && window.currentUser.expiresAt) {
            showTemporaryUserWarning();
        }
    };

    const switchTab = (newSectionId) => {
        const isVisitor = window.currentUser.isVisitor;
        const isAdmin = window.currentUser.role === 'admin';

        let canAccess = false;

        if (['products-section', 'calculator-section'].includes(newSectionId)) {
            canAccess = !isVisitor;
        } else if (['drones-visitor-section', 'info-section', 'marketing-section'].includes(newSectionId)) {
            canAccess = true; // Sempre acessível
        } else if (newSectionId === 'suppliers-section') {
            // Apenas admins podem acessar livremente, outros precisam de senha (ou já ter digitado)
            if (isAdmin || window.pendingSupplierSectionAccess) {
                canAccess = true;
            } else {
                openModal(supplierPasswordModal);
                supplierAccessPasswordInput.value = '';
                supplierPasswordError.style.display = 'none';
                return; // Impede a troca de aba até a senha ser validada
            }
        } else if (['settings-section', 'manage-users-section', 'create-product-section', 'edit-product-section'].includes(newSectionId)) {
            canAccess = isAdmin;
        } else if (newSectionId === 'profile-section') {
            canAccess = !isVisitor;
        }

        if (!canAccess) {
            alert('Você não tem permissão para acessar esta seção.');
            // Redireciona para uma aba permitida
            if (isVisitor) {
                newSectionId = 'drones-visitor-section';
            } else {
                newSectionId = 'products-section';
            }
        }

        contentSections.forEach(section => section.classList.remove('active'));
        navButtons.forEach(button => button.classList.remove('active'));

        document.getElementById(newSectionId).classList.add('active');
        document.querySelector(`[data-section="${newSectionId}"]`).classList.add('active');

        // Lógica para sub-menu de configurações
        if (newSectionId.startsWith('settings') && isAdmin) {
            if (settingsNavButton) settingsNavButton.classList.add('active');
            if (settingsSubNav) settingsSubNav.style.display = 'block';
        } else {
            if (settingsSubNav) settingsSubNav.style.display = 'none';
        }

        // Lógicas específicas de renderização para cada seção
        if (newSectionId === 'products-section') {
            currentProductFilterState = { searchTerm: '', sortBy: 'default', category: '' }; // Reseta filtros
            renderProducts();
            if (openProductFilterSortModalButton) openProductFilterSortModalButton.style.display = 'inline-flex';
            if (openSupplierFilterSortModalButton) openSupplierFilterSortModalButton.style.display = 'none';
        } else if (newSectionId === 'suppliers-section') {
            currentSupplierFilterState = { searchTerm: '', sortBy: 'default', category: '' }; // Reseta filtros
            renderSuppliers();
            if (openProductFilterSortModalButton) openProductFilterSortModalButton.style.display = 'none';
            if (openSupplierFilterSortModalButton) openSupplierFilterSortModalButton.style.display = 'inline-flex';
        } else {
            if (openProductFilterSortModalButton) openProductFilterSortModalButton.style.display = 'none';
            if (openSupplierFilterSortModalButton) openSupplierFilterSortModalButton.style.display = 'none';
        }

        if (newSectionId === 'drones-visitor-section') renderDroneVisitorList();
        if (newSectionId === 'manage-users-section') renderTempUserList();
        if (newSectionId === 'profile-section') renderProfilePage();
        if (newSectionId === 'settings-section') renderSettingsOptionsGrid();

        closeMobileNav(); // Fecha o menu lateral em mobile após a seleção
    };

    // --- Funções de Renderização de Conteúdo ---
    const renderProducts = () => {
        if (!productList) return;
        productList.innerHTML = '';
        let productsToDisplay = [...PRODUCTS];

        // Aplica filtro por termo de busca principal (da barra acima do botão de filtro)
        if (productSearchInput && productSearchInput.value) {
            const searchTerm = productSearchInput.value.toLowerCase();
            productsToDisplay = productsToDisplay.filter(p =>
                p.name.toLowerCase().includes(searchTerm) ||
                p.spec.toLowerCase().includes(searchTerm) ||
                (p.sources && p.sources.some(s => s.supplierName.toLowerCase().includes(searchTerm)))
            );
        }

        // Aplica filtros e ordenação do modal (se houver termo de busca no modal)
        if (currentProductFilterState.searchTerm) {
             const searchTermLower = currentProductFilterState.searchTerm.toLowerCase();
             productsToDisplay = productsToDisplay.filter(p =>
                 p.name.toLowerCase().includes(searchTermLower) ||
                 p.spec.toLowerCase().includes(searchTermLower) ||
                 (p.sources && p.sources.some(source => source.supplierName.toLowerCase().includes(searchTermLower)))
             );
         }

        if (currentProductFilterState.category && currentProductFilterState.category !== 'Todos') {
             productsToDisplay = productsToDisplay.filter(p => {
                 const productName = p.name.toLowerCase();
                 const category = currentProductFilterState.category;
                 if (category === 'Consumer' && (productName.includes('mini') || productName.includes('neo') || productName.includes('flip') || productName.includes('osmo'))) return true;
                 if (category === 'Enterprise' && (productName.includes('mavic 3 enterprise') || productName.includes('matrice') || productName.includes('dock') || productName.includes('sentinel') || productName.includes('skyfend') || productName.includes('inspire'))) return true;
                 if (category === 'Agriculture' && (productName.includes('mavic 3 multispectral') || productName.includes('agr'))) return true;
                 if (category === 'Acessorios' && (productName.includes('controle') || productName.includes('microfone') || productName.includes('óculos') || productName.includes('estabilizador') || productName.includes('case') || productName.includes('suporte') || productName.includes('garrafa') || productName.includes('modulo') || productName.includes('speaker') || productName.includes('spotlight') || productName.includes('sistema') || productName.includes('tripé') || productName.includes('sd') || productName.includes('hélice') || productName.includes('protetor'))) return true;
                 if (category === 'Baterias' && productName.includes('bateria')) return true;
                 return false;
             });
         }

        // Apply sorting
        productsToDisplay.sort((a, b) => {
            switch (currentProductFilterState.sortBy) {
                case 'price-asc': return a.salePrice - b.salePrice;
                case 'price-desc': return b.salePrice - a.salePrice;
                case 'alpha-asc': return a.name.localeCompare(b.name);
                case 'alpha-desc': return b.name.localeCompare(a.name);
                case 'recent': return b.id - a.id; // Assuming higher ID is more recent
                default: return 0;
            }
        });

        if (productsToDisplay.length === 0) {
            productList.innerHTML = '<p>Nenhum produto encontrado com os filtros aplicados.</p>';
            return;
        }

        productsToDisplay.forEach(product => {
            const productCard = document.createElement('div');
            productCard.className = 'card product-card';
            productCard.dataset.productId = product.id;
            const isAdmin = window.currentUser.role === 'admin';
            const salePriceLabel = window.currentUser.role === 'seller' ? 'Valor' : 'Valor de Venda';

            let adminCostInfoHTML = '';
            if (isAdmin && product.sources && product.sources.length > 0) {
                adminCostInfoHTML = `<p><strong>Custos por Fornecedor:</strong></p><ul class="product-suppliers-list">`;
                product.sources.forEach(source => {
                    adminCostInfoHTML += `
                        <li>
                            <a href="#" class="supplier-name-link" data-supplier-name="${source.supplierName}">
                                ${source.supplierName}
                            </a>
                            <span class="cost-value">${source.costPrice.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
                        </li>
                    `;
                });
                adminCostInfoHTML += `</ul>`;
            } else if (isAdmin) {
                adminCostInfoHTML = `<p><strong>Custos por Fornecedor:</strong> <span class="cost-value">N/A (Sem Fornecedor Registrado)</span></p>`;
            }


            productCard.innerHTML = `
                <h3>${product.name}</h3>
                <p class="product-spec"><strong>Especificações:</strong><br>${product.spec}</p>
                <p class="price">${salePriceLabel}: ${product.salePrice.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>
                ${adminCostInfoHTML}
                <div class="action-buttons-container">
                    <button class="gemini-button desc-button" data-product-id="${product.id}">✨ Gerar Descrição</button>
                    <button class="gemini-button args-button" data-product-id="${product.id}">✨ Criar Argumentos</button>
                    <button class="whatsapp-button" data-product-id="${product.id}">💬 WhatsApp</button>
                    <button class="help-button" data-product-id="${product.id}">💡 Ajudar Cliente</button>
                </div>
                <div class="calculator-container">
                    <div class="payment-method-selector">
                        <input type="radio" id="payment-vista-${product.id}" name="payment-method-${product.id}" value="vista" checked>
                        <label for="payment-vista-${product.id}">À vista</label>
                        <input type="radio" id="payment-parcelado-${product.id}" name="payment-method-${product.id}" value="parcelado">
                        <label for="payment-parcelado-${product.id}">Parcelado</label>
                    </div>
                    ${isAdmin ? `
                    <div class="discount-option" id="discount-option-${product.id}">
                        <label for="discount-percentage-${product.id}">Desconto (%):</label>
                        <input type="number" id="discount-percentage-${product.id}" min="0" max="15" value="0">
                    </div>
                    ` : ''}
                    <div class="installments-container hidden">
                        <label for="parcelas-${product.id}">Parcelas:</label>
                        <select id="parcelas-${product.id}" class="parcelas-select">
                           <option value="1">1x</option><option value="2">2x</option><option value="3">3x</option><option value="4">4x</option><option value="5">5x</option><option value="6">6x</option><option value="7">7x</option><option value="8">8x</option><option value="9">9x</option><option value="10">10x</option><option value="11">11x</option><option value="12">12x</option>
                        </select>
                    </div>
                    <button class="calculate-product-btn">Calcular</button>
                    <div class="product-calculator-result"></div>
                </div>
            `;
            productList.appendChild(productCard);
        });

        // Re-attach event listeners for dynamically created elements
        productList.querySelectorAll('.calculate-product-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const productId = e.target.dataset.productId;
                const productCard = e.target.closest('.product-card');
                const resultDiv = productCard.querySelector('.product-calculator-result');
                const paymentMethod = productCard.querySelector(`input[name="payment-method-${productId}"]:checked`).value;
                const numInstallments = productCard.querySelector(`#parcelas-${productId}`).value;
                const discountInput = productCard.querySelector(`#discount-percentage-${productId}`);
                const discountPercentage = discountInput ? parseFloat(discountInput.value) : 0;

                resultDiv.innerHTML = calculate(PRODUCTS.find(p => p.id === parseInt(productId)).salePrice, numInstallments, paymentMethod, discountPercentage);
            });
        });

        productList.querySelectorAll('input[name^="payment-method-"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const productId = e.target.name.replace('payment-method-', '');
                const productCard = e.target.closest('.product-card');
                const installmentsContainer = productCard.querySelector('.installments-container');
                const discountOption = productCard.querySelector(`#discount-option-${productId}`);

                if (e.target.value === 'parcelado') {
                    if (installmentsContainer) installmentsContainer.classList.remove('hidden');
                    if (discountOption) discountOption.classList.add('hidden');
                } else {
                    if (installmentsContainer) installmentsContainer.classList.add('hidden');
                    if (discountOption) discountOption.classList.remove('hidden');
                }
            });
        });

        productList.querySelectorAll('.gemini-button.desc-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const productId = e.target.dataset.productId;
                const product = PRODUCTS.find(p => p.id === parseInt(productId));
                if (product) {
                    const title = `Descrição para: ${product.name}`;
                    const prompt = `R2D2: Gere uma descrição de venda curta e apelativa para o produto "${product.name}", focando nos benefícios e usando as especificações: ${product.spec}. Não inclua o preço.`;
                    callGeminiAPI(prompt, title);
                }
            });
        });

        productList.querySelectorAll('.gemini-button.args-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const productId = e.target.dataset.productId;
                const product = PRODUCTS.find(p => p.id === parseInt(productId));
                if (product) {
                    const title = `Argumentos para: ${product.name}`;
                    const prompt = `R2D2: Liste 3 a 4 argumentos de venda concisos para o produto "${product.name}", explicando brevemente por que cada um é importante para o cliente, com base nas especificações: ${product.spec}.`;
                    callGeminiAPI(prompt, title);
                }
            });
        });

        productList.querySelectorAll('.whatsapp-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const productId = e.target.dataset.productId;
                const product = PRODUCTS.find(p => p.id === parseInt(productId));
                if (product) openWhatsAppModal(product);
            });
        });

        productList.querySelectorAll('.help-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const productId = e.target.dataset.productId;
                const product = PRODUCTS.find(p => p.id === parseInt(productId));
                if (product) handleCustomerHelp(product);
            });
        });

        productList.querySelectorAll('.supplier-name-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const supplierName = e.target.dataset.supplierName;
                window.pendingSupplierSectionAccess = true; // Força a permissão temporária
                switchTab('suppliers-section');
                setTimeout(() => {
                    const targetSupplierCard = document.querySelector(`#supplier-list .supplier-card h3 strong[data-supplier-name="${supplierName}"]`);
                    if (targetSupplierCard) {
                        targetSupplierCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        targetSupplierCard.closest('.supplier-card').style.backgroundColor = '#fffacd';
                        setTimeout(() => {
                            targetSupplierCard.closest('.supplier-card').style.backgroundColor = '';
                        }, 3000);
                    }
                }, 300);
            });
        });
    };

    const renderSuppliers = () => {
        if (!supplierList) return;
        supplierList.innerHTML = '';
        let suppliersToDisplay = [...SUPPLIERS];

        // Aplica filtro por termo de busca principal (da barra acima do botão de filtro)
        if (supplierSearchInput && supplierSearchInput.value) {
            const searchTerm = supplierSearchInput.value.toLowerCase();
            suppliersToDisplay = suppliersToDisplay.filter(s =>
                s.name.toLowerCase().includes(searchTerm) ||
                s.details.toLowerCase().includes(searchTerm) ||
                s.products.toLowerCase().includes(searchTerm) ||
                (s.contacts && s.contacts.some(c => c.name.toLowerCase().includes(searchTerm) || c.role.toLowerCase().includes(searchTerm)))
            );
        }

        // Aplica filtros e ordenação do modal
        if (currentSupplierFilterState.searchTerm) {
             const searchTermLower = currentSupplierFilterState.searchTerm.toLowerCase();
             suppliersToDisplay = suppliersToDisplay.filter(s =>
                 s.name.toLowerCase().includes(searchTermLower) ||
                 s.details.toLowerCase().includes(searchTermLower) ||
                 s.products.toLowerCase().includes(searchTermLower) ||
                 (s.contacts && s.contacts.some(c => c.name.toLowerCase().includes(searchTermLower) || c.role.toLowerCase().includes(searchTermLower)))
             );
         }

        if (currentSupplierFilterState.category && currentSupplierFilterState.category !== 'Todos') {
             suppliersToDisplay = suppliersToDisplay.filter(s => s.categories && s.categories.includes(currentSupplierFilterState.category));
         }

        // Apply sorting
        suppliersToDisplay.sort((a, b) => {
            switch (currentSupplierFilterState.sortBy) {
                case 'name-asc': return a.name.localeCompare(b.name);
                case 'name-desc': return b.name.localeCompare(a.name);
                case 'recent': return b.id - a.id; // Assuming higher ID is more recent
                default: return 0;
            }
        });


        if (suppliersToDisplay.length === 0) {
            supplierList.innerHTML = '<p>Nenhum fornecedor encontrado com os filtros aplicados.</p>';
            return;
        }

        suppliersToDisplay.forEach(supplier => {
            const supplierCard = document.createElement('div');
            supplierCard.className = 'card supplier-card';
            supplierCard.dataset.supplierId = supplier.id;

            let contactsHtml = '';
            if (supplier.contacts && supplier.contacts.length > 0) {
                contactsHtml += '<ul class="supplier-contacts-list">';
                supplier.contacts.forEach(contact => {
                    contactsHtml += `
                        <li>
                            <strong>${contact.role || 'Contato'}:</strong> ${contact.name || ''}
                    `;
                    if (contact.whatsapp && contact.whatsapp !== 'EM_BREVE') {
                        contactsHtml += `
                                <a href="https://wa.me/${contact.whatsapp}" target="_blank" class="action-button whatsapp-button" style="padding: 5px 10px; font-size: 0.8em; margin-left: 10px;">
                                    <i class="fab fa-whatsapp"></i> WhatsApp
                                </a>`;
                    } else if (contact.whatsapp === 'EM_BREVE') {
                        contactsHtml += ` (WhatsApp em breve)`;
                    }
                    contactsHtml += `</li>`;
                });
                contactsHtml += '</ul>';
            }

            supplierCard.innerHTML = `
                <h3><strong data-supplier-name="${supplier.name}">${supplier.name}</strong></h3>
                <p><strong>Detalhes:</strong> ${supplier.details || 'N/A'}</p>
                <div><strong>Pagamento:</strong><br>${supplier.payment || 'N/A'}</div>
                <p><strong>Produtos Principais:</strong> ${supplier.products || 'N/A'}</p>
                <p><strong>Categorias:</strong> ${supplier.categories ? supplier.categories.join(', ') : 'N/A'}</p>
                ${contactsHtml}
                ${window.currentUser.role === 'admin' ? `<button class="edit-supplier-button" data-supplier-id="${supplier.id}">✏️ Alterar</button>` : ''}
            `;
            supplierList.appendChild(supplierCard);
        });

        // Re-attach event listeners for edit supplier buttons
        supplierList.querySelectorAll('.edit-supplier-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const supplierId = parseInt(e.target.dataset.supplierId);
                loadSupplierForEdit(supplierId);
            });
        });
    };

    const renderDroneVisitorList = () => {
        if (!droneVisitorList) return;
        droneVisitorList.innerHTML = '';
        const searchTerm = droneVisitorSearchInput.value.toLowerCase();
        const dronesToShow = PRODUCTS.filter(p =>
            (p.name.toLowerCase().includes("dji") || p.name.toLowerCase().includes("drone") || p.name.toLowerCase().includes("mavic") || p.name.toLowerCase().includes("avata") || p.name.toLowerCase().includes("matrice") || p.name.toLowerCase().includes("skyfend") || p.name.toLowerCase().includes("sentinel") || p.name.toLowerCase().includes("neo") || p.name.toLowerCase().includes('osmo')) &&
            (p.name.toLowerCase().includes(searchTerm) || p.spec.toLowerCase().includes(searchTerm))
        );

        if (dronesToShow.length === 0) {
            droneVisitorList.innerHTML = '<p>Nenhum drone encontrado com esse termo.</p>';
            return;
        }

        dronesToShow.forEach(product => {
            const droneCard = document.createElement('div');
            droneCard.className = 'card product-card';
            droneCard.dataset.productId = product.id;

            droneCard.innerHTML = `
                <h3>${product.name}</h3>
                <p class="product-spec"><strong>Especificações:</strong><br>${product.spec}</p>
                <p class="price" style="color: var(--secondary-color);">Consultar valor e disponibilidade</p>
                <div class="action-buttons-container">
                    <a href="https://wa.me/556236360668?text=${encodeURIComponent('Olá, gostaria de saber mais sobre o ' + product.name + ' e sua disponibilidade.')}" target="_blank" class="action-button whatsapp-button" style="width: auto;">Consultar via WhatsApp</a>
                    <button class="action-button help-product-visitor-btn" data-product-name="${product.name}" data-product-spec="${product.spec}">Precisa de ajuda com esse produto?</button>
                </div>
            `;
            droneVisitorList.appendChild(droneCard);
        });

        // Re-attach listeners for visitor help button
        droneVisitorList.querySelectorAll('.help-product-visitor-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const productName = e.target.dataset.productName;
                const productSpec = e.target.dataset.productSpec;
                handleVisitorProductHelp(productName, productSpec);
            });
        });
    };

    // --- Calculadora Geral ---
    const calculate = (baseValue, numInstallments, paymentMethod, discountPercentage = 0) => {
        const valor = parseFloat(baseValue);
        if (isNaN(valor) || valor <= 0) {
            return '<p style="color:red;">Valor base inválido.</p>';
        }

        let valorFinalVista = valor * (1 + (INSTALLMENT_RATES[1] || 0)); // Assuming 1x also has a rate
        if (window.currentUser.role === 'admin' && paymentMethod === 'vista' && discountPercentage > 0 && discountPercentage <= 15) {
            valorFinalVista = valorFinalVista * (1 - (discountPercentage / 100));
        }
        valorFinalVista = parseFloat(valorFinalVista.toFixed(2));

        let resultHTML = `<div class="result-vista">Valor à Vista: ${valorFinalVista.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>`;

        if (paymentMethod === 'parcelado') {
            const parcelas = parseInt(numInstallments);
            const taxaParcelado = INSTALLMENT_RATES[parcelas] || 0;
            const valorFinalParcelado = valor * (1 + taxaParcelado);
            const valorParcela = valorFinalParcelado / parcelas;
            const valorTaxa = valorFinalParcelado - valor;

            resultHTML += `
                <div class="result-parcelado">
                    <strong>Opção Parcelado:</strong><br>
                    <span>Valor Final: <strong>${valorFinalParcelado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</strong></span><br>
                    <small>${parcelas}x de ${valorParcela.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</small><br>
                    <small>Valor da taxa: ${valorTaxa.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</small>
                </div>
            `;
        }
        return resultHTML;
    };

    // --- Gerenciamento de Usuários Temporários ---
    const renderTempUserList = () => {
        if (!tempUserListContainer) return; // Ensure element exists
        tempUserListContainer.innerHTML = ''; // Clear existing content
        const tempUsers = Object.entries(USERS).filter(([_, user]) => user.type === 'temporary');

        if(tempUsers.length === 0) {
            tempUserListContainer.innerHTML = '<p>Nenhum usuário temporário criado.</p>';
            return;
        }

        tempUsers.forEach(([username, user]) => {
            const item = document.createElement('div');
            item.className = 'temp-user-item';
            const expires = new Date(user.expiresAt).toLocaleString('pt-BR');
            item.innerHTML = `
                <div class="user-info">
                    <p><strong>${username}</strong></p>
                    <p><small>Expira em: ${expires}</small></p>
                </div>
                <div class="user-actions">
                    <button class="edit-btn" data-username="${username}">Editar</button>
                    <button class="delete-btn" data-username="${username}">Excluir</button>
                </div>
            `;
            tempUserListContainer.appendChild(item);
        });
        // Attach listeners to newly created buttons
        tempUserListContainer.querySelectorAll('.edit-btn').forEach(btn => btn.addEventListener('click', (e) => openEditTempUserModal(e.target.dataset.username)));
        tempUserListContainer.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', (e) => deleteTempUser(e.target.dataset.username)));
    };

    const openEditTempUserModal = (username) => {
        const user = USERS[username];
        if (!user) return;
        modalTitle.textContent = `Editar Usuário: ${username}`;
        modalBody.innerHTML = `
            <form id="edit-temp-user-form">
                <div class="input-group"><label for="edit-temp-password">Nova Senha</label><input type="text" id="edit-temp-password" value="${user.password}" required></div>
                <div class="input-group"><label for="edit-temp-duration">Estender Duração (a partir de agora)</label><select id="edit-temp-duration">
                    <option value="1">1 Hora</option><option value="8">8 Horas</option><option value="24">24 Horas</option><option value="72">72 Horas</option>
                </select></div>
                <button type="submit" class="action-button">Salvar Alterações</button>
            </form>
        `;
        openModal(mainModal);
        document.getElementById('edit-temp-user-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newPassword = document.getElementById('edit-temp-password').value;
            const newDuration = parseInt(document.getElementById('edit-temp-duration').value);
            USERS[username].password = newPassword;
            USERS[username].expiresAt = Date.now() + newDuration * 60 * 60 * 1000;
            closeModal(mainModal);
            renderTempUserList();
            alert(`Usuário ${username} atualizado.`);
        });
    };

    const deleteTempUser = (username) => {
        if (confirm(`Tem certeza que deseja excluir o usuário temporário "${username}"?`)) {
            delete USERS[username];
            renderTempUserList();
            if (window.currentUser && window.currentUser.username === username) {
                handleLogout();
                alert('Sua sessão foi encerrada, pois o usuário temporário foi excluído.');
            }
        }
    };

    const showTemporaryUserWarning = () => {
        // Implementação da exibição de aviso para usuário temporário
        // Usar um modal ou banner para isso. Por enquanto, um alerta simplificado.
        alert('Você está usando uma conta temporária. Seu acesso pode expirar.');
    };

    // --- Gerenciamento de Produtos (CRUD) ---
    const generateNewProductId = () => {
        if (PRODUCTS.length === 0) return 1;
        const maxId = Math.max(...PRODUCTS.map(p => p.id));
        return maxId + 1;
    };

    const handleCreateProduct = (e) => {
        e.preventDefault();
        const newProduct = {
            id: generateNewProductId(),
            name: newProductNameInput.value.trim(),
            spec: newProductSpecInput.value.trim(),
            salePrice: parseFloat(newProductSalePriceInput.value),
            costPrice: parseFloat(newProductCostPriceInput.value),
            sources: [{ supplierName: newProductSupplierSelect.value || 'Não especificado', costPrice: parseFloat(newProductCostPriceInput.value) || 0 }]
        };
        if (!newProduct.name || isNaN(newProduct.salePrice) || newProduct.salePrice <= 0) {
            if (createProductFeedback) {
                createProductFeedback.textContent = 'Preencha todos os campos obrigatórios (Nome, Especificações, Preço de Venda).';
                createProductFeedback.style.color = 'red';
            }
            return;
        }
        PRODUCTS.push(newProduct);
        localStorage.setItem('PRODUCTS', JSON.stringify(PRODUCTS));
        if (createProductFeedback) {
            createProductFeedback.textContent = `Produto "${newProduct.name}" criado com sucesso!`;
            createProductFeedback.style.color = 'green';
        }
        if (createProductForm) createProductForm.reset();
        renderProducts();
    };

    const handleSearchProductToEdit = () => {
        const searchTerm = editProductSearchInput.value.trim().toLowerCase();
        if (editProductSearchResults) editProductSearchResults.innerHTML = '';
        if (editProductForm) editProductForm.classList.add('hidden');
        if (editProductDisplay) editProductDisplay.innerHTML = '<p>Use a busca acima para carregar os dados do produto.</p>';
        if (editProductFeedback) editProductFeedback.textContent = '';

        if (!searchTerm) {
            if (editProductSearchResults) editProductSearchResults.innerHTML = '<p style="color:orange;">Por favor, digite um ID ou nome para pesquisar.</p>';
            return;
        }
        let foundProducts = PRODUCTS.filter(p => p.id.toString() === searchTerm || p.name.toLowerCase().includes(searchTerm));
        if (foundProducts.length > 0) {
            const ul = document.createElement('ul');
            foundProducts.forEach(product => {
                const li = document.createElement('li');
                li.style.padding = '8px';
                li.style.borderBottom = '1px solid #eee';
                li.style.cursor = 'pointer';
                li.textContent = `${product.name} (ID: ${product.id})`;
                li.onclick = () => loadProductForEdit(product.id);
                ul.appendChild(li);
            });
            if (editProductSearchResults) editProductSearchResults.appendChild(ul);
        } else {
            if (editProductSearchResults) editProductSearchResults.innerHTML = '<p style="color:orange;">Nenhum produto encontrado.</p>';
        }
    };

    const loadProductForEdit = (productId) => {
        const product = PRODUCTS.find(p => p.id === productId);
        if (product) {
            if (editProductDisplay) editProductDisplay.innerHTML = `<p>Editando: <strong>${product.name}</strong> (ID: ${product.id})</p>`;
            if (editProductForm) editProductForm.classList.remove('hidden');
            if (editProductIdInput) editProductIdInput.value = product.id;
            if (editProductNameInput) editProductNameInput.value = product.name;
            if (editProductSpecTextarea) editProductSpecTextarea.value = product.spec;
            if (editProductSalePriceInput) editProductSalePriceInput.value = product.salePrice;
            if (editProductCostPriceInput) editProductCostPriceInput.value = product.sources[0]?.costPrice || '';
            const supplierOption = editProductSupplierInput.querySelector(`option[value="${product.sources[0]?.supplierName}"]`);
            if (supplierOption) {
                 if (editProductSupplierInput) editProductSupplierInput.value = product.sources[0].supplierName;
            } else {
                 if (editProductSupplierInput) editProductSupplierInput.value = ''; // Clear if supplier not found
            }
            if (editProductSearchResults) editProductSearchResults.innerHTML = ''; // Clear search results after selection
        }
    };

    const handleEditProduct = (e) => {
        e.preventDefault();
        const productId = parseInt(editProductIdInput.value);
        const productIndex = PRODUCTS.findIndex(p => p.id === productId);
        if (productIndex === -1) {
            if (editProductFeedback) {
                editProductFeedback.textContent = 'Erro: Produto não encontrado.';
                editProductFeedback.style.color = 'red';
            }
            return;
        }

        const updatedProduct = {
            id: productId,
            name: editProductNameInput.value.trim(),
            spec: editProductSpecTextarea.value.trim(),
            salePrice: parseFloat(editProductSalePriceInput.value),
            costPrice: parseFloat(editProductCostPriceInput.value),
            sources: [{ supplierName: editProductSupplierInput.value || 'Não especificado', costPrice: parseFloat(editProductCostPriceInput.value) || 0 }]
        };

        if (!updatedProduct.name || isNaN(updatedProduct.salePrice) || updatedProduct.salePrice <= 0) {
            if (editProductFeedback) {
                editProductFeedback.textContent = 'Preenchimento obrigatório (Nome, Especificações, Preço de Venda).';
                editProductFeedback.style.color = 'red';
            }
            return;
        }
        PRODUCTS[productIndex] = updatedProduct;
        localStorage.setItem('PRODUCTS', JSON.stringify(PRODUCTS));
        if (editProductFeedback) {
            editProductFeedback.textContent = `Produto "${updatedProduct.name}" atualizado!`;
            editProductFeedback.style.color = 'green';
        }
        if (editProductForm) editProductForm.classList.add('hidden');
        if (editProductSearchInput) editProductSearchInput.value = '';
        if (editProductSearchResults) editProductSearchResults.innerHTML = '';
        renderProducts();
    };

    // --- Gerenciamento de Fornecedores (CRUD) ---
    const generateNewSupplierId = () => {
        if (SUPPLIERS.length === 0) return 1;
        const maxId = Math.max(...SUPPLIERS.map(s => s.id));
        return maxId + 1;
    };

    const addContactField = (contact = {}) => {
        const index = supplierContactsContainer.children.length;
        const contactDiv = document.createElement('div');
        contactDiv.className = 'contact-entry';
        contactDiv.innerHTML = `
            <button type="button" class="remove-contact-button">×</button>
            <div class="input-group">
                <label for="contact-name-${index}">Nome do Contato</label>
                <input type="text" id="contact-name-${index}" value="${contact.name || ''}" required>
            </div>
            <div class="input-group">
                <label for="contact-role-${index}">Cargo</label>
                <input type="text" id="contact-role-${index}" value="${contact.role || ''}" required>
            </div>
            <div class="input-group">
                <label for="contact-whatsapp-${index}">WhatsApp/Celular</label>
                <input type="text" id="contact-whatsapp-${index}" value="${contact.whatsapp || ''}" placeholder="Ex: 5562981234567" required>
            </div>
            <div class="input-group">
                <label for="contact-email-${index}">E-mail</label>
                <input type="email" id="contact-email-${index}" value="${contact.email || ''}">
            </div>
            <div class="input-group">
                <label for="contact-department-${index}">Departamento</label>
                <input type="text" id="contact-department-${index}" value="${contact.department || ''}">
            </div>
            <div class="input-group">
                <label for="contact-branch-${index}">Filial/Matriz</label>
                <input type="text" id="contact-branch-${index}" value="${contact.branch || ''}">
            </div>
        `;
        if (supplierContactsContainer) supplierContactsContainer.appendChild(contactDiv);
        contactDiv.querySelector('.remove-contact-button').addEventListener('click', () => contactDiv.remove());
    };

    const openCreateSupplierModal = () => {
        if (manageSupplierModalTitle) manageSupplierModalTitle.textContent = 'Criar Novo Fornecedor';
        if (supplierIdToEditInput) supplierIdToEditInput.value = '';
        if (manageSupplierForm) manageSupplierForm.reset();
        if (supplierContactsContainer) supplierContactsContainer.innerHTML = '';
        addContactField(); // Adiciona um campo de contato vazio por padrão
        if (manageSupplierFeedback) manageSupplierFeedback.textContent = '';
        openModal(manageSupplierModal);
    };

    const openEditSupplierSearchModal = () => {
        if (editSupplierSearchInputModal) editSupplierSearchInputModal.value = '';
        if (editSupplierSearchResultsModal) editSupplierSearchResultsModal.innerHTML = '';
        openModal(editSupplierSearchModal);
    };

    const handleSearchSupplierToEdit = () => {
        const searchTerm = editSupplierSearchInputModal.value.trim().toLowerCase();
        if (editSupplierSearchResultsModal) editSupplierSearchResultsModal.innerHTML = '';
        if (!searchTerm) {
            if (editSupplierSearchResultsModal) editSupplierSearchResultsModal.innerHTML = '<p style="color:orange;">Por favor, digite o nome do fornecedor para pesquisar.</p>';
            return;
        }
        const foundSuppliers = SUPPLIERS.filter(s => s.name.toLowerCase().includes(searchTerm));
        if (foundSuppliers.length > 0) {
            const ul = document.createElement('ul');
            foundSuppliers.forEach(supplier => {
                const li = document.createElement('li');
                li.style.padding = '8px';
                li.style.borderBottom = '1px solid #eee';
                li.style.cursor = 'pointer';
                li.textContent = supplier.name;
                li.addEventListener('click', () => loadSupplierForEdit(supplier.id));
                ul.appendChild(li);
            });
            if (editSupplierSearchResultsModal) editSupplierSearchResultsModal.appendChild(ul);
        } else {
            if (editSupplierSearchResultsModal) editSupplierSearchResultsModal.innerHTML = '<p style="color:orange;">Nenhum fornecedor encontrado.</p>';
        }
    };

    const loadSupplierForEdit = (supplierId) => {
        const supplier = SUPPLIERS.find(s => s.id === supplierId);
        if (!supplier) {
            alert('Fornecedor não encontrado!');
            return;
        }
        closeModal(editSupplierSearchModal);
        if (manageSupplierModalTitle) manageSupplierModalTitle.textContent = `Alterar Fornecedor: ${supplier.name}`;
        if (supplierIdToEditInput) supplierIdToEditInput.value = supplier.id;
        if (supplierNameInput) supplierNameInput.value = supplier.name;
        if (supplierDetailsTextarea) supplierDetailsTextarea.value = supplier.details;
        if (supplierPaymentTextarea) supplierPaymentTextarea.value = supplier.payment;
        if (supplierProductsInput) supplierProductsInput.value = supplier.products;
        if (supplierCategoryCheckboxes) supplierCategoryCheckboxes.forEach(cb => {
            cb.checked = supplier.categories.includes(cb.value);
        });
        if (supplierContactsContainer) supplierContactsContainer.innerHTML = '';
        supplier.contacts.forEach(contact => addContactField(contact));
        if (supplier.contacts.length === 0) addContactField();
        if (manageSupplierFeedback) manageSupplierFeedback.textContent = '';
        openModal(manageSupplierModal);
    };

    const handleSaveSupplier = (e) => {
        e.preventDefault();
        const id = supplierIdToEditInput.value ? parseInt(supplierIdToEditInput.value) : generateNewSupplierId();
        const name = supplierNameInput.value.trim();
        const details = supplierDetailsTextarea.value.trim();
        const payment = supplierPaymentTextarea.value.trim();
        const productsText = supplierProductsInput.value.trim();
        const categories = Array.from(supplierCategoryCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
        const contacts = [];
        let isValidContacts = true;
        supplierContactsContainer.querySelectorAll('.contact-entry').forEach((entry, index) => {
            const contactName = entry.querySelector(`#contact-name-${index}`).value.trim();
            const contactRole = entry.querySelector(`#contact-role-${index}`).value.trim();
            const contactWhatsapp = entry.querySelector(`#contact-whatsapp-${index}`).value.trim();
            const contactEmail = entry.querySelector(`#contact-email-${index}`).value.trim();
            const contactDepartment = entry.querySelector(`#contact-department-${index}`).value.trim();
            const contactBranch = entry.querySelector(`#contact-branch-${index}`).value.trim();

            if (!contactName || !contactRole || !contactWhatsapp) {
                isValidContacts = false;
                return;
            }
            contacts.push({
                name: contactName,
                role: contactRole,
                whatsapp: contactWhatsapp,
                email: contactEmail,
                department: contactDepartment,
                branch: contactBranch
            });
        });

        if (!name || categories.length === 0 || !isValidContacts || contacts.length === 0) {
            if (manageSupplierFeedback) {
                manageSupplierFeedback.textContent = 'Por favor, preencha todos os campos obrigatórios (Nome, Cargo, WhatsApp/Celular e ao menos uma Categoria de Fornecedor).';
                manageSupplierFeedback.style.color = 'red';
            }
            return;
        }

        const newSupplierData = { id, name, details, payment, products: productsText, categories, contacts };
        const existingIndex = SUPPLIERS.findIndex(s => s.id === id);

        if (existingIndex > -1) {
            SUPPLIERS[existingIndex] = newSupplierData;
            if (manageSupplierFeedback) manageSupplierFeedback.textContent = `Fornecedor "${name}" atualizado com sucesso!`;
        } else {
            newSupplierData.id = generateNewSupplierId(); // Ensure new ID for new supplier
            SUPPLIERS.push(newSupplierData);
            if (manageSupplierFeedback) manageSupplierFeedback.textContent = `Fornecedor "${name}" criado com sucesso!`;
        }
        if (manageSupplierFeedback) manageSupplierFeedback.style.color = 'green';
        localStorage.setItem('SUPPLIERS', JSON.stringify(SUPPLIERS));
        renderSuppliers();
        setTimeout(() => closeModal(manageSupplierModal), 1500);
    };

    // --- Filtros e Ordenação (NOVA IMPLEMENTAÇÃO) ---
    const productCategories = ['Consumer', 'Enterprise', 'Agriculture', 'Acessorios', 'Baterias'];
    // Extrai categorias únicas dos fornecedores para o filtro, incluindo "Peças" e "Equipamentos"
    const supplierCategories = [...new Set(SUPPLIERS.flatMap(s => s.categories || []))];


    const openFilterSortModal = (type) => { // 'products' ou 'suppliers'
        activeFilterTarget = type;
        if (filterSortModalTitle) filterSortModalTitle.textContent = `Filtros e Ordenação de ${type === 'products' ? 'Produtos' : 'Fornecedores'}`;
        if (filterSortSearchInput) filterSortSearchInput.value = type === 'products' ? currentProductFilterState.searchTerm : currentSupplierFilterState.searchTerm;

        if (filterSortOrderButtons) filterSortOrderButtons.innerHTML = '';
        if (filterSortCategoryButtons) filterSortCategoryButtons.innerHTML = '';

        let orderOptions = [];
        if (type === 'products') {
             orderOptions = [
                { text: 'Preço ↑', value: 'price-asc'},
                { text: 'Preço ↓', value: 'price-desc'},
                { text: 'A-Z ↑', value: 'alpha-asc'},
                { text: 'Z-A ↓', value: 'alpha-desc'},
                { text: 'Mais Recentes', value: 'recent'}
            ];
        } else if (type === 'suppliers') {
            orderOptions = [
                { text: 'A-Z ↑', value: 'name-asc'},
                { text: 'Z-A ↓', value: 'name-desc'},
                { text: 'Mais Recentes', value: 'recent'}
            ];
        }

        orderOptions.forEach(option => {
            const button = document.createElement('button');
            button.textContent = option.text;
            button.dataset.sortBy = option.value;
            if ((type === 'products' && currentProductFilterState.sortBy === option.value) ||
                (type === 'suppliers' && currentSupplierFilterState.sortBy === option.value)) {
                button.classList.add('active');
            }
            button.addEventListener('click', () => {
                if (filterSortOrderButtons) filterSortOrderButtons.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                if (type === 'products') currentProductFilterState.sortBy = option.value;
                else if (type === 'suppliers') currentSupplierFilterState.sortBy = option.value;
            });
            if (filterSortOrderButtons) filterSortOrderButtons.appendChild(button);
        });

        const categoriesToDisplay = type === 'products' ? productCategories : supplierCategories;

        categoriesToDisplay.forEach(cat => {
            const button = document.createElement('button');
            button.textContent = cat;
            button.dataset.category = cat;
            if ((type === 'products' && currentProductFilterState.category === cat) ||
                (type === 'suppliers' && currentSupplierFilterState.category === cat)) {
                button.classList.add('active');
            }
            button.addEventListener('click', () => {
                if (button.classList.contains('active')) {
                    button.classList.remove('active');
                    if (type === 'products') currentProductFilterState.category = '';
                    else if (type === 'suppliers') currentSupplierFilterState.category = '';
                } else {
                    if (filterSortCategoryButtons) filterSortCategoryButtons.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    if (type === 'products') currentProductFilterState.category = cat;
                    else if (type === 'suppliers') currentSupplierFilterState.category = cat;
                }
            });
            if (filterSortCategoryButtons) filterSortCategoryButtons.appendChild(button);
        });

        openModal(filterSortModal);
    };

    const applyFilterSort = () => {
        if (activeFilterTarget === 'products') {
            if (filterSortSearchInput) currentProductFilterState.searchTerm = filterSortSearchInput.value.toLowerCase().trim();
            renderProducts(); // Re-renderiza produtos com os filtros atualizados
        } else if (activeFilterTarget === 'suppliers') {
            if (filterSortSearchInput) currentSupplierFilterState.searchTerm = filterSortSearchInput.value.toLowerCase().trim();
            renderSuppliers(); // Re-renderiza fornecedores com os filtros atualizados
        }
        closeModal(filterSortModal);
    };

    // --- Event Listeners ---
    if (loginButton) loginButton.addEventListener('click', handleLogin);
    if (passwordInput) {
        passwordInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleLogin(); });
    }
    if (visitorModeButton) visitorModeButton.addEventListener('click', handleVisitorMode);
    if (logoutButton) logoutButton.addEventListener('click', handleLogout);

    if (navButtons) navButtons.forEach(button => {
        button.addEventListener('click', () => {
            const sectionId = button.dataset.section;
            switchTab(sectionId);
        });
    });

    if (productSearchInput) {
        productSearchInput.addEventListener('input', () => {
            // Ao digitar na barra de busca principal, reseta os filtros do modal e aplica a busca
            currentProductFilterState.searchTerm = productSearchInput.value.toLowerCase().trim();
            currentProductFilterState.category = '';
            currentProductFilterState.sortBy = 'default';
            // Se houver um botão de categoria ativo no modal, desativa-o visualmente
            if (filterSortCategoryButtons) {
                filterSortCategoryButtons.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            }
            // Se houver um botão de ordenação ativo no modal, desativa-o visualmente
            if (filterSortOrderButtons) {
                filterSortOrderButtons.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            }
            renderProducts();
        });
    }

    if (generalCalcValorBase) generalCalcValorBase.addEventListener('input', () => { /* re-calculate or clear result */ });
    if (generalCalcPaymentRadios) generalCalcPaymentRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
            if (generalCalcInstallmentsContainer) generalCalcInstallmentsContainer.classList.toggle('hidden', e.target.value !== 'parcelado');
            if (generalDiscountOption) generalDiscountOption.classList.toggle('hidden', e.target.value !== 'vista');
        });
    });
    if (generalCalculateButton) generalCalculateButton.addEventListener('click', () => {
        const baseValue = generalCalcValorBase ? generalCalcValorBase.value : 0;
        const paymentMethod = document.querySelector('input[name="general-payment-method"]:checked')?.value || 'vista';
        const numInstallments = generalCalcParcelasSelect ? generalCalcParcelasSelect.value : 1;
        const discountPercentage = generalDiscountPercentageInput ? parseFloat(generalDiscountPercentageInput.value) : 0;
        if (generalCalculatorResult) generalCalculatorResult.innerHTML = calculate(baseValue, numInstallments, paymentMethod, discountPercentage);
    });

    if (mainModal) {
        mainModal.querySelectorAll('.close-button').forEach(btn => btn.addEventListener('click', () => closeModal(mainModal)));
    }

    if (aiChatButton) aiChatButton.addEventListener('click', () => openModal(aiChatModal));
    if (aiChatModal) {
        aiChatModal.querySelector('.close-button').addEventListener('click', () => closeModal(aiChatModal));
        if (submitAiQuestionButton) submitAiQuestionButton.addEventListener('click', async () => {
            const question = aiQuestionInput.value.trim();
            if (!question) return;

            aiResponseArea.textContent = 'Pensando...';
            if (aiLoader) aiLoader.style.display = 'block';
            submitAiQuestionButton.disabled = true;

            try {
                const apiKey = "SUA_CHAVE_DE_API_GEMINI";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;

                if (apiKey === "SUA_CHAVE_DE_API_GEMINI" || apiKey === "") {
                    aiResponseArea.innerHTML = `<p style="color:red;">Erro: Chave da API do Gemini não configurada. Por favor, adicione sua chave de API no código JavaScript para que a funcionalidade de IA funcione.</p>`;
                    return;
                }

                const payload = { contents: [{ role: "user", parts: [{ text: question }] }] };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message || `Erro na API: ${response.statusText}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts) {
                    aiResponseArea.innerHTML = result.candidates[0].content.parts[0].text.replace(/\n/g, '<br>');
                } else { throw new Error("A resposta da API não contém o conteúdo esperado."); }

            } catch (error) {
                aiResponseArea.innerHTML = `<p style="color:red;">Ocorreu um erro ao comunicar com a IA. Tente novamente.<br><small>Detalhe: ${error.message}</small></p>`;
                console.error('AI Chat Error:', error);
            } finally {
                if (aiLoader) aiLoader.style.display = 'none';
                submitAiQuestionButton.disabled = false;
            }
        });
    }

    if (supplierPasswordModal) {
        supplierPasswordModal.querySelector('.close-button').addEventListener('click', () => {
            closeModal(supplierPasswordModal);
            window.pendingSupplierSectionAccess = false;
            if (window.activeSectionId === 'suppliers-section') {
                switchTab('products-section'); // Volta para produtos se fechou sem senha
            }
        });
        if (submitSupplierPasswordButton) submitSupplierPasswordButton.addEventListener('click', () => {
            if (supplierAccessPasswordInput.value === CONFIDENTIAL_CODE) {
                closeModal(supplierPasswordModal);
                window.pendingSupplierSectionAccess = true; // Permite acesso enquanto a sessão durar
                switchTab('suppliers-section'); // Continua para a aba de fornecedores
            } else {
                if (supplierPasswordError) supplierPasswordError.textContent = 'Senha incorreta.';
                if (supplierPasswordError) supplierPasswordError.style.display = 'block';
                if (supplierAccessPasswordInput) supplierAccessPasswordInput.value = '';
            }
        });
        if (supplierAccessPasswordInput) supplierAccessPasswordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (submitSupplierPasswordButton) submitSupplierPasswordButton.click();
            }
        });
    }

    if (openChangePasswordModalButton) openChangePasswordModalButton.addEventListener('click', (e) => {
        e.preventDefault(); // Evita navegação se for um link
        if (newPasswordInput) newPasswordInput.value = '';
        if (confirmNewPasswordInput) confirmNewPasswordInput.value = '';
        if (changePasswordError) changePasswordError.style.display = 'none';
        if (changePasswordSuccess) changePasswordSuccess.style.display = 'none';
        openModal(changePasswordModal);
    });
    if (changePasswordCloseButton) changePasswordCloseButton.addEventListener('click', () => closeModal(changePasswordModal));
    if (submitChangePasswordButton) submitChangePasswordButton.addEventListener('click', () => {
        const newPass = newPasswordInput.value;
        const confirmPass = confirmNewPasswordInput.value;
        if (newPass.length < 6 || newPass !== confirmPass) {
            if (changePasswordError) {
                changePasswordError.textContent = 'A nova senha deve ter no mínimo 6 dígitos e as senhas devem ser iguais.';
                changePasswordError.style.display = 'block';
            }
            if (changePasswordSuccess) changePasswordSuccess.style.display = 'none';
            return;
        }
        if (window.currentUser) {
            USERS[window.currentUser.username].password = newPass;
            window.currentUser.password = newPass;
            localStorage.setItem('currentUser', JSON.stringify(window.currentUser)); // Persiste a nova senha na sessão
            if (changePasswordSuccess) changePasswordSuccess.style.display = 'block';
            if (changePasswordError) changePasswordError.style.display = 'none';
            setTimeout(() => closeModal(changePasswordModal), 1500);
        }
    });

    if (profileEditForm) profileEditForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (window.currentUser) {
            window.currentUser.displayName = editDisplayNameInput.value;
            window.currentUser.email = editEmailInput.value;
            window.currentUser.phone = editPhoneInput.value;
            USERS[window.currentUser.username].displayName = editDisplayNameInput.value;
            USERS[window.currentUser.username].email = editEmailInput.value;
            USERS[window.currentUser.username].phone = editPhoneInput.value;
            localStorage.setItem('currentUser', JSON.stringify(window.currentUser)); // Persiste dados atualizados na sessão
            alert('Perfil atualizado com sucesso!');
            renderProfilePage(); // Atualiza a exibição na página de perfil
            // Re-renderiza a mensagem de boas-vindas no header se o nome de exibição mudou
            if (welcomeMessage) welcomeMessage.textContent = `Olá, ${window.currentUser.displayName || window.currentUser.username}!`;
        }
    });

    if (uploadProfilePicButton) uploadProfilePicButton.addEventListener('click', () => {
        if (profilePicUploadInput) profilePicUploadInput.click();
    });
    if (profilePicUploadInput) profilePicUploadInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                if (profilePicDisplay) profilePicDisplay.src = event.target.result;
                if (profileIcon) profileIcon.src = event.target.result; // Atualiza o ícone do header
                if (window.currentUser) {
                    window.currentUser.profilePicUrl = event.target.result;
                    USERS[window.currentUser.username].profilePicUrl = event.target.result;
                    localStorage.setItem('currentUser', JSON.stringify(window.currentUser)); // Persiste a nova URL da imagem
                }
            };
            reader.readAsDataURL(file);
        }
    });

    if (whatsappCloseButton) whatsappCloseButton.addEventListener('click', () => closeModal(whatsappModal));
    if (cancelWhatsappButton) cancelWhatsappButton.addEventListener('click', () => closeModal(whatsappModal));
    if (sendWhatsappButton) sendWhatsappButton.addEventListener('click', generateBudgetWhatsappMessage); // Reutilizando a função de orçamento

    if (openBudgetModalButton) openBudgetModalButton.addEventListener('click', () => openBudgetModal()); // Event listener para abrir o modal
    if (budgetCloseButton) budgetCloseButton.addEventListener('click', () => closeModal(budgetModal));

    // Event listeners para os checkboxes de categoria de drone no modal de orçamento
    if (droneCategoryCheckboxes) droneCategoryCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            const anyCategorySelected = Array.from(droneCategoryCheckboxes).some(cb => cb.checked);
            if (itemTypeGroup) itemTypeGroup.classList.toggle('hidden', !anyCategorySelected);
            if (!anyCategorySelected) {
                if (itemTypeCheckboxes) itemTypeCheckboxes.forEach(cb => cb.checked = false);
                if (equipmentDetailsGroup) equipmentDetailsGroup.classList.add('hidden');
                if (sparePartsDetailsGroup) sparePartsDetailsGroup.classList.add('hidden');
                if (budgetSupplierSelectGroup) budgetSupplierSelectGroup.classList.add('hidden');
                if (selectedSupplierContactDiv) selectedSupplierContactDiv.classList.add('hidden');
            }
        });
    });

    // Event listeners para os checkboxes de tipo de item no modal de orçamento
    if (itemTypeCheckboxes) itemTypeCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            const equipmentSelected = Array.from(itemTypeCheckboxes).some(cb => cb.value === 'Equipamentos' && cb.checked);
            const piecesSelected = Array.from(itemTypeCheckboxes).some(cb => cb.value === 'Pecas' && cb.checked);

            if (equipmentDetailsGroup) equipmentDetailsGroup.classList.toggle('hidden', !equipmentSelected);
            if (sparePartsDetailsGroup) sparePartsDetailsGroup.classList.toggle('hidden', !piecesSelected);

            const anyItemSelected = equipmentSelected || piecesSelected;
            if (budgetSupplierSelectGroup) budgetSupplierSelectGroup.classList.toggle('hidden', !anyItemSelected);

            if (anyItemSelected && budgetSupplierCheckboxesContainer) {
                const selectedCategories = Array.from(droneCategoryCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
                const selectedItemTypes = Array.from(itemTypeCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
                const relevantCategories = [...selectedCategories, ...selectedItemTypes];

                const filteredSuppliers = SUPPLIERS.filter(supplier =>
                    relevantCategories.some(cat => supplier.categories && supplier.categories.includes(cat))
                );

                budgetSupplierCheckboxesContainer.innerHTML = filteredSuppliers.map(s => `
                    <label>
                        <input type="checkbox" name="budget-supplier-contact" value="${s.id}" data-whatsapp="${s.contacts[0]?.whatsapp || ''}" data-contact-name="${s.contacts[0]?.name || s.name}" data-supplier-id="${s.id}"> ${s.name} (${s.contacts[0]?.role || 'Contato Geral'})
                    </label>
                `).join('');

                budgetSupplierCheckboxesContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.addEventListener('change', () => {
                        const selectedContacts = Array.from(budgetSupplierCheckboxesContainer.querySelectorAll('input[type="checkbox"]:checked'));
                        if (selectedContacts.length === 1) {
                            const supplierId = selectedContacts[0].value;
                            const supplier = SUPPLIERS.find(s => s.id === parseInt(supplierId));
                            if (supplier && selectedSupplierNameDisplay && sendBudgetWhatsappButton && selectedSupplierContactDiv) {
                                selectedSupplierNameDisplay.textContent = supplier.name;
                                const whatsappContact = supplier.contacts.find(c => c.whatsapp); // Busca o primeiro contato com WhatsApp
                                if (whatsappContact) {
                                    sendBudgetWhatsappButton.href = `https://wa.me/${whatsappContact.whatsapp}`;
                                    selectedSupplierContactDiv.classList.remove('hidden');
                                } else {
                                    selectedSupplierContactDiv.classList.add('hidden');
                                    alert('Fornecedor selecionado não possui WhatsApp cadastrado.');
                                }
                            }
                        } else {
                            if (selectedSupplierContactDiv) selectedSupplierContactDiv.classList.add('hidden');
                        }
                    });
                });
            } else {
                if (budgetSupplierCheckboxesContainer) budgetSupplierCheckboxesContainer.innerHTML = '';
                if (selectedSupplierContactDiv) selectedSupplierContactDiv.classList.add('hidden');
            }
        });
    });

    // --- Manage Suppliers (Admin Only) Event Listeners ---
    if (openCreateSupplierModalButton) openCreateSupplierModalButton.addEventListener('click', openCreateSupplierModal);
    if (manageSupplierCloseButton) manageSupplierCloseButton.addEventListener('click', () => closeModal(manageSupplierModal));
    if (addSupplierContactButton) addSupplierContactButton.addEventListener('click', () => addContactField());
    if (manageSupplierForm) manageSupplierForm.addEventListener('submit', handleSaveSupplier);
    if (openEditSupplierSearchModalButton) openEditSupplierSearchModalButton.addEventListener('click', openEditSupplierSearchModal);
    if (editSupplierSearchModal) {
        editSupplierSearchModal.querySelector('.close-button').addEventListener('click', () => closeModal(editSupplierSearchModal));
        if (searchSupplierToEditModalButton) searchSupplierToEditModalButton.addEventListener('click', handleSearchSupplierToEdit);
        if (editSupplierSearchInputModal) editSupplierSearchInputModal.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSearchSupplierToEdit();
        });
    }

    // --- Manage Users Section ---
    if (createTempUserForm) createTempUserForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = tempUsernameInput.value.trim();
        const password = tempPasswordInput.value.trim();
        const durationHours = parseInt(tempDurationSelect.value);

        if (!username || !password) {
            if (tempUserFeedback) tempUserFeedback.textContent = 'Usuário e senha são obrigatórios.';
            if (tempUserFeedback) tempUserFeedback.style.color = 'red';
            return;
        }
        if (USERS[username]) {
            if (tempUserFeedback) tempUserFeedback.textContent = 'Nome de usuário já existe.';
            if (tempUserFeedback) tempUserFeedback.style.color = 'red';
            return;
        }

        const expiresAt = new Date(new Date().getTime() + durationHours * 60 * 60 * 1000).toISOString();
        USERS[username] = { password, role: 'seller', type: 'temporary', expiresAt, displayName: username, email: '', phone: '', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' };
        localStorage.setItem('USERS', JSON.stringify(USERS)); // Salva no localStorage

        if (tempUserFeedback) {
            tempUserFeedback.textContent = `Usuário "${username}" criado com sucesso!`;
            tempUserFeedback.style.color = 'green';
        }
        createTempUserForm.reset();
        renderTempUserList();
        setTimeout(() => { if (tempUserFeedback) tempUserFeedback.textContent = ''; }, 5000);
    });

    // --- Create Product Section ---
    if (createProductForm) createProductForm.addEventListener('submit', handleCreateProduct);

    // --- Edit Product Section ---
    if (editProductSearchInput) editProductSearchInput.addEventListener('input', handleSearchProductToEdit); // Live search
    if (searchProductToEditButton) searchProductToEditButton.addEventListener('click', handleSearchProductToEdit);
    if (editProductForm) editProductForm.addEventListener('submit', handleEditProduct);

    // --- Drone Visitor Section ---
    if (droneVisitorSearchInput) droneVisitorSearchInput.addEventListener('input', renderDroneVisitorList);

    // --- Mobile Nav Toggle ---
    if (navToggleBtn) navToggleBtn.addEventListener('click', () => {
        if (nav) nav.classList.add('nav-open');
    });
    if (navToggleBtnClose) navToggleBtnClose.addEventListener('click', () => {
        if (nav) nav.classList.remove('nav-open');
    });

    // --- Scroll to Top Button ---
    if (mainContent) {
        mainContent.onscroll = function() {
            if (mainContent.scrollTop > 200) {
                if (scrollToTopButton) scrollToTopButton.style.display = "block";
            } else {
                if (scrollToTopButton) scrollToTopButton.style.display = "none";
            }
        };
    }
    if (scrollToTopButton) scrollToTopButton.addEventListener('click', () => {
        if (mainContent) mainContent.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // --- General Calculator Section ---
    if (generalCalculateButton) generalCalculateButton.addEventListener('click', () => {
        const baseValue = parseFloat(generalCalcValorBase.value);
        const paymentMethod = document.querySelector('input[name="general-payment-method"]:checked').value;
        const numInstallments = generalCalcParcelasSelect.value;
        const discountPercentage = parseFloat(generalDiscountPercentageInput.value);
        if (generalCalculatorResult) generalCalculatorResult.innerHTML = calculate(baseValue, numInstallments, paymentMethod, discountPercentage);
    });
    if (generalCalcPaymentRadios) generalCalcPaymentRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
            if (generalCalcInstallmentsContainer) generalCalcInstallmentsContainer.classList.toggle('hidden', e.target.value !== 'parcelado');
            if (generalDiscountOption) generalDiscountOption.classList.toggle('hidden', e.target.value !== 'vista');
        });
    });

    // --- Filtros e Ordenação Event Listeners ---
    if (openProductFilterSortModalButton) {
        openProductFilterSortModalButton.addEventListener('click', () => openFilterSortModal('products'));
    }
    if (openSupplierFilterSortModalButton) {
        openSupplierFilterSortModalButton.addEventListener('click', () => {
            if (window.currentUser && window.currentUser.role === 'admin' || window.pendingSupplierSectionAccess) {
                openFilterSortModal('suppliers');
            } else {
                // If not allowed, switchTab('suppliers-section') already handles the password modal.
                // No need to open it again here directly.
            }
        });
    }
    if (filterSortCloseButton) filterSortCloseButton.addEventListener('click', () => closeModal(filterSortModal));
    if (applyFilterSortButton) applyFilterSortButton.addEventListener('click', applyFilterSort);

    if (filterSortSearchInput) filterSortSearchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') applyFilterSort();
    });

    // --- Inicialização ---
    const initialize = () => {
        // Carrega dados do localStorage
        const storedUsers = localStorage.getItem('USERS');
        const storedProducts = localStorage.getItem('PRODUCTS');
        const storedSuppliers = localStorage.getItem('SUPPLIERS');

        if (storedUsers) {
            try { USERS = JSON.parse(storedUsers); } catch (e) { console.error("Erro ao carregar USERS:", e); USERS = {}; }
        }
        if (storedProducts) {
            try { PRODUCTS = JSON.parse(storedProducts); } catch (e) { console.error("Erro ao carregar PRODUCTS:", e); PRODUCTS = []; }
        }
        if (storedSuppliers) {
            try { SUPPLIERS = JSON.parse(storedSuppliers); } catch (e) { console.error("Erro ao carregar SUPPLIERS:", e); SUPPLIERS = []; }
        }

        // Popula selects de fornecedores para criação/edição de produtos
        const populateSupplierSelects = () => {
            const optionsHtml = SUPPLIERS.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
            if (newProductSupplierSelect) newProductSupplierSelect.innerHTML = '<option value="">Selecione um fornecedor</option>' + optionsHtml;
            if (editProductSupplierInput) editProductSupplierInput.innerHTML = '<option value="">Selecione um fornecedor</option>' + optionsHtml;
        };
        populateSupplierSelects();

        // Tenta logar automaticamente se houver um usuário salvo na sessão anterior
        const storedCurrentUser = localStorage.getItem('currentUser');
        if (storedCurrentUser) {
            try {
                window.currentUser = JSON.parse(storedCurrentUser);
                // Verifica se o usuário ainda existe nos USERS (caso temporário tenha expirado ou sido excluído)
                if (USERS[window.currentUser.username]) {
                    setupAppForUser();
                } else {
                    handleLogout(); // Usuário da sessão não existe mais, desloga
                }
            } catch (e) {
                console.error("Erro ao carregar currentUser:", e);
                handleLogout(); // Limpa sessão inválida
            }
        } else {
            openModal(loginScreen); // Mostra a tela de login se não houver usuário salvo
        }

        // Renderiza listas iniciais (chamadas por setupAppForUser ao logar)
        // Se não logar automaticamente, as funções de renderização serão chamadas por switchTab.
    };

    initialize(); // Chama a função de inicialização ao carregar a DOM
});